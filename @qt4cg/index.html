<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2023/">2023</a>, <a href="2022/">2022</a></p><div class="toots">
<div class="toot" id="minutes-01-31"><h2>QT4 CG meeting 020 draft minutes<span class="toot-id"> #minutes-01-31</span></h2><div class="pubdate">31 Jan at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-31">https://qt4cg.org/meeting/minutes/2023/01-31</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-330"><h2>Pull request #330 created<span class="toot-id"> #created-330</span></h2><div class="pubdate">31 Jan at 12:56:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><details><summary>Update fn:parse-html to apply review feedback.</summary><div class="markup"><p>This is still a work in progress:</p>
<ul>
<li>[x] QT4CG-016-03: RD to add a note clarifying “known character encoding”</li>
<li>[x] QT4CG-016-04: RD to add a note clarifying the “<em>”/”</em>” html/version combination</li>
<li>[x] QT4CG-016-05: RD to add a “todo” noting the dependency on keyword arguments</li>
<li>[ ] QT4CG-016-06: RD to reword the introduction to mapping to clarify who’s doing the mapping</li>
<li>[ ] QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li>[ ] QT4CG-016-09: RD to add a note stating that the local name should always be lowercase</li>
<li>[ ] QT4CG-016-10: RD to consider how to clarify parsed entity parsing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-329"><h2>Issue #329 created<span class="toot-id"> #created-329</span></h2><div class="pubdate">30 Jan at 11:45:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/329">https://github.com/qt4cg/qtspecs/issues/329</a></div><details><summary>Keyword parameters: Error codes</summary><div class="markup"><p>I’ve read the current specification twice, and I have checked the existing qt4 tests, but I’m still confused by the exact meaning of the new error codes for keyword arguments, <code>XPST0141</code> and <code>XPST0142</code>. Things are getting particularly tricky if we consider partial function applications.</p>
<p>My proposal would be to simplify the current approach and:</p>
<ol>
<li>use the existing error code <code>XPST0017</code> for all cases in which a function cannot be chosen as the available arguments (both positional and keyword-based) don’t match the function definition, and</li>
<li>only raise a new error code (<code>XPST0141</code>, possibly) if a keyword argument has been specified more than once (as this can be done without checking the function definitions).</li>
</ol>
</div></details></div>
<div class="toot" id="created-328"><h2>Issue #328 created<span class="toot-id"> #created-328</span></h2><div class="pubdate">30 Jan at 10:05:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><details><summary>Switch Cases: Lift single-item restriction on operands</summary><div class="markup"><h2>Motivation</h2>
<p><a href="https://www.w3.org/TR/xquery-31/#id-switch">XQuery switch cases</a> have a peculiar restriction: The operand of a single case must yield an empty sequence or a single item. There seem to be no (obvious) reasons why this restriction exists, so I believe we should lift it and allow arbitrary sequences.</p>
<p>A similar extension is planned for Java 12 (<a href="http://openjdk.java.net/jeps/325">JEP 325: Switch Expressions</a>). The required changes in XQuery are simpler, though, as the 3.1 grammar already supports arbitrary expressions as operands.</p>
<h2>Examples</h2>
<pre><code class="language-xquery">switch($value)
  case 1
  case 2
  case 3
  case 4
  case 5
    return 'small'
  default
    return 'big'
</code></pre>
<p>Proposed syntax:</p>
<pre><code class="language-xquery">switch($value)
  case 1 to 5
    return 'small'
  default
    return 'big'
</code></pre>
<h2>Required Changes</h2>
<p>The <a href="https://www.w3.org/TR/xquery-31/#id-switch">current matching rules</a> could be rephrased as follows:</p>
<ol>
<li>The SwitchCaseOperand is evaluated.</li>
<li>The resulting value is atomized.</li>
<li>The case matches if the value is empty and if the value of the switch expression is empty as well.</li>
<li>Otherwise, the atomized value of the switch operand expression is compared with each item of the atomized value of the SwitchCaseOperand using <code>fn:deep-equal</code>, with the default collation from the static context.</li>
</ol>
<h2>References</h2>
<ul>
<li>Original Proposal: https://github.com/expath/xpath-ng/pull/12</li>
<li>Discussion on Slack: https://xmlcom.slack.com/archives/C011NLXE4DU/p1675006336963479</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-01-31"><h2>QT4 CG meeting 020 draft agenda<span class="toot-id"> #agenda-01-31</span></h2><div class="pubdate">30 Jan at 08:47:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-31">https://qt4cg.org/meeting/agenda/2023/01-31</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-327"><h2>Issue #327 created<span class="toot-id"> #created-327</span></h2><div class="pubdate">30 Jan at 08:42:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/327">https://github.com/qt4cg/qtspecs/issues/327</a></div><details><summary>Tokenisation</summary><div class="markup"><p>The rule in A.2</p>
<blockquote>
<p>When tokenizing, the longest possible match that is consistent with the EBNF is used.</p>
</blockquote>
<p>needs clarifying. It could be read as suggesting that if taking the longest match turns out to lead to a syntax error, the tokenisation should be re-attempted using a shorter match. I don't think that has ever been intended. So what exactly does the qualifier "that is consistent with the EBNF" actually mean?</p>
<p>Possibly related, A.2.2 Terminal Delimitation states:</p>
<blockquote>
<p>Terminal symbols that are not used exclusively in [/* ws: explicit */] productions are of two kinds: delimiting and non-delimiting.</p>
</blockquote>
<p>But (at least in the XQuery version) the list of delimiting tokens includes a number that are indeed used exclusively in ws:explicit productions, for example a number of tokens containing back-ticks, and <code>]]&gt;</code>.</p>
<p>I think we need to be clearer that tokens used in ws:explicit productions are recognised only when parsing the production that uses them. For example given the expression <code>A[B[C]]&gt;3</code>, we should not recognise <code>]]&gt;</code> as a token under the longest-token rule. I think that's probably what the "consistent with the EBNF" rule is intended to convey.</p>
</div></details></div>
<div class="toot" id="created-326"><h2>Pull request #326 created<span class="toot-id"> #created-326</span></h2><div class="pubdate">29 Jan at 22:45:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="created-325"><h2>Issue #325 created<span class="toot-id"> #created-325</span></h2><div class="pubdate">29 Jan at 22:03:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><details><summary>Operator precedence table needs updating</summary><div class="markup"><p>The <code>otherwise</code> and <code>-&gt;</code> operators (and maybe others) are missing from the non-normative precedence table in Appendix A.4.</p>
</div></details></div>
<div class="toot" id="created-324"><h2>Pull request #324 created<span class="toot-id"> #created-324</span></h2><div class="pubdate">29 Jan at 18:23:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><details><summary>Proposed syntax and semantics for string templates</summary><div class="markup"><p>See issue #58.</p>
<p>I would recommend reviewing the XQuery version of the spec first, since it contains additional notes contrasting string templates and the existing string constructors. The section on string constructors has moved, but is unchanged except for the addition of this note.</p>
</div></details></div>
<div class="toot" id="created-323"><h2>Issue #323 created<span class="toot-id"> #created-323</span></h2><div class="pubdate">27 Jan at 21:56:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/323">https://github.com/qt4cg/qtspecs/issues/323</a></div><details><summary>add select attribute to xsl:text</summary><div class="markup"><p>Although xsl:text select="socks" would be the same as xsl:value-of select="socks" in implementation terms, users of XSLT 2 and later, even people who have been using XSLT 2 or 3 for some time, are often surprised to learn that xsl:value-of makes a text node, and that they need to use xsl:sequence to return something else.</p>
<p>So it'd be great to have them use xsl:text instead of xsl:value-of, where text nodes are wanted, because then introducing xsl:sequence is a small step.</p>
<p>Of course, beginners also often use value-of where they should be using apply-templates, e.g. to handle mixed content! But again, using xsl:text reduces that temptation.</p>
<p>We do have value templates now, <a href="xsl:text">xsl:text</a>{ .... }&lt;/xsl:text&gt;, which mitigates the need slightly, but i think only slightly, because the select= analogy is very compelling.</p>
</div></details></div>
<div class="toot" id="created-322"><h2>Issue #322 created<span class="toot-id"> #created-322</span></h2><div class="pubdate">26 Jan at 10:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/322">https://github.com/qt4cg/qtspecs/issues/322</a></div><details><summary>Map construction in XSLT: xsl:record instruction</summary><div class="markup"><p>Constructing maps in XSLT often involves code rather like this:</p>
<pre><code>            &lt;xsl:map&gt;
               &lt;xsl:map-entry key="'author'" select="string(AUTHOR)"/&gt;
               &lt;xsl:map-entry key="'title'" select="string(TITLE)"/&gt;
               &lt;xsl:map-entry key="'price'" select="xs:decimal(PRICE)"/&gt;
               &lt;xsl:map-entry key="'publisher'" select="string(../@name)"/&gt;
           &lt;/xsl:map&gt;
</code></pre>
<p>The alternative using XPath is also rather ugly:</p>
<pre><code>&lt;xsl:sequence select="map{'author': string(AUTHOR),
                                                 'title':string(TITLE), 
                                                 'price': xs:decimal(PRICE), 
                                                 'publisher':string(../@name)}"/&gt;
</code></pre>
<p>(the fact  that it is creating a map doesn't stand out; the <code>xsl:sequence</code> is a distraction because there's no sequence involved; and many users dislike long multi-line XPath expressions because of formatting problems in their editing tools)</p>
<p>I propose a new instruction xsl:record which allows:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"/&gt;
</code></pre>
<p>This is rather like literal result elements in that the attributes are user-defined rather than system-defined. Unlike LREs, the values are general expressions rather than AVTs, because the values are not necessarily strings. The instruction can only be used where the keys (field names) take the form of NCNames.</p>
<p>If variable entries are required, or entries whose keys are not NCNames, they can appear as child instructions:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"&gt;
              &lt;xsl:if test="@private"&gt;
                  &lt;xsl:map-entry name="'private entry'" select="true()"/&gt;
              &lt;/xsl:if&gt;
          &lt;/xsl:record&gt;
</code></pre>
<p>Follow the tradition of LREs, duplicates are resolved as "last one wins".</p>
<p>If "standard attributes" such as <code>[xsl:]version</code> are required, they must be in the XSLT namespace, as with LREs.</p>
</div></details></div>
<div class="toot" id="created-321"><h2>Issue #321 created<span class="toot-id"> #created-321</span></h2><div class="pubdate">26 Jan at 04:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><details><summary>relax $input in fn:serialize</summary><div class="markup"><p>Relevant specifications:
https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-serialize</p>
<p>Would it be possible to relax the strictures on <code>$input</code> (first parameter) of <code>fn:serialize()</code>?</p>
<ol>
<li>The specifications do not explicitly forbid <code>map(*)</code> or <code>array(*)</code> as input, but in practice, when these are supplied, Saxon rejects them. Developers (or at least this one) who work with arrays and maps often need to render them in string output or messages, if only for diagnostics. If there is something really prohibitively wrong with those two items as input to <code>fn:serialize()</code>, then the specifications should say so.</li>
<li>Attributes are forbidden, but it is unclear why. They get serialized fine in the context of a parent, why not alone?</li>
<li>Namespace nodes are forbidden; see previous point.</li>
</ol>
<p>(No doubt there must have been discussion on points 2-3, but the rationale is not clear from the specs.)</p>
<p>Perhaps the question is that the details of what the serialization should look like is contestable. I think the answer there is simply, pick one. I think we'll happily live with whatever is chosen.</p>
<p>For the serialization of maps and arrays, I'll point as one possible model my <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/maps/TAN-fn-maps-extended.xsl#L58">tan:map-to-xml()</a> and <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/arrays/TAN-fn-arrays-extended.xsl#L66">tan:array-to-xml()</a>, which have been indispensable for daily troubleshooting.</p>
</div></details></div>
<div class="toot" id="created-320"><h2>Pull request #320 created<span class="toot-id"> #created-320</span></h2><div class="pubdate">25 Jan at 18:58:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><details><summary>Issue 98 - add options parameter to fn:deep-equal</summary><div class="markup"><p>This proposal adds an options parameter to fn:deep-equal, giving much more detailed control over how the comparison is performed (while remaining backwards compatible by default).</p>
<p>This proposal is a first draft and I would request careful review, it's not one to pass through "on the nod".</p>
</div></details></div>
<div class="toot" id="created-319"><h2>Pull request #319 created<span class="toot-id"> #created-319</span></h2><div class="pubdate">25 Jan at 16:20:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><details><summary>Issue 221: op:same-key becomes fn:atomic-equal</summary><div class="markup"><p>The proposal renames op:same-key as fn:atomic-equal, thus making it directly available to applications.</p>
</div></details></div>
<div class="toot" id="created-318"><h2>Issue #318 created<span class="toot-id"> #created-318</span></h2><div class="pubdate">25 Jan at 11:36:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><details><summary>Serialization HTML/XHTML output methods: meta elements and the charset attribute</summary><div class="markup"><p>HTML5 introduces the ability to write</p>
<p><code>&lt;meta charset="utf-8"/&gt;</code></p>
<p>in place of</p>
<p><code>&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;</code></p>
<p>The serialization spec (for HTML and XHTML output methods) ignores this.</p>
<p>(a) it requires the serializer to add a <code>meta</code> element in the second form rather than the first.</p>
<p>(b) when removing existing <code>meta</code> elements, it requires the second form to be deleted, but not the first. This may result in invalid (X)HTML in which both elements are present.</p>
</div></details></div>
<div class="toot" id="closed-309"><h2>Issue #309 closed<span class="toot-id"> #closed-309</span></h2><div class="pubdate">24 Jan at 17:20:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><p>Drop ternary conditionals, as agreed on 2023-01-17</p></div>
<div class="toot" id="closed-310"><h2>Issue #310 closed<span class="toot-id"> #closed-310</span></h2><div class="pubdate">24 Jan at 17:20:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><p>Fix outstanding issues from PR 304</p></div>
<div class="toot" id="closed-312"><h2>Issue #312 closed<span class="toot-id"> #closed-312</span></h2><div class="pubdate">24 Jan at 17:20:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><p>Minor editorial improvements</p></div>
<div class="toot" id="closed-313"><h2>Issue #313 closed<span class="toot-id"> #closed-313</span></h2><div class="pubdate">24 Jan at 17:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><p>Issue 294: fn:remove()</p></div>
<div class="toot" id="created-317"><h2>Issue #317 created<span class="toot-id"> #created-317</span></h2><div class="pubdate">24 Jan at 17:16:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><details><summary>fn:format-integer: $lang → $language ?</summary><div class="markup"><p>A minor inconsistency in the XQFO specification: The third parameter of <code>fn:format-integer</code> is named <code>$lang</code>…</p>
<p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-format-integer</p>
<p>…whereas all other language parameters are named <code>$language</code>.</p>
</div></details></div>
<div class="toot" id="minutes-01-24"><h2>QT4 CG meeting 019 draft minutes<span class="toot-id"> #minutes-01-24</span></h2><div class="pubdate">24 Jan at 17:11:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-24">https://qt4cg.org/meeting/minutes/2023/01-24</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-316"><h2>Issue #316 created<span class="toot-id"> #created-316</span></h2><div class="pubdate">23 Jan at 16:23:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/316">https://github.com/qt4cg/qtspecs/issues/316</a></div><details><summary>Function fn:differences</summary><div class="markup"><p>I didn't see any issues thread devoted <code>fn:differences()</code>, so am opening this one. Please respond with xrefs to anything relevant.</p>
<p>Draft here:
https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-differences</p>
<p>IMO, this function seems overly complicated for both users and implementors. The specs provide difficult reading. But it is the first function to try to address the desideratum for differencing. Something like it is needed methinks.</p>
<p>My suggestion would be to simplify the function as a straightforward string comparison, i.e., change the signature to something like <code>fn:differences($input1 as xs:string, $input2 as xs:string) as OUTPUT</code> where <code>OUTPUT</code> is either a tree structure (like the output of <code>fn:analyze-string()</code>) or a sequence of records (e.g., <code>(is-in-1 as xs:boolean, is-in-2 as xs:boolean, fragment as xs:string)</code>).</p>
<p>Such a change would make the function more tractable for both users and implementers. The user, would need to cast each sequence to a string, and in so doing will be able to (be compelled to) make fine-grained decisions on things such as normalization. Processor implementers have far simpler input, and they can choose the difference algorithm that makes best sense at the moment.</p>
<p>One counterargument might be that the resultant output would be difficult to correlate to the original sequences. Ostensibly, one wants to do things such as decide whether to drop certain items in sequence 1 or sequence 2. My response is that the current draft results in output that suffers from the same problem. Navigating the map to correlate it to the original sequence sounds daunting. With my suggestion, there are ways around this, through auxiliary functions or arity expansions that normalize the output.</p>
<p>But I don't want to get postprocessing output here, which would be tangential to the main question, i.e., how <code>fn:differences()</code> should be constructed in a way conducive to both users and implementers.</p>
</div></details></div>
<div class="toot" id="closed-311"><h2>Issue #311 closed<span class="toot-id"> #closed-311</span></h2><div class="pubdate">23 Jan at 11:46:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-315"><h2>Issue #315 created<span class="toot-id"> #created-315</span></h2><div class="pubdate">18 Jan at 14:58:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><details><summary>fn:transform inconsistency: initial-mode</summary><div class="markup"><p>The <code>fn:transform</code> specification in F+O says that if no initial-mode is supplied, the unnamed mode is used.</p>
<p>The XSLT 3.0 specification says that if no initial mode is supplied, then the default mode is used if one has been specified, or the unnamed mode is used if not.</p>
<p>I think the XSLT 3.0 spec should win here: it makes more sense if a default has been declared that it should actually be used.</p>
<p>(Thanks to Amanda Galtman for pointing this out.)</p>
</div></details></div>
<div class="toot" id="created-314"><h2>Issue #314 created<span class="toot-id"> #created-314</span></h2><div class="pubdate">18 Jan at 09:24:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/314">https://github.com/qt4cg/qtspecs/issues/314</a></div><details><summary>Basic Operations on Maps and Arrays</summary><div class="markup"><h1>Manipulating Arrays and Maps</h1>
<p>This is an outline of proposed new facilities designed to make processing of maps and arrays easier. The basic facilities needed for transformation of maps and arrays are the ability to decompose them into their parts, manipulate the parts, and the compose new arrays and maps from these parts.</p>
<p>Further background is in my 2022 Balisage paper, https://balisage.net/Proceedings/vol27/html/Kay01/BalisageVol27-Kay01.html</p>
<p>This proposal considers only the "shallow" operations on maps and arrays. Further proposals for deep search and update of nested structures are to be expected.</p>
<h2>Basics</h2>
<p>A map entry is an item used to represent a key-value pair in a map; it is an item of type <code>record(key as xs:anyAtomicType, value as item()*)</code>, aliased in this proposal as <code>type(map-entry)</code>.</p>
<p>Note: <em>an alternative representation for key-value pairs is as a singleton map, and that's the representation used by the existing map:entry() function and by the xsl:map-entry instruction. A representation as <code>record(key, value)</code> is rather more convenient to enable extraction of the key and value, but does create some compatibility issues...</em></p>
<p>An array entry is an item used to represent a member of an array; it is an item of type <code>record(value as item()*)</code>, aliased in this proposal as <code>type(array-entry)</code>.</p>
<h2>Decomposing Maps and Arrays</h2>
<p>The function <code>map:entries($map)</code> returns a sequence of map entries, in unpredictable order, representing the contents of the supplied map. It is equivalent to <code>map:for-each($map, -&gt;($k, $v){map:entry($k, $v)})</code>.</p>
<p>The function <code>array:entries($array)</code> returns a sequence of array entries, in array order, representing the members of the supplied array. It is equivalent to <code>array:for-each($array, -&gt;($v){array:entry($v)})</code>.</p>
<h2>Constructing Maps and Arrays</h2>
<p>The function <code>map:of($entries as type(map-entry)*) as map(*)</code> constructs a map from a sequence of map entries. A second parameter, <code>$options</code>, is available to control handling of duplicates, as with <code>map:merge()</code>. The function is equivalent to <code>map:merge($entries!map{'key':?key, 'value':?value})</code>.</p>
<p>The function <code>array:of($entries as type(array-entry)*) as array(*)</code> constructs an array from a sequence of array entries. It is equivalent to <code>array:fold-left($entries, [], array:append#2)</code>.</p>
<p>The function <code>map:entry($key, $value) as type(map-entry)</code> is equivalent to <code>map{'key':$key, 'value':$value}</code>. <em>Problem: we already have a function map:entry() in 3.1 that does something different. Need to change the terminology...</em></p>
<p>The function <code>array:entry($value) as type(array-entry)</code> is equivalent to <code>map{'value':$value}</code>.</p>
<h2>Filtering Maps and Arrays</h2>
<p>The construct <code>$map?[PREDICATE]</code> is equivalent to <code>map:of(map:entries($map)[PREDICATE])</code>. For example, given a map in which the keys are dates, <code>$map?[year-from-date(?key)=2023]</code> returns a map containing those entries in which the key is a date in 2023.</p>
<p>The construct <code>$array?[PREDICATE]</code> is equivalent to <code>array:of(array:entries($array)[PREDICATE])</code>. For example, <code>$array?[1]</code> selects the first item in the array (as a single-member array), while <code>$array?[exists(?value)]</code> returns an array containing all those entries in the input array that are not empty. If <code>$array</code> is an array of maps, then <code>$array?[?value?name='John']</code> selects those members of the array that are maps having <code>?name='John'</code>.</p>
<h2>Mapping Maps and Arrays</h2>
<p>The construct <code>$map!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$map</code> and returns the result as a flattened sequence. For example <code>map:of($map!!map:entry(?key, ?value+1))</code> returns a map in which each value has been incremented by one.</p>
<p>The construct <code>$array!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$array</code>, and returns the result as a flattened sequence. For example, <code>array:of($array!!array:entry(?value+1))</code> returns an array in which every value has been incremented by one.</p>
<h2>FLWOR Expressions</h2>
<p>The for-member clause <code>for member $m in $array</code> is equivalent to <code>for $sys:var in array:entries($array) let $m := $sys:var?value</code>.</p>
<p>The for-entry clause <code>for entry ($k, $v) in $map</code> is equivalent to <code>for $sys:var in map:entries($map) let $k := $sys:var?key, $v := $sys:var?value</code>.</p>
<h2>XSLT</h2>
<p>Iteration over maps and arrays is achieved using <code>&lt;xsl:for-each select="array:entries()"&gt;</code> and <code>&lt;xsl:for-each select="map:entries()"&gt;</code> directly.</p>
<p>Construction of maps uses the existing instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code>. There is an inconvenience here in that the <code>&lt;xsl:map-entry&gt;</code> instruction returns a singleton map (<code>map{key:value}</code>) rather than a map entry as defined in this proposal (<code>map{'key':key, 'value':value}</code>)..</p>
<p>Construction of arrays uses the new instructions <code>&lt;xsl:array&gt;</code> and <code>&lt;xsl:array-entry&gt;</code>. The <code>xsl:array-entry</code> instruction is defined to construct an array entry as defined in this proposal.</p>
<h2>Use Cases</h2>
<p>To be supplied.</p>
</div></details></div>
<div class="toot" id="created-313"><h2>Pull request #313 created<span class="toot-id"> #created-313</span></h2><div class="pubdate">17 Jan at 22:53:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><details><summary>Issue 294: fn:remove()</summary><div class="markup"><p>Allow remove() to remove several items, aligning it with array:remove() and map:remove()</p>
</div></details></div>
<div class="toot" id="created-312"><h2>Pull request #312 created<span class="toot-id"> #created-312</span></h2><div class="pubdate">17 Jan at 22:25:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><details><summary>Minor editorial improvements</summary><div class="markup"><ul>
<li>Issue 300 (clarification about results being normalized)</li>
<li>Action QT4CG-018-02 (explaining signature notation)</li>
<li>Action QT4CG-018-04 (explaining numeric predicates on ancestor unions)</li>
</ul>
</div></details></div>
<div class="toot" id="created-311"><h2>Pull request #311 created<span class="toot-id"> #created-311</span></h2><div class="pubdate">17 Jan at 21:39:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-310"><h2>Pull request #310 created<span class="toot-id"> #created-310</span></h2><div class="pubdate">17 Jan at 21:27:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><details><summary>Fix outstanding issues from PR 304</summary><div class="markup"><p>See https://github.com/qt4cg/qtsp…ecs/pull/304#issuecomment-1378532583 - but excluding item 3 because that's a stylesheet change.</p>
</div></details></div>
<div class="toot" id="created-309"><h2>Pull request #309 created<span class="toot-id"> #created-309</span></h2><div class="pubdate">17 Jan at 19:20:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><details><summary>Drop ternary conditionals, as agreed on 2023-01-17</summary><div class="markup"><p>We agreed today to drop ternary conditional expressions from the proposal; this PR implements that change.</p>
</div></details></div></div><p>See 112
            more statuses in yearly archives.</p></article></main></body></html>