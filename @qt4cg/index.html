<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2022/">2022</a></p><div class="toots">
<div class="toot" id="agenda-12-13"><h2>QT4 CG meeting 015 draft agenda<span class="toot-id"> #agenda-12-13</span></h2><div class="pubdate">09 Dec at 07:44:30 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/12-13">https://qt4cg.org/meeting/agenda/2022/12-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-285"><h2>Issue #285 created<span class="toot-id"> #created-285</span></h2><div class="pubdate">08 Dec at 11:34:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/285">https://github.com/qt4cg/qtspecs/issues/285</a></div><details><summary>Stability of collections</summary><div class="markup"><p>The specification for fn:collection says:</p>
<blockquote>
<p>By default, this function is [·deterministic·]. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is [·implementation-defined·]. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [[err:FODC0003].</p>
</blockquote>
<p>I think this is unrealistic. The cost of making fn:collection deterministic is disproportionate to the benefits. It's very rare in practice for a query or stylesheet to process the same collection more than once, and retaining the information needed to deliver the identical results on these rare occasions is expensive (typically it means holding a long-term lock on the data, or keeping a copy of the entire collection in memory). It also inhibits techniques such as multi-threaded evaluation.</p>
<p>I would like to relax this requirement.</p>
</div></details></div>
<div class="toot" id="created-284"><h2>Pull request #284 created<span class="toot-id"> #created-284</span></h2><div class="pubdate">07 Dec at 11:55:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><details><summary>Add grammar for "if (test) then {expr}" with no else</summary><div class="markup"><p>As discussed in issue #234. In reviewing this PR, I suggest we consider it together with the existing proposals for ternary conditionals (x ?? y !! z) and the "otherwise" operator.</p>
</div></details></div>
<div class="toot" id="minutes-12-06"><h2>QT4 CG meeting 014 draft minutes<span class="toot-id"> #minutes-12-06</span></h2><div class="pubdate">06 Dec at 17:21:01 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/12-06">https://qt4cg.org/meeting/minutes/2022/12-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-283"><h2>Issue #283 created<span class="toot-id"> #created-283</span></h2><div class="pubdate">05 Dec at 11:23:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/283">https://github.com/qt4cg/qtspecs/issues/283</a></div><details><summary>Enumeration types</summary><div class="markup"><p>The draft specification includes a proposal to provide enumeration types. The proposal is incomplete, for example it does not include all the rules for conversions and casting. This issue is raised in order to outline where we are, what needs to be done, and to elicit consensus on whether we want to proceed with this.</p>
<p>What's the motivation? Primarily, making function signatures more expressive.</p>
<p><em>Q0: do we really need this?</em></p>
<p>The essence of the proposal is an ItemType that matches an enumerated set of xs:string values:</p>
<p><code>[131] | EnumerationType | ::= | "enum" "("&nbsp;&nbsp;StringLiteral&nbsp;(","&nbsp;&nbsp;StringLiteral)* ")"  </code>
For example, the type enum("red", "green", "blue") matches the string "green".</p>
<p><em>Q1: why restrict it to strings? I think my main reason was that the syntax gets complicated if we try to do it for data types that have no literal representation.</em></p>
<p>Subtyping is based on the value space. An enumeration type E is a subtype of another enumeration type F if the set of strings in E is a subset of those in F. All enumeration types are subtypes of xs:string.</p>
<p>Strings are not "labelled" as belonging to an enumeration type, matching is purely based on the value ("datum"). This doesn't provide very strong typing. If "violet" and "pink" are allowed by both the enumeration types <code>colour</code> and <code>flower</code>, then it's not intrinsically an error to use a variable of type <code>flower</code> where a <code>colour</code> is expected. Equally, a variable of type <code>xs:string</code> can be used where a <code>colour</code> is expected.</p>
<p><em>Q2: should enumerations be more strongly typed?</em></p>
<p>I would expect that an enumeration type can be used as the target of "cast" or "castable", but this is not currently in the spec.</p>
<p>The coercion rules as currently written say that if the expected type is an enumeration type, then the rules are largely the same as for any other subtype of <code>xs:string</code>:  casting from <code>xs:untypedAtomic</code> applies, promotion from <code>xs:anyURI</code> does not apply, 1.0 compatibility mode rules do not apply.</p>
<p>Operators and functions on enumeration types are the same as for <code>xs:string</code>. This means, for example, that there are no special rules for comparison: values are ordered as strings and are compared using the default collation.</p>
</div></details></div>
<div class="toot" id="closed-271"><h2>Issue #271 closed<span class="toot-id"> #closed-271</span></h2><div class="pubdate">05 Dec at 10:26:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/271">https://github.com/qt4cg/qtspecs/pull/271</a></div><p>Amendments to data model spec as per minutes of 2022-11-22</p></div>
<div class="toot" id="agenda-12-06"><h2>QT4 CG meeting 014 draft agenda<span class="toot-id"> #agenda-12-06</span></h2><div class="pubdate">05 Dec at 10:20:13 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/12-06">https://qt4cg.org/meeting/agenda/2022/12-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-282"><h2>Issue #282 closed<span class="toot-id"> #closed-282</span></h2><div class="pubdate">05 Dec at 09:51:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/282">https://github.com/qt4cg/qtspecs/pull/282</a></div><p>Copy of MK actions-2022-11-15 branch by NW</p></div>
<div class="toot" id="created-282"><h2>Pull request #282 created<span class="toot-id"> #created-282</span></h2><div class="pubdate">05 Dec at 09:46:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/282">https://github.com/qt4cg/qtspecs/pull/282</a></div><details><summary>Copy of MK actions-2022-11-15 branch by NW</summary><div class="markup"><p>Resolves merge conflicts in #247</p>
</div></details></div>
<div class="toot" id="created-281"><h2>Issue #281 created<span class="toot-id"> #created-281</span></h2><div class="pubdate">03 Dec at 22:12:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><details><summary>XPath: Short-circuiting Functions and Lazy Evaluation Hints</summary><div class="markup"><h1>Short-circuiting Functions and Lazy Evaluation Hints</h1>
<h1><br>1. Introduction</h1>
<p>As shown in <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation#Support_in_common_programming_and_scripting_languages">Wikipedia</a>, most contemporary programming languages offer reasonable support for <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation#Definition">short-circuit evaluation</a>
(also known as <em>minimal</em> or <em>McCarthy evaluation</em>), including several standard language short-circuit operators.</p>
<p>Short-circuiting, as we will call the above in this document, is commonly used to achieve:</p>
<ol>
<li><em>Avoiding undesired side effects of evaluating the second argument</em>, such as
excessive evaluation time or throwing an error</li>
</ol>
<p>Usual example, using a&nbsp;<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C-based</a>&nbsp;language:</p>
<pre><code class="language-c">   int denom = 0;
   if (denom != 0 &amp;&amp; num / denom)
   {
   ...//ensures that calculating num/denom never results in divide-by-zero error
   }
</code></pre>
<p>Consider the following example:</p>
<pre><code class="language-c">   int a = 0;
   if (a != 0 &amp;&amp; myfunc(b))
   {
     do_something();
   }
</code></pre>
<p>In this example, short-circuit evaluation guarantees that&nbsp;<code>myfunc(b)</code>&nbsp;is never called. This is because&nbsp;<code>a&nbsp;!= 0</code>&nbsp;evaluates to&nbsp;<em><code>false</code></em>. This feature permits two useful programming constructs.</p>
<ol>
<li>
<p>If the first sub-expression checks whether an expensive computation is needed and the check evaluates to&nbsp;<em>false</em>, one can eliminate expensive computation in the second argument.</p>
</li>
<li>
<p>It permits a construct where the first expression guarantees a condition without which the second expression may cause a&nbsp;<a href="https://en.wikipedia.org/wiki/Run-time_error">run-time error</a>.</p>
</li>
<li>
<p><em>Idiomatic conditional construct</em></p>
</li>
</ol>
<p><a href="https://en.wikipedia.org/wiki/Perl">Perl</a>&nbsp;idioms:</p>
<pre><code>   some_condition or die; # Abort execution if some_condition is false

   some_condition and die; # Abort execution if some_condition is true
</code></pre>
<h1><br>2. Short-circuiting in XPath</h1>
<p>In short (pun intended) there is no such thing mentioned in any officially-published W3C version (&lt;= 3.1) of XPath.</p>
<p>This topic was briefly mentioned in the discussion of <a href="https://github.com/qt4cg/qtspecs/issues/78">another proposal</a>: that of providing the capability to specify strictly the order of evaluation.</p>
<p>Aspects of incorporating hints for <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazy evaluation</a> (a topic related to short-cutting) were discussed also in the thread to <a href="https://app.slack.com/client/T011VK9115Z/C01GVC3JLHE/thread/C01GVC3JLHE-1665542903.180989">this question</a> on the Xml.com Slack.</p>
<p>The situation at present is that the XPath processor that is being used decides whether or not to perform shortcutting, even in obvious cases. Thus, varying from one XPath processor to another, the differences in performance evaluation could be dramatic. For example, the following XPath expression is evaluated on BaseX (ver. &gt;= 10.3) for 0 seconds, and the same expression is evaluated by Saxon ver. 11 for about 100 seconds.</p>
<pre><code class="language-xq">
let $fnAnd := function($x)
   {
     function($y)
     {
      if(not($x)) then false()
                  else $y
     }
   }
   return
      $fnAnd(false())(some $b in ( ((1 to 1000000000000000000) !true()) )  satisfies not($b)   )
</code></pre>
<h2><br>3. Analysis</h2>
<p>We can define the term “<em>function with shortcutting</em>” (just for a 2-argument function, but this can be extended for <code>N</code>-argument function where <code>N &gt;= 2</code>) in the  following way:</p>
<p>Given a function <code>$f($x, $y)</code>, we denote in XPath its partial application for a given value of $x (say <code>let $x := $t</code>) as:</p>
<p><code>$f($t, ?)</code></p>
<p>The above is a function of one argument. By definition:</p>
<p><code>$f($x, $y)</code> is equivalent to <code>$f($x, ?) ($y)</code>, for every pair <code>$x</code> and <code>$y</code>.</p>
<p>That is, the partial application of the 2-argument function <code>$f</code> with fixed 1st argument is another function <code>$g</code> which when applied on the 2nd argument (<code>$y</code>) of <code>$f($x, $y)</code> produces the same value as <code>$f($x, $y)</code>:</p>
<p>If <code>$g</code> is defined as <code>$f($x, ?)</code>, then <code>$g($y)</code> produces the same value as <code>$f($x, $y)</code> for every pair <code>$x</code> and <code>$y</code>.</p>
<p>Let us take a specific function:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     { $x and $y}
</code></pre>
<p>Then one equivalent way of defining <code>$fAnd</code> is:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     {
                       let $partial := function($x as xs:boolean) as function(xs:boolean) as xs:boolean
                                               {
                                                  if(not($x)) then -&gt;(){false()}
                                                              else -&gt;($t) {$t}
                                               }
                         return $partial($x)($y)
                    }
   return
       $fAnd(false(), true())
</code></pre>
<p>The <strong><em><code>$partial</code></em></strong> function is the result of the partial application <code>$fAnd($x, ?)</code> and by definition this is a function of arity 1, which when applied on the 2nd argument of <code>$fAnd</code>, produces the same result as <code>$fAnd($x, $y)</code></p>
<p>From the code above we see that actually there exists a value of <code>$x</code> (the value <code>false()</code> ) for which <code>$fAnd($x, ?)</code> is not a function of one argument, but a constant function (of <strong>0</strong> arguments) – that produces the value <code>false()</code>.</p>
<p><strong>Definition</strong>:</p>
<p>We say that a function <code>f(x, y)</code> <em><strong>allows shortcutting</strong></em> if there exists at least one value <code>t</code> such that</p>
<p><code>f(t, ?)</code> is a constant.</p>
<h1><br>4. Solution</h1>
<p><strong>How can an XPath processor treat a function with shortcutting?</strong></p>
<p>Obviously, if the XPath processor knows that <code>f(x, y)</code> allows shortcutting, then it becomes possible to delay the evaluation of the 2nd argument <code>y</code> and only perform this evaluation if the arity of the function returned by <code>f(t, ?)</code> is <code>1</code>, and not <code>0</code>.</p>
<p><strong>How can an XPath processor know that a given function allows shortcutting?</strong></p>
<ul>
<li>
<p>One way to obtain this knowledge is to evaluate <code>f(t, ?)</code> and get the arity of the resulting function. XPath 3.1 allows getting the arity of any function item with the function <a href="https://www.w3.org/TR/xpath-functions-31/#func-function-arity">fn:function-arity()</a>.      However, doing this on every function call could be expensive and deteriorate performance.</p>
</li>
<li>
<p>Another way of informing the XPath processor that a given function <code>f(x, y)</code> allows shortcutting is if the language provides <em><strong>hints for lazy evaluation</strong></em>:
<br>let $fAnd := function($x as xs:boolean, <em><strong>lazy</strong></em> $y as xs:boolean) as xs:boolean<br>
<br>Only in the case when there is a <em><strong>lazy</strong></em> hint specified the XPath processor will check the arity of <code>f(x, ?)</code> and will not need to evaluate the <code>y</code> argument if this arity is <code>0</code>.</p>
</li>
</ul>
<p>Let us return to the original example:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     {
                       let $partial := function($x as xs:boolean) as function(xs:boolean) as xs:boolean
                                               {
                                                  if(not($x)) then -&gt;(){false()}
                                                              else -&gt;($t) {$t}
                                               }
                         return $partial($x)($y)
                    }
   return
       $fAnd(false(), true())
</code></pre>
<p>Executing this with an Xpath 3.1 processor, an error is raised: “<em>1 argument supplied, 0 expected: function() as xs:boolean { false() }.</em>”</p>
<p><img src="https://user-images.githubusercontent.com/10605892/205463393-3b4558ac-66d9-453f-81fc-f83ec0499425.png" alt="image"></p>
<p>But according to the updated “<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>” in Xpath 4.0, no error will occur:</p>
<blockquote>
<p>“<em>If&nbsp;<em>F</em>&nbsp;has lower arity than the expected type, then&nbsp;<em>F</em>&nbsp;is wrapped in a new function that declares and ignores the additional argument; the following steps are then applied to this new function.</em></p>
</blockquote>
<blockquote>
<p><em>For example, if the expected type is&nbsp;<code>function(node(), xs:boolean) as  xs:string</code>, and the supplied function is&nbsp;<code>fn:name#1</code>, then the supplied function is effectively replaced by&nbsp;<code>function($n as node(), $b as xs:boolean) as xs:string {fn:name($n)}</code></em>”</p>
</blockquote>
<p>This is exactly the place where the XPath processor will call the lower-arity function without providing to it the ignored, and not needed to be evaluated, additional argument.</p>
<p>Thus, according to this rule, an XPath 4.0 processor will successfully evaluate the above expression and will not issue the error shown above.</p>
<p>Finally, we can put the <em>lazy</em> hint on a function declaration or on a function call, or on both places:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, lazy $y as xs:boolean) as  xs:boolean
   {
     let $partial := function($x as xs:boolean) as function(lazy xs:boolean) as xs:boolean
                           {
                              if(not($x)) then -&gt;(){false()}
                                          else -&gt;($t) {$t}
                           }
      return $partial($x)( lazy $y)
   }
   return
       $fAnd(false(), lazy true())
</code></pre>
<p><strong><em>How to write short-circuiting functions?</em></strong></p>
<p>The code above is a good example how one can write a short-circuiting function evaluating which the XPath processor would be aware that a short-circuit is happening but instead of signaling arity error as an XPath 3.1 processor does, will logically ignore the unneeded 2nd argument.</p>
</div></details></div>
<div class="toot" id="created-280"><h2>Issue #280 created<span class="toot-id"> #created-280</span></h2><div class="pubdate">01 Dec at 15:14:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/280">https://github.com/qt4cg/qtspecs/issues/280</a></div><details><summary>Why is resolve-uri forbidden from resolving against a URI that contains a fragment identifier?</summary><div class="markup"><p>The 3.1 F&amp;O spec says, of <code>fn:resolve-uri()</code>:</p>
<blockquote>
<p>A dynamic error is raised [<a href="https://www.w3.org/XML/Group/qtspecs/specifications/xpath-functions-31/html/Overview.html#ERRFORG0002">err:FORG0002</a>] if $base is not a valid IRI according to the rules of RFC3987, extended with an implementation-defined subset of the extensions permitted in LEIRI, or if it is not a suitable IRI to use as input to the chosen resolution algorithm (for example, if it is a relative IRI reference, if it is a non-hierarchic URI, or <strong>if it contains a fragment identifier</strong>).</p>
</blockquote>
<p>(emphasis added by me)</p>
<p>What in the name of all things is that about? I've never noticed that before, and I haven't seen any other API (the URL API in Node and the browser for example) that cares.</p>
<p><code>resolve-uri('test.xml', 'http://example.com/path/file.xml#foo')</code> === <code>http://example.com/path/test.xml</code></p>
<p>I don't see why the presence of a fragment identifier should matter in the least.</p>
<p>e.g.</p>
<pre><code>&gt;&gt; let url = new URL("http://example.com/path/file.xml#foo")
&gt;&gt; console.log(url.href)
http://example.com/path/file.xml#foo
&gt;&gt; let resolved = new URL("test.xml", url);
&gt;&gt; console.log(resolved.href)
http://example.com/path/test.xml
</code></pre>
</div></details></div>
<div class="toot" id="closed-270"><h2>Issue #270 closed<span class="toot-id"> #closed-270</span></h2><div class="pubdate">30 Nov at 10:57:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/270">https://github.com/qt4cg/qtspecs/issues/270</a></div><p>Incorrect statement about named modes</p></div>
<div class="toot" id="closed-273"><h2>Issue #273 closed<span class="toot-id"> #closed-273</span></h2><div class="pubdate">30 Nov at 10:56:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/273">https://github.com/qt4cg/qtspecs/pull/273</a></div><p>Issue270 xslt mode visibility</p></div>
<div class="toot" id="created-279"><h2>Pull request #279 created<span class="toot-id"> #created-279</span></h2><div class="pubdate">29 Nov at 21:59:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/279">https://github.com/qt4cg/qtspecs/pull/279</a></div><details><summary>Rewrite XSLT §10.3.4 (function overriding) for clarity</summary><div class="markup"><p>Essentially editorial - clarifies the existing rules, as described in issue #277</p>
</div></details></div>
<div class="toot" id="created-278"><h2>Issue #278 created<span class="toot-id"> #created-278</span></h2><div class="pubdate">29 Nov at 17:16:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/278">https://github.com/qt4cg/qtspecs/issues/278</a></div><details><summary>array bound checking</summary><div class="markup"><p>Similar functions on arrays and sequences have different behaviour as regards bound checking. For example, fn:head() returns an empty sequence if the input is empty, while array:head() throws an error.</p>
<p>Sometimes we want the error, sometimes we don't, but this should be orthogonal to whether we are using sequences or arrays.</p>
<p>Is there a way we can adapt the sequence functions to throw an error, or adapt the array functions so they don't?</p>
<p>Various ideas have been put forward, including:</p>
<ul>
<li>add extra optional parameters to functions to select the behaviour</li>
<li>mirror the relevant functions (e.g. into a different namespace) to create an alternative version with different behaviour</li>
<li>add options to the static context (array-bound-checking=yes|no, sequence-bound-checking=yes|no) to switch the behaviour (with appropriate mechanisms in XQuery and XSLT -- and perhaps XPath -- to set these options)</li>
<li>do nothing, let users solve the problem for themselves by writing user-defined functions.</li>
</ul>
<p>Note 1: the difference in behaviour affects operators as well as functions: contrast <code>$seq[0]</code> (which returns ()) with <code>$array(0)</code> (throws error). Making <code>$seq[0]</code> throw an error would mean we have to define it in a different way, since the formulation <code>$seq[position()=$N]</code> is intrinsically error-free.</p>
<p>Note 2: if <code>$array(0)</code> doesn't throw an error, it's not immediately obvious what it should do. Returning an empty sequence isn't ideal because the empty sequence is a valid entry in an array. For maps we have the same problem, which is why we have two functions <code>map:get()</code> and <code>map:contains()</code>.</p>
</div></details></div>
<div class="toot" id="created-277"><h2>Issue #277 created<span class="toot-id"> #created-277</span></h2><div class="pubdate">29 Nov at 12:50:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/277">https://github.com/qt4cg/qtspecs/issues/277</a></div><details><summary>Overriding functions using xsl:import</summary><div class="markup"><p>In XSLT 3.0, you can have a module M that contains an xsl:function F#2, and in another module you can import M, and declare another xsl:function F#3.</p>
<p>In the 4.0 spec we appear to disallow this with the paragraph (in §10.3.4):</p>
<blockquote>
<p>A stylesheet function may be overridden by another stylesheet function with the same name that has higher [import precedence]. This is only allowed, however, if the [arity range] of the overriding function includes the totality of the arity range of the overridden function.</p>
</blockquote>
<p>In fact, the error conditions we go on to define (XTSE0769 and XTSE0770) are more carefully worded and do not make the above situation an error. XTSE0769 says that if F has higher import precedence than G, then either the arity ranges of F and G must be disjoint, or the arity range of F must include the totality of G. XTSE0770 says that if F and G have the same import precedence, then their arity ranges must be disjoint.</p>
<p>The paragraph cited should be replaced with:</p>
<blockquote>
<p>A stylesheet function may be overridden by another stylesheet function with the same name that has higher [import precedence]. This is only allowed, however, if either (a) the [arity range] of the overriding function includes the totality of the arity range of the overridden function, or (b) the two arity ranges are non-overlapping.</p>
</blockquote>
<p>There is also scope for editorial improvement to §10.3.4. It describes three separate scenarios:</p>
<p>(a) overriding functions using xsl:import and import precedence</p>
<p>(b) overriding functions using xsl:use-package and xsl:override</p>
<p>(c) overriding extension/external functions using xsl:function (or vice versa)</p>
<p>and it would be much easier to read the section if these were clearly distinguished.</p>
</div></details></div>
<div class="toot" id="closed-276"><h2>Issue #276 closed<span class="toot-id"> #closed-276</span></h2><div class="pubdate">27 Nov at 17:42:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/276">https://github.com/qt4cg/qtspecs/pull/276</a></div><p>Make './gradlew publish' work on Windows #255</p></div>
<div class="toot" id="closed-255"><h2>Issue #255 closed<span class="toot-id"> #closed-255</span></h2><div class="pubdate">27 Nov at 17:42:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/255">https://github.com/qt4cg/qtspecs/issues/255</a></div><p>Build error running gradlew publish on Windows</p></div>
<div class="toot" id="created-276"><h2>Pull request #276 created<span class="toot-id"> #created-276</span></h2><div class="pubdate">27 Nov at 17:37:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/276">https://github.com/qt4cg/qtspecs/pull/276</a></div><details><summary>Make './gradlew publish' work on Windows #255</summary><div class="markup"><p>Fix #255</p>
<p>Repeat after me, "filenames are not URIs." Not on some platforms, anyway.</p>
<p>I still get a warning about "correctness" because of the interaction between a couple of tasks. That doesn't happen on a *nix platform so I don't know if it's related to the difference between forward and backward slashes or if it's a consequence of the build changes I made to support the new SVG (that might be) in data model. They seem harmless for the moment.</p>
</div></details></div>
<div class="toot" id="created-275"><h2>Issue #275 created<span class="toot-id"> #created-275</span></h2><div class="pubdate">26 Nov at 22:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/275">https://github.com/qt4cg/qtspecs/issues/275</a></div><details><summary>Problems with nt/xnt links to grammar terms</summary><div class="markup"><p>I'm trying to work out why we're getting linking errors during the build when linking to grammatical terms.</p>
<p>In etc/XT40.xml (after changing extract.xsl to produce tidier namespace declarations, I'm seeing entries like:</p>
<pre><code>   &lt;nt def="doc-xpath40-SequenceType" xlink:type="simple"&gt;SequenceType&lt;/nt&gt;
   &lt;nt def="doc-xpath40-ItemType" xlink:type="simple"&gt;ItemType&lt;/nt&gt;
   &lt;nt def="doc-xpath40-OccurrenceIndicator" xlink:type="simple"&gt;OccurrenceIndicator&lt;/nt&gt;
   &lt;nt def="prod-xpath40-AnyItemTest" xlink:type="simple"&gt;AnyItemTest&lt;/nt&gt;
   &lt;nt def="doc-xpath40-TypeName" xlink:type="simple"&gt;TypeName&lt;/nt&gt;
   &lt;nt def="doc-xpath40-KindTest" xlink:type="simple"&gt;KindTest&lt;/nt&gt;
</code></pre>
<p>and the problem entries seem to be the ones prefixed "prod-" rather than "doc-".</p>
<p>The <code>extract.xsl</code> stylesheet simply copies what it finds in <code>xpath-assembled.xml</code>.</p>
<p>The decision seems to be made in <code>grammar2spec.xsl</code>, for example line 523 reads</p>
<p><code>&lt;xsl:param name="result_id_docprod_part"/&gt; &lt;!-- 'doc-' or 'prod-' --&gt;</code></p>
<p>The parameter is set to "prod-" in <code>add-non-terminals</code> (line 473) and in <code>add-terminals</code> (line 488), and is set to "doc-" in <code>show-prod</code> (line 513).</p>
<p>Looking more carefully, all productions listed in XT40.xml have a "prod-" entry (at least one...) and most of them also have a "doc-" entry. The problem cases are those that do not have a "doc-" entry. Which suggests that <code>show-prod</code> is not selecting them.</p>
<p>In a small number of cases, when processing the XSLT specification, the show-prod template is outputting the message</p>
<p><code>WARNING!! production with name="MapTest" not found</code></p>
<p>This is produced for MapTest, ArrayTest, EnumerationType, and NamedItemType. The problem here appears to be that the production is referenced in the XSLT spec but in the grammar file it is not shown with <code>if="xslt40-patterns"</code>, so it is not present in the pattern grammar.</p>
<p>For productions like AnyItemTest, the problem is different. It looks to me as if <code>show-prod</code> is not being called for these terms.</p>
<p><code>show-prod</code> is called from one place only: <code>assemble-spec.xsl</code> line 208. This is in a template rule with <code>match="prodrecap"</code></p>
<p>Sure enough, <code>AnyItemTest</code> does not appear to have a <code>prodrecap</code> in the XPath spec.</p>
</div></details></div>
<div class="toot" id="created-274"><h2>Issue #274 created<span class="toot-id"> #created-274</span></h2><div class="pubdate">26 Nov at 10:47:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/274">https://github.com/qt4cg/qtspecs/issues/274</a></div><details><summary>What would it take/would it be possible to build a module repository for QT?</summary><div class="markup"><p>We have an ever growing list of proposed convienence functions. I am not opposed, in principle, to adding convenience functions, but we don’t have any principled criteria (AFAICT) for which ones to add and which ones to reject. That’s not surprising, and I’m also not opposed to that. But I’m sure there are hundreds, perhaps thousands, of such functions. At some point, we’re going to start to resist adding more simply because we’ve added so many. Some of us may already be nearing that point.</p>
<p>It seems to me that the alternative is to do what TeX, Perl, Python, Node, etc. do: make it easy for users to download, install, and use libraries. (I’m carefully using the term “library” here where I might prefer to use “package” or “module” because we already have “package” and “module” which mean other things.)</p>
<p>What would it take to make that possible?</p>
<p>One problem we have is that there are two (perhaps three, or more, depending on how you count) different QT languages and they aren’t all mutually interoperable. My XSLT implementation of <code>fn:parse-uri</code> for example, isn’t directly usable by an XQuery product that doesn’t implement XSLT or some other product that only uses XPath.</p>
<p>Suppose we added an <code>import library</code> declaration to XPath, similar to the <code>import module</code> declaration in XQuery</p>
<pre><code>LibraryImport := "import" "library"
                   ("namespace" NCName "=")?
                   "at" URILiteral
</code></pre>
<p>and a corresponding <code>&lt;xsl:library&gt;</code> instruction to XSLT.</p>
<pre><code>&lt;xsl:library
  namespace = uri
  href = uri /&gt;
</code></pre>
<p>The semantics of each is that it searches an implementation-defined set of locations for a module that matches the URI. If it finds one, it loads the functions declared in that library. If a namespace is given, it loads only the functions in the namespace provided.</p>
<p>We’d expect all implementations to be able to load libraries that only used XPath constructions. An XSLT processor might also be able to load XSLT constructions. An XQuery processor might also be able to load XQuery constructions.</p>
<p>We could define a library file format that allowed an implementor to provide several different implementations of a function, where the processor could choose the best one (in some implementation-dependent way). This would also give us a place to hang version numbers and other relevant metadata.</p>
<p>With that much in place, would it be more practical to use XPath extension modules?</p>
<p>Consider the following scenario. I want to use a URI relativization function (as requested in #269). Dimitre provided a pure XPath implementation, so we don’t actually <em>have</em> to implement it as a native function, we just have to make it easy to use. Imagine that EXPath.org (for example) provided a machine readable list of of libraries.</p>
<p>I run a hypothetical “expath” command to search the machine readlabe directory.</p>
<pre><code>$ expath search relative
xpath uri-relativize -- returns the relative location between two URIs
xslt  doc-relative -- convenience functions for accessing “uncles”, “aunts”, etc.
xpath relative-rank -- funtions to score XML documents
</code></pre>
<p>It found three libraries that matched “relative”. That first one sounds promising.</p>
<pre><code>$ expath show uri-relativize
The uri-relativize library provides uri-relativize(), an XPath
function that resolves one absolute URI relative to another.
</code></pre>
<p>That sounds like what I want, so I install it.</p>
<pre><code>$ expath install uri-relativize
Downloading uri-relativize … installing … done.
</code></pre>
<p>Then in my stylesheet I simply add</p>
<pre><code>&lt;xsl:library href="uri-relativize"/&gt;
</code></pre>
<p>Or in a language that only uses XPath, I add</p>
<pre><code>import library at "uri-relativize"
</code></pre>
<p>and I can use the <code>uri-relativize()</code> function.</p>
<p>I think the important parts are that the implementation searches for libraries so that I don’t have to identify precisly where they were installed and that we somehow make it practical to use them without, though it pains me to say this, explicit namespace bindings.</p>
<p>Perhaps we could allow libraries to “inject” functions into the default function namespace, or we could have a function namespace search list and maybe libraries could extend that.</p>
<p>The format of the library might be something like this:</p>
<pre><code>&lt;library xmlns="xpath-library" name="uri-relativize" version="1.0.3"
         namespace="http://example.com/my/namespace"&gt;
&lt;provides&gt;
function uri-relativize($path1 as xs:anyURI, $path2 as xs:anyURI) as xs:anyURI
&lt;/provides&gt;
&lt;xpath version="3.0"&gt;
…xpath implementation…
&lt;/xpath&gt;
&lt;xslt version="4.0"&gt;
…xslt 4.0 implementation…
&lt;/xslt&gt;
&lt;xslt version="3.0"&gt;
…xslt 3.0 implementation…
&lt;/xslt&gt;
&lt;library&gt;
</code></pre>
<p>But I’m sure if we looked closely at the metadata provided in other system’s packages, we’d see I’ve left a bunch of stuff out. You’d probably, for example, want some way of saying one package depends on another and having the processor load those automatically.</p>
</div></details></div>
<div class="toot" id="created-273"><h2>Pull request #273 created<span class="toot-id"> #created-273</span></h2><div class="pubdate">25 Nov at 18:09:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/273">https://github.com/qt4cg/qtspecs/pull/273</a></div><details><summary>Issue270 xslt mode visibility</summary><div class="markup"><p>This PR fixes issue #270 concerning the visibility of XSLT modes.</p>
<p>It also deals with a lot of editorial issues, some highlighted in issue #275.</p>
<p>It changes the manual change markup in the XSLT spec to use <code>at-"date"</code> format rather than <code>at="draft-number"</code> (dates are more useful for the incremental development process we are following). And it fixes some cross-spec-reference issues, and some violations of hyphenation diktats.</p>
<p>Also bundled with this bug fix are other editorial changes to fix cross-spec linking errors; for details see the individual commit messages.</p>
</div></details></div>
<div class="toot" id="agenda-11-29"><h2>QT4 CG meeting 013 draft agenda<span class="toot-id"> #agenda-11-29</span></h2><div class="pubdate">25 Nov at 14:32:27 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-29">https://qt4cg.org/meeting/agenda/2022/11-29</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-272"><h2>Issue #272 created<span class="toot-id"> #created-272</span></h2><div class="pubdate">25 Nov at 10:14:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/272">https://github.com/qt4cg/qtspecs/issues/272</a></div><details><summary>Setting parameter values in xsl:use-package</summary><div class="markup"><p>It's possible for two different components of an application to use the same library package (via <code>xsl:use-package</code>) and in principle each of them should be able to configure that package (by setting its global parameters) in different ways. Currently though it's not at all clear how the global parameters of a used package should be set (and there are some inconsistencies in the spec concerning how the <code>visibility</code> attribute on such parameters is supposed to work).</p>
<p>I think that it's fairly straightforward to plug this gap by allowing xsl:use-package to have xsl:with-param children, naming the stylesheet parameters in the used package and assigning them values. For static parameters the values must be assigned using static expressions; for non-static parameters any expression can be used: because of the scoping rules and the syntactic constraints on <code>xsl:use-package</code>, the value of the expression can only depend on global variable and parameters in the using stylesheet package.</p>
</div></details></div>
<div class="toot" id="created-271"><h2>Pull request #271 created<span class="toot-id"> #created-271</span></h2><div class="pubdate">24 Nov at 16:10:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/271">https://github.com/qt4cg/qtspecs/pull/271</a></div><details><summary>Amendments to data model spec as per minutes of 2022-11-22</summary><div class="markup"><p>Changes to data model spec, see actions QT4CG-012-01, -02, -03, -04, -06.</p>
</div></details></div>
<div class="toot" id="created-270"><h2>Issue #270 created<span class="toot-id"> #created-270</span></h2><div class="pubdate">24 Nov at 13:56:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/270">https://github.com/qt4cg/qtspecs/issues/270</a></div><details><summary>Incorrect statement about named modes</summary><div class="markup"><p>On the description of the 'visibility' attribute <a href="https://qt4cg.org/specifications/xslt-40/Overview-diff.html#declaring-modes">here</a> it says:</p>
<blockquote>
<p>A named mode is not eligible to be used as the <a href="https://qt4cg.org/specifications/xslt-40/Overview-diff.html#dt-initial-mode">initial mode</a> if its visibility is private.</p>
</blockquote>
<p>But, if the mode is designated as default mode of the implicit or explicit <code>xsl:package</code> then it's eligible as an initial mode. Having a private visibility does not affect it's initial status. Furthermore, the unnamed mode is always private, and always initial.</p>
</div></details></div>
<div class="toot" id="created-269"><h2>Issue #269 created<span class="toot-id"> #created-269</span></h2><div class="pubdate">24 Nov at 13:20:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/269">https://github.com/qt4cg/qtspecs/issues/269</a></div><details><summary>Function for URI relativization</summary><div class="markup"><p>Signature:</p>
<pre><code class="language-xq">relativize($uri as xs:anyURI, $base as xs:anyURI) as xs:anyURI
</code></pre>
<p>Example: <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URI.html#relativize(java.net.URI)">URI::relativize</a> in Java</p>
</div></details></div>
<div class="toot" id="created-268"><h2>Pull request #268 created<span class="toot-id"> #created-268</span></h2><div class="pubdate">24 Nov at 10:28:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/268">https://github.com/qt4cg/qtspecs/pull/268</a></div><details><summary>New type-hierarchy images / descriptions</summary><div class="markup"><p>Close #265</p>
<p>This is my attempt to improve the type-hierarchy images.</p>
<ol>
<li>There <em>were</em> graphics already, but they were accidentally not being copied into the right place.</li>
<li>But, they're for 3.1 and they're in some format I don't recognize, so</li>
<li>I created new SVG ones anyway, that folks may or may not like</li>
<li>I replaced the big, ugly yellow tables with prose. I concluded that accessibility was the only reason they were present.</li>
<li>The colors are a little different, and a little "off", but they're explicitly chosen from a pallet that offers unambiguously differenty colors for the three most common forms of color-blindness.</li>
<li>One of the SVG images is too wide, I'm not sure what to do about that</li>
<li>The labels are text, so you can search for them, and xs:anyAtomicType is a link. We could make more links.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-267"><h2>Issue #267 closed<span class="toot-id"> #closed-267</span></h2><div class="pubdate">24 Nov at 10:16:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/267">https://github.com/qt4cg/qtspecs/pull/267</a></div><p>Stylesheet updates for inline-SVG in the data model</p></div>
<div class="toot" id="created-267"><h2>Pull request #267 created<span class="toot-id"> #created-267</span></h2><div class="pubdate">24 Nov at 10:08:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/267">https://github.com/qt4cg/qtspecs/pull/267</a></div><details><summary>Stylesheet updates for inline-SVG in the data model</summary><div class="markup"><p>I need to commit this first, and separately, so that the build will be correct.</p>
<p>Also fixed an obvious CSS typo.</p>
</div></details></div></div><p>See 38
            more statuses in yearly archives.</p></article></main></body></html>