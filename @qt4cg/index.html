<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2023/">2023</a>, <a href="2022/">2022</a></p><div class="toots">
<div class="toot" id="minutes-01-17"><h2>QT4 CG meeting 018 draft minutes<span class="toot-id"> #minutes-01-17</span></h2><div class="pubdate">17 Jan at 16:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-17">https://qt4cg.org/meeting/minutes/2023/01-17</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-286"><h2>Issue #286 closed<span class="toot-id"> #closed-286</span></h2><div class="pubdate">17 Jan at 17:14:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/286">https://github.com/qt4cg/qtspecs/pull/286</a></div><p>Spec changes to allow child::(a|b|c) - Issue 107</p></div>
<div class="toot" id="closed-290"><h2>Issue #290 closed<span class="toot-id"> #closed-290</span></h2><div class="pubdate">17 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/290">https://github.com/qt4cg/qtspecs/pull/290</a></div><p>Fix issue #18 (function type hierarchy)</p></div>
<div class="toot" id="closed-288"><h2>Issue #288 closed<span class="toot-id"> #closed-288</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/288">https://github.com/qt4cg/qtspecs/issues/288</a></div><p>Error in fn:path specification</p></div>
<div class="toot" id="closed-291"><h2>Issue #291 closed<span class="toot-id"> #closed-291</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/291">https://github.com/qt4cg/qtspecs/issues/291</a></div><p>DTD validity of F&amp;O spec</p></div>
<div class="toot" id="closed-304"><h2>Issue #304 closed<span class="toot-id"> #closed-304</span></h2><div class="pubdate">17 Jan at 17:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><p>Mike's content changes from PR 292</p></div>
<div class="toot" id="closed-284"><h2>Issue #284 closed<span class="toot-id"> #closed-284</span></h2><div class="pubdate">17 Jan at 17:12:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><p>Add grammar for "if (test) then {expr}" with no else</p></div>
<div class="toot" id="created-308"><h2>Pull request #308 created<span class="toot-id"> #created-308</span></h2><div class="pubdate">15 Jan at 17:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><details><summary>Improve the legends in the diagrams</summary><div class="markup"><p>This PR completes my action QT4CG-015-03: NW to make sure the direction of the arrow is in the legends</p>
<p>I also made sure the legends aren't too wide. I still have more work to do for the other actions.</p>
</div></details></div>
<div class="toot" id="agenda-01-17"><h2>QT4 CG meeting 018 draft agenda<span class="toot-id"> #agenda-01-17</span></h2><div class="pubdate">15 Jan at 15:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-17">https://qt4cg.org/meeting/agenda/2023/01-17</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-306"><h2>Issue #306 closed<span class="toot-id"> #closed-306</span></h2><div class="pubdate">15 Jan at 16:17:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><p>fn:char - editors actions from 2023-01-10</p></div>
<div class="toot" id="created-307"><h2>Issue #307 created<span class="toot-id"> #created-307</span></h2><div class="pubdate">15 Jan at 15:42:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><details><summary>Parsing and building URIs comments and queries</summary><div class="markup"><ol>
<li>fn:build-uri states:</li>
</ol>
<blockquote>
<p>If the scheme key is present in the map, the URI begins with the value of that key concatenated with //, otherwise it begins //.</p>
</blockquote>
<p>a. Shouldn't the concatenation be <code>://</code> so e.g. <code>http</code> becomes <code>http://</code>?
b. How are non-heirarchical schemes handled like <code>urn</code>, and <code>mailto</code>?</p>
<ol start="2">
<li>RFC 3986 allows IPv6 and IPvFuture addresses that contain <code>:</code> characters, e.g. <code>http://[::1]:80</code>.</li>
</ol>
<p>My understanding of fn:parse-uri is that this will fail to parse.</p>
<ol start="3">
<li>RFC 3986 states that for userinfo, the <code>user:password</code> form is deprecated.</li>
</ol>
<p>Browsers will reject this due to the security risk, and the RFC suggests that applications should not render the password (the part after the <code>:</code>) in clear text. -- Should fn:build-uri follow suite, or (along with fn:parse-uri) have an option to control the behaviour (keep, remove, invalid), where if the option is invalid, it will throw an fn:error?</p>
<ol start="4">
<li>RFC 3986 suggests that the port should be omitted if it matches the default for the scheme</li>
</ol>
<p>Should fn:build-uri have this behaviour?</p>
</div></details></div>
<div class="toot" id="created-306"><h2>Pull request #306 created<span class="toot-id"> #created-306</span></h2><div class="pubdate">10 Jan at 21:23:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><details><summary>fn:char - editors actions from 2023-01-10</summary><div class="markup"><p>Changes to the new fn:char function (issue #121) as follows:</p>
<ul>
<li>Action QT4CG-017-01 clarifies the definition of formats #nnn and #xnnn.</li>
<li>Action QT4CG-017-02 changes the order of the rules</li>
<li>In discussion it was asked whether any HTML5 entity names refer to strings comprising more than one character. On investigation it appears that they do, and the spec has been revised to allow for this.</li>
<li>added history/status information</li>
</ul>
</div></details></div>
<div class="toot" id="minutes-01-10"><h2>QT4 CG meeting 017 draft minutes<span class="toot-id"> #minutes-01-10</span></h2><div class="pubdate">10 Jan at 16:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-10">https://qt4cg.org/meeting/minutes/2023/01-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-305"><h2>Issue #305 created<span class="toot-id"> #created-305</span></h2><div class="pubdate">09 Jan at 17:50:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/305">https://github.com/qt4cg/qtspecs/issues/305</a></div><details><summary>parse-xml() and whitespace stripping</summary><div class="markup"><p>There seems to be nothing in either the XSLT spec or in F+O that says explicitly whether stylesheet-defined space stripping rules (xsl:strip-space and xsl:preserve-space) apply to documents loaded using <code>fn:parse-xml</code> (or, by extension, <code>parse-html</code>).</p>
<p>The spec says that these rules apply to "source trees" defined as "any tree provided as input to the transformation. This includes the document containing the [global context item] if any, documents containing nodes present in the [initial match selection], documents containing nodes supplied as the values of [stylesheet parameters], documents obtained from the results of functions such as [document], [doc], and [collection]...".</p>
<p>I guess one reasonable interpretation is that the "such as" includes <code>parse-xml()</code>. But it goes rather against the grain that the behaviour of parse-xml() should be affected by the containing stylesheet declarations, when there is no mention of such a context-dependency in the function specification; in this, parse-xml() is rather different from doc() which deliberately says very little about how the XDM instance returned relates to the URI supplied as input.</p>
</div></details></div>
<div class="toot" id="closed-292"><h2>Issue #292 closed<span class="toot-id"> #closed-292</span></h2><div class="pubdate">09 Jan at 09:43:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><p>Merge signatures with optional params</p></div>
<div class="toot" id="created-304"><h2>Pull request #304 created<span class="toot-id"> #created-304</span></h2><div class="pubdate">09 Jan at 09:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><details><summary>Mike's content changes from PR 292</summary><div class="markup"><p>I teased apart some of the omnibus PR #292. I've commited the schema and stylesheet changes. This PR covers the remaining prose changes.</p>
<p>Mike writes:</p>
<blockquote>
<p>I regret that this has turned into a bit of an omnibus PR. The main changes are:</p>
<ul>
<li>Fix validity issues with the function catalog and its schema (Issue 291)</li>
<li>Convert all functions to use a single signature with optional parameters (Issue 70)</li>
<li>Extend the function catalog to handle record definitions (Issue 257)</li>
<li>Fix the (trivial) bug with properties of fn:path (Issue 288)</li>
<li>Add introductory text concerning the handling of operators (Issue 35)</li>
</ul>
</blockquote>
<p>Fix #291
Fix #70
Fix #257
Fix #288
Fix #35</p>
</div></details></div>
<div class="toot" id="closed-303"><h2>Issue #303 closed<span class="toot-id"> #closed-303</span></h2><div class="pubdate">09 Jan at 07:38:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><p>Mike's proposed schema and stylesheet changes</p></div>
<div class="toot" id="created-303"><h2>Pull request #303 created<span class="toot-id"> #created-303</span></h2><div class="pubdate">09 Jan at 07:32:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><details><summary>Mike's proposed schema and stylesheet changes</summary><div class="markup"><p>These are the schema and stylesheet changes from PR #292. They don't break the build and on casual inspection they seem fine, so I'm just going to accept them.</p>
</div></details></div>
<div class="toot" id="agenda-01-10"><h2>QT4 CG meeting 017 draft agenda<span class="toot-id"> #agenda-01-10</span></h2><div class="pubdate">06 Jan at 16:02:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-10">https://qt4cg.org/meeting/agenda/2023/01-10</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-300"><h2>Issue #300 created<span class="toot-id"> #created-300</span></h2><div class="pubdate">06 Jan at 16:19:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><details><summary>[F+O] Ambiguity regarding Unicode normalization (editorial)</summary><div class="markup"><p>In §1.7.1 the paragraph</p>
<blockquote>
<p>Unless explicitly stated, the xs:string values returned by the
functions in this document are not normalized in the sense of
[Character Model for the World Wide Web 1.0: Fundamentals].</p>
</blockquote>
<p>is a little bit ambiguous for my taste. By "are not normalized" it means "no action is taken to normalize the strings", it doesn't mean "the strings will not be in normalized form".</p>
<p>I suggest: "Unless explicitly stated, the functions in this document operate on strings as sequences of codepoints and do not attempt to convert input strings, or produce output strings, in Unicode normalized form. Unicode normalization occurs only when explicitly requested, for example by use of the <code>fn:normalize-unicode</code> function."</p>
<p>At the same time we might update the reference to point to "Character Model for the World Wide Web: String Matching", revised in 2021, though it is still only a Working Group Note. See https://www.w3.org/TR/charmod-norm/#unicodeNormalization</p>
</div></details></div>
<div class="toot" id="closed-281"><h2>Issue #281 closed<span class="toot-id"> #closed-281</span></h2><div class="pubdate">02 Jan at 18:12:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><p>XPath: Short-circuiting Functions and Lazy Evaluation Hints</p></div>
<div class="toot" id="created-299"><h2>Issue #299 created<span class="toot-id"> #created-299</span></h2><div class="pubdate">02 Jan at 18:08:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/299">https://github.com/qt4cg/qtspecs/issues/299</a></div><details><summary>Short-circuiting functions, function-arity guards and lazy hints</summary><div class="markup"><h1><strong>I. Shortcutting and lazy hints</strong></h1>
<p>Let us have this expression:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }
  return
    $f($x) ($y)
</code></pre>
<p>Evaluating&nbsp;<strong><code>$f($x)</code></strong>&nbsp;produces a function. The&nbsp;<strong>actual arity</strong>&nbsp;of this resulting function can be any number&nbsp;<strong><code>N &gt;= 0</code></strong> :</p>
<ul>
<li>
<p>If&nbsp;<strong><code>N &gt; 1</code></strong>&nbsp;there would be arity mismatch error, as only one argument&nbsp;<code>$y</code>&nbsp;is provided in the expression.</p>
</li>
<li>
<p>If&nbsp;<strong><code>N = 1</code></strong>&nbsp;the final function call can be evaluated, and the argument&nbsp;<code>$y</code>   must be evaluated,  or</p>
</li>
<li>
<p><strong>If <code>N = 0</code>, then  <code>$y</code> is unneeded and can safely be ignored</strong> according to the updated <strong>“<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>”</strong> in Xpath 4.0.</p>
</li>
</ul>
<p><strong>Because a possibility exists to be able to ignore the evaluation of&nbsp;<code>$y</code>, it is logical to delay the evaluation of&nbsp;<code>$y</code>&nbsp;until the actual arity of&nbsp;<code>$f($x)</code>&nbsp;is known</strong>.</p>
<p>The current XPath 4.0 evaluation rules do not require an implementation to base its decision whether or not to evaluate&nbsp;<code>$y</code> on the actual arity of the function produced by <code>$f($x)</code>, thus at present an implementation could decide to evaluate <code>$y</code> regardless of the actual arity of the function produced by <code>$f($x)</code>.</p>
<p><strong>This is where a&nbsp;<em>lazy</em>&nbsp;hint comes</strong>: it indicates to the XPath processor that <em><strong>it is logical to make the decision about evaluation of&nbsp;<code>$y</code>&nbsp;based on the actual arity of the function returned by&nbsp;<code>$f($x)</code></strong></em>.</p>
<p>A rewrite of the above expression using a <strong><em><em>lazy</em></em></strong>&nbsp;hint looks like this:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }  
  return
    $f($x) (lazy $y)
</code></pre>
<p>Here is one example of a function with short-cutting and calling it with a <strong><em>lazy</em></strong> hint:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
             {
                let $partial := function($x as xs:boolean) as function(xs:boolean) as  xs:boolean
                                {
                                  if(not($x)) then -&gt;(){false()}
                                              else -&gt;($t) {$t}
                                }
                 return $partial($x)($y)
             }
  return
     $fAnd($x (: possibly false() :), lazy&nbsp;$SomeVeryComplexAndSlowComputedExpression)
</code></pre>
<p><strong>Without the <strong><em>lazy</em></strong>&nbsp;hint in the above example, it is perfectly possible that an XPath implementation, unrestricted by the current rules, would evaluate <em><code>$SomeVeryComplexAndSlowComputedExpression</code></em> - something that is unneeded and could be avoided completely</strong>.</p>
<h2>Formal syntax and semantics</h2>
<ol>
<li>
<p>The <strong><em>lazy</em></strong> keyword should immediately precede any argument in a function call. If specified, it means that <strong><em>it is logical to make the decision about evaluation of&nbsp;this argument&nbsp;based on the actual arity of the function in this function call</em></strong>.</p>
<p>Based on this definition, it follows that <strong><em><code>lazy $argK</code></em></strong> implies <strong><em>lazy</em></strong> for all arguments following <code>$argK</code> in the function call. Thus specifying more than one <strong><em>lazy</em></strong> hint within a given function call is redundant and an implementation may report this redundancy to the user.</p>
<p>The scope of a <strong><em>lazy</em></strong> keyword specified on an argument is this and all following arguments of (only) the current function call.</p>
</li>
<li>
<p>It is possible to specify a <strong><em>lazy</em></strong> keyword that is in force for the respective argument(s) of all function calls of the given function. To do this, the <strong><em>lazy</em></strong> keyword must  be  specified immediately preceding a parameter name in the function definition of that function.</p>
<p>For example, if the function <strong><code>$f</code></strong> is specified as:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, lazy $arg2 as item()*, $arg3 as item()*, $arg4 as item()* ) 
          { (: some code here:) }
  return
     $someExpression
</code></pre>
<p>Then any call of <strong><code>$f</code></strong> in its definition scope that has the form:</p>
<pre><code class="language-xq">$f($x, $y, $z, $t)
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-xq">$f($x, lazy $y, $z, $t)
</code></pre>
</li>
</ol>
<h1><strong>II. A function's arity is a guard for its arguments</strong></h1>
<p>Let us have a  function <strong><code>$f</code></strong> defined as below:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*, …, $argN as item()*)
   as function(item()*, item()*, …, item()*) as item()*
     {
       if($cond0($arg1))       then -&gt; () { 123 }
        else if($cond1($arg1)) then -&gt; ($Z1 as item()*) {$Z1}
        else if($cond2($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*) {$Z1 + $Z2}
        (:    .        .        .        .         .        .        .         .  :)
        else if($condK($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*, …, $Zk as item()*)
                                       {$Z1 + $Z2 + … + $Zk}
        else ()
     }
  return
     $f($y1, $y2, …, $yN) ($z1, $z2, …, $zk)
</code></pre>
<p>A call to <strong><code>$f</code></strong> returns a function whose arity may be any of the numbers: 0, 1, …, K.</p>
<p>Depending on the arity of the returned function (0, 1, …, K), the last (K, K-1,  K-2, …, 2, 1, 0) arguments of the function call:</p>
<p><strong><em><code>$f($y1, $y2,  .  .  . , $yN) ($z1, $z2, .  .  . , $zk)</code></em></strong></p>
<p><strong>are unneeded and it is logical that they would not need to be evaluated</strong>.</p>
<p><strong>So, the actual arity of the result of calling <strong><code>$f</code></strong> is a guard for the arguments of a call to this function-result</strong>.</p>
<p>Thus, one more bullet needs to be added to [2.4.5 Guarded Expressions] https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-guarded-expressions), specifying an additional guard-type:</p>
<ul>
<li>In an expression of the type&nbsp;<code>E(A1, A2, ..., AN)</code>&nbsp;any of the arguments&nbsp;<code>A</code><sub>K</sub>&nbsp;is guarded by the condition&nbsp;
<code>actual-arity(E) ge K</code>. This rule has the consequence that if the actual arity of&nbsp;<code>E()</code>&nbsp;is less than&nbsp;<code>K</code>&nbsp;then if any argument&nbsp;<code>Am</code> (where <code>m &gt;= K</code>)&nbsp;is evaluated, this must not raise a dynamic error. An implementation may base on the actual arity of&nbsp;<code>E()</code> its decision for the evaluation of the arguments.</li>
</ul>
</div></details></div>
<div class="toot" id="created-298"><h2>Issue #298 created<span class="toot-id"> #created-298</span></h2><div class="pubdate">02 Jan at 15:36:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/298">https://github.com/qt4cg/qtspecs/issues/298</a></div><details><summary>Abstract supertype for map and array</summary><div class="markup"><p>I've been wondering whether there would be any mileage in introducing an abstract super type for map() and array(), perhaps called lookup(). This would basically treat an array as a map with integer keys.</p>
<p>This would allow a cleaner type signature for map:find() and any future functions such as xx:search() that work both on maps and arrays. It might simplify the description of the lookup operator "?". For functions that already exist in both the map and array namespaces, such as get(), we could introduce a unified function in the fn namespace with the cosmetic benefit of reducing the need for namespace prefixes and namespace declarations.</p>
<p>I'm still keen to find a better way of doing iteration, filtering, mapping, and construction of maps and arrays, and I think this might be a useful stepping stone.</p>
</div></details></div>
<div class="toot" id="created-297"><h2>Issue #297 created<span class="toot-id"> #created-297</span></h2><div class="pubdate">28 Dec at 23:51:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/297">https://github.com/qt4cg/qtspecs/issues/297</a></div><details><summary>Lookup in deeply nested JSON, an abbreviated syntax for map:find</summary><div class="markup"><p>In XML, you can select all X nodes with an abbreviated syntax //X</p>
<p>There is no abbreviated syntax for JSON</p>
<p>I propose to add a ?? syntax. Like / is doubled for //, it doubles the ? lookup operator.</p>
<p>The syntax is basically the same as for ?:</p>
<p>[200]  UnaryLookupRecursion  ::=  "??"  KeySpecifier
[143]  LookupRecursion ::=  "??"  KeySpecifier
[144]  KeySpecifier |::=  NCName  |  IntegerLiteral  |  StringLiteral  |  VarRef  |  ParenthesizedExpr  |  "*"</p>
<p>For the semantic it can call map:find, except for * and varref:</p>
<p>Unary variant:</p>
<pre><code>??"string"    becomes map:find(. , "string")
??NCName      becomes map:find( ., "NCName")
??123         becomes map:find(., 123)

??*           Recursively every member/value of every array/map underneath .
              E.g. for `[{"a": {"x": 123}}, 456]`: `{"a": {"x": 123}}, {"x": 123}, 123, 456`

??$varref     calls ?$varref on every nested array/map.
              Like (.,??*)?$varref   (except for type errors)
</code></pre>
<p>Postfix variant:</p>
<p><code>E??S</code>   would be <code>E!??S</code> if it is atomic, or <code>let $s := data(S) return E!??$s</code> if S is parenthesized</p>
<p>This probably conflicts with #171</p>
</div></details></div>
<div class="toot" id="created-296"><h2>Issue #296 created<span class="toot-id"> #created-296</span></h2><div class="pubdate">22 Dec at 10:44:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/296">https://github.com/qt4cg/qtspecs/issues/296</a></div><details><summary>Default namespace for elements; especially in the context of HTML</summary><div class="markup"><p>There can be little doubt that the fact that an unprefixed name in XPath fails to select an unprefixed element in the source document is one of the major gotcha's, causing massive bewilderment to all newbie users.</p>
<p>The XPath 2.0 solution of using a default element namespace in the static context is a partial solution; its main drawback is that it doesn't help the newbies who didn't know about the problem or its solution.</p>
<p>The HTML "living standard" introduces a "wilful violation" of the XPath 1.0 spec to address the issue. Given that most elements in an HTML DOM will be in the XHTML namespace, it states:</p>
<blockquote>
<p>If the QName has no prefix and the principal node type of the axis is element, then the default element namespace is used. Otherwise if the QName has no prefix, the namespace URI is null. The default element namespace is a member of the context for the XPath expression. The value of the default element namespace when executing an XPath expression through the DOM3 XPath API is determined in the following way:</p>
</blockquote>
<blockquote>
<p>If the context node is from an HTML DOM, the default element namespace is "http://www.w3.org/1999/xhtml".
Otherwise, the default element namespace URI is null.</p>
</blockquote>
<p>It then adds a note which is blatantly untrue:</p>
<blockquote>
<p>This is equivalent to adding the default element namespace feature of XPath 2.0 to XPath 1.0, and using the HTML namespace as the default element namespace for HTML documents. It is motivated by the desire to have implementations be compatible with legacy HTML content while still supporting the changes that this specification introduces to HTML regarding the namespace used for HTML elements, and by the desire to use XPath 1.0 rather than XPath 2.0.</p>
</blockquote>
<p>Since the XPath 2.0 facility picks up the default namespace from the static context, while the HTML "wilful violation" picks it up dynamically from a property of the context node (namely "being from an HTML DOM") there is no way these can be considered equivalent.</p>
<p>(Note also, there's a significant ambiguity in the "wilful violation" rules: what exactly is the "context node" that determines this behaviour? I think they're suggesting it is the context node at the point of XPath API invocation, not the context node for the specific axis step. This makes it rather unclear how the rule is supposed to apply to XSLT. And: if an XSLT stylesheet creates a temporary tree with nodes in the XHTML namespaces, do we consider those nodes as being "from an HTML DOM"?)</p>
<p>Nevertheless, the intent of the "violation" is worthy, and it would be nice if we can find a solution to this problem that works both for HTML and for other vocabularies.</p>
<p>Our current proposal for fn:parse-html is that HTML elements should go in the XHTML namespace and this means that users familiar with XPath 1.0 implementations in the browser will trip over this problem. A lot.</p>
</div></details></div>
<div class="toot" id="created-295"><h2>Issue #295 created<span class="toot-id"> #created-295</span></h2><div class="pubdate">20 Dec at 23:43:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/295">https://github.com/qt4cg/qtspecs/issues/295</a></div><details><summary>Extend support for self-reference in record types</summary><div class="markup"><p>We currently allow a field in a record to have type "..", that is, the same type as the containing record definition.</p>
<p>This isn't good enough for the fn:random-number-generator, where we need something like:</p>
<pre><code>random-number-generator-record:
record(
   number as&nbsp;xs:double,
   next as&nbsp;function() as #random-number-generator-record,
   permute as&nbsp;function(item()*) as item()*,
   *,
)

</code></pre>
<p>There are two ways we could tackle this. We could extend the syntax to allow ".." here, so it becomes
<code>next as&nbsp;function() as ..</code> Or we could allow named item types to refer to themselves:</p>
<pre><code>&lt;xsl:item-type name="random-number-generator-record"
   as="record(
   number as&nbsp;xs:double,
   next as&nbsp;function() as type(random-number-generator-record),
   permute as&nbsp;function(item()*) as item()*,
   *,
)"&gt;

</code></pre>
<p>We haven't really reviewed the proposal for named item types. It's easy enough to declare them in XQuery and XSLT (and not really very difficult to define the rules under which self-referential definitions are allowed). Free-standing XPath is a bit more of a problem.</p>
</div></details></div>
<div class="toot" id="minutes-12-20"><h2>QT4 CG meeting 016 draft minutes<span class="toot-id"> #minutes-12-20</span></h2><div class="pubdate">20 Dec at 17:26:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/12-20">https://qt4cg.org/meeting/minutes/2022/12-20</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-294"><h2>Issue #294 created<span class="toot-id"> #created-294</span></h2><div class="pubdate">20 Dec at 15:48:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/294">https://github.com/qt4cg/qtspecs/issues/294</a></div><details><summary>fn:remove removing multiple items</summary><div class="markup"><p><code>map:remove</code> and <code>array:remove</code> take a list of keys/positions to be removed; fn:remove only accepts one. I propose changing <code>fn:remove</code> to bring it into line.</p>
<p>Without this, removing multiple items is tricky because removing one item changes the positions of the others.</p>
<p>Example use case:</p>
<pre><code>let $p := index-where($persons -&gt;{@status='retired'))
return $persons =&gt; remove($p)
</code></pre>
<p>(Of course, this could always be done with a filter. But removing a small number of items from a large sequence might be more efficient than a filter)</p>
</div></details></div>
<div class="toot" id="created-293"><h2>Issue #293 created<span class="toot-id"> #created-293</span></h2><div class="pubdate">19 Dec at 20:14:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/293">https://github.com/qt4cg/qtspecs/issues/293</a></div><details><summary>Error in fn:doc-available specification</summary><div class="markup"><p>Observed on the XML.com slack (Oct 6 2022):</p>
<p>A rule in the XQFO 3.1 specification seems to be inconsistent. In the error summary, it’s stated that:</p>
<blockquote>
<p><code>err:FODC0005</code>, Invalid argument to fn:doc or fn:doc-available. Raised (optionally) by <code>fn:doc</code> and <code>fn:doc-available</code> if the argument is not a valid URI reference.</p>
</blockquote>
<p>The rules for <code>fn:doc-available</code> say: “[…] In all other cases this function returns false. This includes the case where an invalid URI is supplied, and also the case where a valid relative URI reference is supplied, and cannot be resolved, for example because the static base URI is absent.”</p>
</div></details></div>
<div class="toot" id="created-292"><h2>Pull request #292 created<span class="toot-id"> #created-292</span></h2><div class="pubdate">19 Dec at 18:43:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><details><summary>Merge signatures with optional params</summary><div class="markup"><p>This addresses issue #291, concerned with the validity of function-catalog.xml against its XSD schema, and the validity of the intermediate file xpath-functions-40.xml against the xmlspec DTD (as amended for QT).</p>
<p>It also fixes the trivial error raised in issue #288, and addresses issue #70 by making each function have a single prototype with default values where appropriate. (This is not purely an editorial change, it enables you for example to supply () as the $length argument of fn:substring).</p>
<p>There's more work on issue #257 (editorial improvements to handling of named record types).</p>
<p>This commit is mainly for technical review by NDW. It combines changes to the stylesheets, schema, and content, and may therefore require picking apart before it can be applied.</p>
</div></details></div></div><p>See 82
            more statuses in yearly archives.</p></article></main></body></html>