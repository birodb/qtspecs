<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2023</title></head><body><main><article><h1>@qt4cg statuses in 2023</h1><p>This page displays status
              updates
              about the QT4 CG project from 2023.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="minutes-03-14"><h2>QT4 CG meeting 026 draft minutes<span class="toot-id"> #minutes-03-14</span></h2><div class="pubdate">14 Mar at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-14">https://qt4cg.org/meeting/minutes/2023/03-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-396"><h2>Pull request #396 created<span class="toot-id"> #created-396</span></h2><div class="pubdate">13 Mar at 18:04:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/396">https://github.com/qt4cg/qtspecs/pull/396</a></div><details><summary>Deep-equal, no failure when comparing functions</summary><div class="markup"><p>Refines the spec of fn:deep-equal so it no longer fails when comparing function items, rather it returns a result which in general is implementation-dependent, though it must be false unless the functions are provably equivalent.</p>
</div></details></div>
<div class="toot" id="created-395"><h2>Pull request #395 created<span class="toot-id"> #created-395</span></h2><div class="pubdate">13 Mar at 11:50:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/395">https://github.com/qt4cg/qtspecs/pull/395</a></div><details><summary>Make the (non-)hierarchical nature of URIs explicit</summary><div class="markup"><p>The <code>fn:parse-uri</code> function will parse hierarchical or non-hierarchical URIs, however, the parse cannot be reversed if the <code>fn:build-uri</code> function doesn't know whether the scheme is hierarchical. Consider <code>fn:parse-uri("querty:abc")</code>:</p>
<pre><code>map {
  "path":"abc",
  "scheme":"querty",
  "path-segments":["abc"],
  "uri":"querty:abc"
}
</code></pre>
<p>When <code>fn:build-uri</code> parses that map, it produces: <code>querty://abc</code> because the scheme is not known to be non-hierarchical.</p>
<p>This PR changes <code>fn:parse-uri</code> so that it records whether or not the URI was hierarchical and <code>fn:build-uri</code> to use that information.</p>
<p>It's possible that we could finesse this by setting the <code>authority</code> to the empty string for hierarchical URIs, but it seems clearer to be explicit.</p>
<p>This PR also fixes a bug. Previously, if the <code>scheme</code> was not present when building a URI, the URI began with <code>//</code>. That's an error. If the scheme isn't present, there should be no <em>scheme separator</em>.</p>
</div></details></div>
<div class="toot" id="created-394"><h2>Pull request #394 created<span class="toot-id"> #created-394</span></h2><div class="pubdate">13 Mar at 10:08:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/394">https://github.com/qt4cg/qtspecs/pull/394</a></div><details><summary>Minor correction to fn:parse-uri</summary><div class="markup"><p>The <code>fn:parse-uri()</code> function recognizes "URIs" of the form <code>c:/path/to/thing</code> as implicitly being <code>file:</code> URIs. This small change adds a leading "/" to make the fact that it is a path explicit.</p>
</div></details></div>
<div class="toot" id="agenda-03-14"><h2>QT4 CG meeting 026 draft agenda<span class="toot-id"> #agenda-03-14</span></h2><div class="pubdate">13 Mar at 08:45:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-14">https://qt4cg.org/meeting/agenda/2023/03-14</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-386"><h2>Issue #386 closed<span class="toot-id"> #closed-386</span></h2><div class="pubdate">13 Mar at 09:26:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-393"><h2>Pull request #393 created<span class="toot-id"> #created-393</span></h2><div class="pubdate">12 Mar at 22:07:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/393">https://github.com/qt4cg/qtspecs/pull/393</a></div><details><summary>Clarify explanations of functions/function items</summary><div class="markup"><p>This PR is purely editorial in the sense that it does not attempt to make any changes that would affect an implementation. It's intended to clear up ambiguity and lack of clarity in the description of operations on functions, in particular the way that a function item captures static and dynamic context. It addresses issues #239 and issue #392.</p>
</div></details></div>
<div class="toot" id="created-392"><h2>Issue #392 created<span class="toot-id"> #created-392</span></h2><div class="pubdate">12 Mar at 18:56:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/392">https://github.com/qt4cg/qtspecs/issues/392</a></div><details><summary>Partial function application: Placeholders with keywords</summary><div class="markup"><p>It's clear that the following is allowed:</p>
<p><code>format-date(current-date(), '[Y]-[M]-[D]', place:=?, language:=?, calendar:="AD")</code></p>
<p>The resulting function item takes two arguments (place and language) but in what order? Is it the order of parameters in the original function definition, or the order in which they appear in the partial function application?</p>
<p>I think it should be the latter, but this needs to be made explicit in the spec.</p>
<p>Note that this doesn't only apply to optional parameters as in the above example, it applies equally, for example to</p>
<p><code>starts-with(substring=?, value=?)</code></p>
<p>While we're on the subject, we should also ask whether</p>
<p><code>concat(value83 := ?)</code></p>
<p>is legal, and if so, what it means.</p>
</div></details></div>
<div class="toot" id="created-391"><h2>Pull request #391 created<span class="toot-id"> #created-391</span></h2><div class="pubdate">11 Mar at 05:25:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/391">https://github.com/qt4cg/qtspecs/pull/391</a></div><details><summary>addressed typographical errors; adjusted Unicode character discussion…</summary><div class="markup"><p>… for internal local consistency, clarity</p>
<p>This being my first PR, I opted to include beyond the typos I noted in #289 another small block of hopefully uncontroversial edits as a test balloon.</p>
</div></details></div>
<div class="toot" id="created-390"><h2>Issue #390 created<span class="toot-id"> #created-390</span></h2><div class="pubdate">10 Mar at 17:59:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/390">https://github.com/qt4cg/qtspecs/issues/390</a></div><details><summary>Should parsing and building URIs attempt to special case Windows URIs for UNC names?</summary><div class="markup"><p>Depending on the platform and language APIs involved, we see <code>file:</code> URIs encoded in a variety of different ways. It doesn't help that there's no official RFC for <code>file:</code> URIs.</p>
<ul>
<li><code>file:/path/part</code> is a <code>file:</code> URI with no host and a path of <code>/path/part</code>.</li>
<li><code>file:///path.part</code> is a <code>file:</code> URI with an explicitly empty host and a path of <code>/path/part</code>.</li>
<li><code>file://path/part</code> is a <code>file:</code> URI with an authority of <code>path</code> and a path of <code>/part</code>. I think one common way to interpret this is as if it was <code>file:/part</code>. That is, in <code>file:</code> URIs, although a different host is possible, it's often just ignored.</li>
<li><code>c:\path\part</code> is most usefully interpreted as <code>file:/c:/path/part</code>, a <code>file:</code> URI with no host and a path of <code>/c:/path/part</code>. These are only going to be useful on a Windows system, so it isn't a problem to treat them the same way on all platforms. (Aside: I don't actually know if the path part should be <code>c:/path/part</code> instead, but it's currently got the leading slash in <code>fn:parse-uri()</code>.)</li>
</ul>
<p>And then there's this: <code>file:////name/path/part</code>.</p>
<p>One interpretation is, "look, we accept <code>file:/</code> and <code>file:///</code> so let's just accept <code>file://</code> and <code>file://///////</code>, etc. as the same." And I think that's generally right, with the single special exception of <code>file:////</code>. The problem is that on Windows, this is a very common way to encode the URI for a UNC path, that is: <code>\\name\path\part</code> which is a Windows UNC path for <code>\path\part</code> on a host named <code>name</code> (via whatever networking protocol backs UNC).</p>
<p>You'd think that this should be <code>file://name/path/part</code>, but I think because browsers and maybe other tools just discard the authority part of a <code>file:</code> URI (or maybe because these are <em>paths</em> in some Windows sense?), that's not how they're encoded.</p>
<blockquote>
<p>Aside: Yes, I'm sure you also see <code>file:\\\\name\path\part</code> and <code>file:c:\path\part</code> and other forms as well. Those are out of scope, they're simply, flatly, completely wrong. You can't use <code>\</code> as a delimiter in a URI. RFC 3986 is authoritative on this point. Step one of dealing with random strings we think should be URIs is replacing all <code>\</code> with <code>/</code> because RFC 3986.</p>
</blockquote>
<p>It's problematic to deal with <code>file:////</code> as a special case, but it's also problematic to leave out support for a common pattern on a widely deployed operating system.</p>
<p>Recognizing four slashes after <code>file:</code> and treating that specially isn't hard. The hard part is how do we encode this in the map that <code>fn:parse-uri</code> produces bearing in mind that the result should round-trip if you push it back through <code>fn:build-uri</code>.</p>
<p>Consider <code>file:////uncname/path/part</code></p>
<p>Today, that is parsed as:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>and that doesn’t round trip. If you feed that to <code>fn:build-uri</code>, you get <code>file://uncname/path/part</code> and that absolutely doesn’t mean the same thing on a Windows machine.</p>
<p>We could encode the slashes in the <code>authority</code> in which case we also have to encode them in the <code>host</code> because in the presence of <code>host</code>, the <code>authority</code> isn’t used to by <code>fn:build-uri()</code>:</p>
<pre><code>map {
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "////uncname",
  "host": "////uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>It kind of works, but it’s really ugly and it means we have a host value that is a complete kludge. It doesn’t match the RFC rules for hostnames at all.</p>
<p>The other option that occurs to me is to add a “unc-path” property to the map:</p>
<pre><code>map {
  "unc-path": true(),
  "uri": "file:////uncname/path/part",
  "scheme": "file",
  "authority": "uncname",
  "host": "uncname",
  "path": "/path/to/file",
  "path-segments": array { "", "path", "to", "file" }
}
</code></pre>
<p>That works but it introduces all sorts of possibilities for incoherent data, such as an <code>https:</code> URI with a <code>unc-path</code> flag set to <code>true()</code>.</p>
<p>What’s the right answer?</p>
<ol>
<li>Ignore the UNC path special case, it’s the users problem to deal with them.</li>
<li>Recognize them, encode the details in the <code>authority</code> and <code>host</code>.</li>
<li>Recognize them, use a special property like <code>unc-path</code>.</li>
<li>Recognize them, and do this other much better idea I have: ________________</li>
</ol>
</div></details></div>
<div class="toot" id="created-389"><h2>Issue #389 created<span class="toot-id"> #created-389</span></h2><div class="pubdate">09 Mar at 09:31:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/389">https://github.com/qt4cg/qtspecs/issues/389</a></div><details><summary>The fn:build-uri function needs to perform URI encoding for path and query segments</summary><div class="markup"><p>The <code>fn:parse-uri</code> function describes decoding, but the <code>fn:build-uri</code> function fails to encode.</p>
</div></details></div>
<div class="toot" id="closed-388"><h2>Issue #388 closed<span class="toot-id"> #closed-388</span></h2><div class="pubdate">08 Mar at 16:35:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><p>Update the example background color in serialization</p></div>
<div class="toot" id="created-388"><h2>Pull request #388 created<span class="toot-id"> #created-388</span></h2><div class="pubdate">08 Mar at 16:25:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/388">https://github.com/qt4cg/qtspecs/pull/388</a></div><details><summary>Update the example background color in serialization</summary><div class="markup"><p>This PR completes my action to fix the dark blue background in examples in the serialization spec. I've made them the same as the examples in the XSLT spec which seem to have been satisfactory.</p>
</div></details></div>
<div class="toot" id="created-387"><h2>Pull request #387 created<span class="toot-id"> #created-387</span></h2><div class="pubdate">07 Mar at 21:03:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/387">https://github.com/qt4cg/qtspecs/pull/387</a></div><details><summary>Add compatibility notes for fn:namespace-uri-for-prefix</summary><div class="markup"><p>Action QT4CG-024-01</p>
</div></details></div>
<div class="toot" id="created-386"><h2>Pull request #386 created<span class="toot-id"> #created-386</span></h2><div class="pubdate">07 Mar at 20:32:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/386">https://github.com/qt4cg/qtspecs/pull/386</a></div><p>Action QT4CG-025-05 (markup typo)</p></div>
<div class="toot" id="created-385"><h2>Pull request #385 created<span class="toot-id"> #created-385</span></h2><div class="pubdate">07 Mar at 20:15:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/385">https://github.com/qt4cg/qtspecs/pull/385</a></div><details><summary>Actions QT4CG-025-07 / -08</summary><div class="markup"><p>Improves termdef markup; adds error code; updates change history appendix.</p>
</div></details></div>
<div class="toot" id="closed-355"><h2>Issue #355 closed<span class="toot-id"> #closed-355</span></h2><div class="pubdate">07 Mar at 17:19:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><p>Action QT4CG-022-02 - add to imp-def-feature appendix</p></div>
<div class="toot" id="closed-370"><h2>Issue #370 closed<span class="toot-id"> #closed-370</span></h2><div class="pubdate">07 Mar at 17:19:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><p>Bump XSLT version</p></div>
<div class="toot" id="closed-363"><h2>Issue #363 closed<span class="toot-id"> #closed-363</span></h2><div class="pubdate">07 Mar at 17:18:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="closed-364"><h2>Issue #364 closed<span class="toot-id"> #closed-364</span></h2><div class="pubdate">07 Mar at 17:18:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="closed-371"><h2>Issue #371 closed<span class="toot-id"> #closed-371</span></h2><div class="pubdate">07 Mar at 17:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><p>Issue 370: forwards and backwards compatibility for 4.0</p></div>
<div class="toot" id="minutes-03-07"><h2>QT4 CG meeting 025 draft minutes<span class="toot-id"> #minutes-03-07</span></h2><div class="pubdate">07 Mar at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/03-07">https://qt4cg.org/meeting/minutes/2023/03-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-384"><h2>Issue #384 created<span class="toot-id"> #created-384</span></h2><div class="pubdate">06 Mar at 16:24:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/384">https://github.com/qt4cg/qtspecs/issues/384</a></div><details><summary>Definition of "effective value" in XSLT</summary><div class="markup"><p>The term "effective value" is defined in XSLT with a rather narrow definition in the context of attribute value templates. The term is used throughout the spec (sometimes hyperlinked, sometimes not) in a much more general sense, for example the "effective value" of an attribute is the explicit value given to the attribute, or the value after basic normalization such as whitespace stripping, or the default value if the attribute is not present.</p>
<p>This affects the determination of the correct result for test merge-021, where it is a little ambiguous whether two <code>xsl:merge-source/@order</code> attribute have the same "effective value" given that one is defaulted.</p>
</div></details></div>
<div class="toot" id="agenda-03-07"><h2>QT4 CG meeting 025 draft agenda<span class="toot-id"> #agenda-03-07</span></h2><div class="pubdate">05 Mar at 11:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/03-07">https://qt4cg.org/meeting/agenda/2023/03-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-383"><h2>Issue #383 created<span class="toot-id"> #created-383</span></h2><div class="pubdate">28 Feb at 17:21:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/383">https://github.com/qt4cg/qtspecs/issues/383</a></div><details><summary>Improve the specification of unordered comparisons in deep-equal</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how best to specify that in some circumstances the comparisons should be made without regard to the order of (some) children.</p>
<p>Can the name of the option be improved?</p>
<p>Should the option support wildcard names?</p>
</div></details></div>
<div class="toot" id="created-382"><h2>Issue #382 created<span class="toot-id"> #created-382</span></h2><div class="pubdate">28 Feb at 17:19:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/382">https://github.com/qt4cg/qtspecs/issues/382</a></div><details><summary>Improve whitespace handling in deep-equal</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR https://github.com/qt4cg/qtspecs/pull/320 was accepted, there remained an open question of how to deal with whitespace.</p>
<p>The current options can be seen as having somewhat overlapping domains. Can this be improved?</p>
</div></details></div>
<div class="toot" id="created-381"><h2>Issue #381 created<span class="toot-id"> #created-381</span></h2><div class="pubdate">28 Feb at 17:18:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/381">https://github.com/qt4cg/qtspecs/issues/381</a></div><details><summary>Deep-equal comparisons without errors</summary><div class="markup"><p>At <a href="https://qt4cg.org/meeting/minutes/2023/02-28.html">meeting 024</a> where PR #320 was accepted, there remained an open question of how to deal with errors.</p>
<p>On the one hand, in order for <code>fn:deep-equal</code> to be most easily used as a comparison function in the many contexts where a comparison function is required, it would be best if it simply returned <code>false()</code> rather than raising an error when incomparably items are encountered.</p>
<p>On the other hand, making "return false()" the default will mean that it is possible to construct items that are not equal to themselves, which will certainly violate the expectations of some users.</p>
<p>This conflict needs to be resolved somehow.</p>
</div></details></div>
<div class="toot" id="minutes-02-28"><h2>QT4 CG meeting 024 draft minutes<span class="toot-id"> #minutes-02-28</span></h2><div class="pubdate">28 Feb at 17:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-28">https://qt4cg.org/meeting/minutes/2023/02-28</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-377"><h2>Issue #377 closed<span class="toot-id"> #closed-377</span></h2><div class="pubdate">28 Feb at 14:49:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><p>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</p></div>
<div class="toot" id="closed-380"><h2>Issue #380 closed<span class="toot-id"> #closed-380</span></h2><div class="pubdate">28 Feb at 14:49:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><p>Removed CDATA sections around markup</p></div>
<div class="toot" id="created-380"><h2>Pull request #380 created<span class="toot-id"> #created-380</span></h2><div class="pubdate">28 Feb at 14:23:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/380">https://github.com/qt4cg/qtspecs/pull/380</a></div><details><summary>Removed CDATA sections around markup</summary><div class="markup"><p>Fix #377</p>
<p>I took a minimal approach here. I've removed CDATA sections where the section contained an <code>&amp;</code> but not a <code>&lt;</code>.</p>
<ol>
<li>If the section contains <code>&lt;</code>, then it's  (presumably) necessary to escape the markup</li>
<li>If the section <em>does not</em> contain an <code>&amp;</code>, then it's irrelevant. But not removing it limits the number of places changed by the script</li>
</ol>
</div></details></div>
<div class="toot" id="created-379"><h2>Issue #379 created<span class="toot-id"> #created-379</span></h2><div class="pubdate">28 Feb at 12:09:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/379">https://github.com/qt4cg/qtspecs/issues/379</a></div><details><summary>Namespace handling in parse-html</summary><div class="markup"><p>The HTML5/"Living Standard" specification has two modes when it comes to handling namespaces:</p>
<ol>
<li>For XHTML content the document is parsed as XML with full namespace support.</li>
<li>For HTML content, it has pseudo-namespace support.</li>
</ol>
<p>For example, the HTML parsing algorithm:</p>
<ol>
<li>places html, svg, and mathml elements in their corresponding namespaces.</li>
<li>allows certain element/attribute tag names (e.g. <code>xlink:href</code>) to be parsed as QNames.</li>
</ol>
<p>From the XSLT/XQuery perspective, this affects the data model. Specifically, how to model and specify the node-names and the set of namespaces associated with a given element node.</p>
</div></details></div>
<div class="toot" id="created-378"><h2>Pull request #378 created<span class="toot-id"> #created-378</span></h2><div class="pubdate">28 Feb at 08:55:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/378">https://github.com/qt4cg/qtspecs/pull/378</a></div><details><summary>Update the localName and unparsed entity reference notes for parse-html</summary><div class="markup"><p>This PR applies the following changes:</p>
<ul>
<li>[x] QT4CG-021-03: RD to change must to will in DOM notes about lowercase</li>
<li>[x] QT4CG-021-04: RD to revise and move the note about unrecognized entities</li>
</ul>
</div></details></div>
<div class="toot" id="created-377"><h2>Issue #377 created<span class="toot-id"> #created-377</span></h2><div class="pubdate">28 Feb at 07:22:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/377">https://github.com/qt4cg/qtspecs/issues/377</a></div><details><summary>Published XQuery 4.0 spec renders XML predefined entities instead of literal characters</summary><div class="markup"><p>When rendered in the browser, XML examples in the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html">XQuery 4.0 specification</a> show, for example, '<code>&amp;lt;</code>' instead of '<code>&lt;</code>':</p>
<p><img src="https://user-images.githubusercontent.com/2734234/221782371-1d119a80-72b3-4ede-b9c9-0b2b464533c0.png" alt="Screenshot 2023-02-28 at 07 21 49"></p>
</div></details></div>
<div class="toot" id="created-376"><h2>Issue #376 created<span class="toot-id"> #created-376</span></h2><div class="pubdate">27 Feb at 17:16:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/376">https://github.com/qt4cg/qtspecs/issues/376</a></div><details><summary>add documentation prefix attribute to xsl:stylesheet</summary><div class="markup"><p>Although the addition of xsl:note is very welcome, i had been hoping for something like the xsl:stylesheet attribute extension-element-prefixes, e.g. ignored-element-prefixes.</p>
<p>The specification would be something like,
Elements and attributes associated with an ignored element prefix are not treated as direct constructors, and are removed when the stylesheet is compiled. For such an element, this is equivalent to having an xsl:use-when attribute with value false on the element; for attributes, they are simply discarded along with their value.</p>
<p>It is not an error for a prefix to be listed both as an ignored element prefix and as an extension element prefix; the result is implementation dependent in this case, but MUST not result in neither an extension being invoked nor the element or attribute being ignored.</p>
<p>Ignored elements may appear anywhere in the input tree, and ignored attributes may appear on any element.</p>
<p>Example:</p>
<pre><code>&lt;xsl:template match="city/park" css:module="main"&gt;
  &lt;css:rule&gt;
    color: green;
    trees: tall;
  &lt;/xsl:rule&gt;
  &lt;div class="park"&gt;
    &lt;xsl:apply-templates /&gt;
  &lt;/div&gt;
&lt;/xsl:template&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-375"><h2>Pull request #375 created<span class="toot-id"> #created-375</span></h2><div class="pubdate">27 Feb at 17:03:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/375">https://github.com/qt4cg/qtspecs/pull/375</a></div><details><summary>Context for default parameter values</summary><div class="markup"><p>This is an attempt to resolve issue #256 by providing details of the static and dynamic context for evaluating default parameter values, including providing a mechanism for accessing parts of the static and dynamic context of the caller.</p>
<p>If this PR is accepted we will need to follow up with (a) similar changes to XSLT, and (b) use of the new notation in the signatures of standard functions and operators that have context-dependent default values for parameters.</p>
<p>Note that the PR also breaks up the rather unwieldy sections for Function Declarations and Variable Declarations into more manageable subsections, which has involved some re-ordering; some of the change marking may therefore be spurious.</p>
</div></details></div>
<div class="toot" id="created-374"><h2>Issue #374 created<span class="toot-id"> #created-374</span></h2><div class="pubdate">27 Feb at 10:11:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/374">https://github.com/qt4cg/qtspecs/issues/374</a></div><details><summary>Can't view the XSD for XSLT in the browser</summary><div class="markup"><p>If you attempt to open <code>https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd</code> in the browser (in Firefox), you'll get:</p>
<pre><code>Error loading stylesheet: An unknown error has occurred (805303f4)
http://www.w3.org/2008/09/xsd.xsl
</code></pre>
<p>In a Chrome-derived browser I get a blank screen on which even the context menu doesn't work. Digging about in the inspect window leads me to</p>
<pre><code>Unsafe attempt to load URL http://www.w3.org/2008/09/xsd.xsl from frame with URL
https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd. Domains, protocols and ports must match.
</code></pre>
<p>I conclude that the problem is trying to load the XSL for XSD from a different domain. Boo. I guess we should copy those stylesheets to <code>qt4cg.org</code>, or remove the stylesheet PI, or ignore the whole thing on the assumption that we'll eventually publish these specifications in some W3C location and the probem will go away. Maybe.</p>
</div></details></div>
<div class="toot" id="created-373"><h2>Issue #373 created<span class="toot-id"> #created-373</span></h2><div class="pubdate">27 Feb at 09:29:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/373">https://github.com/qt4cg/qtspecs/issues/373</a></div><details><summary>apparent copy/paste error in annotation documentation of simple type yes-or-no-or-maybe</summary><div class="markup"><p>The XSD 1.1 schema for XSLT 3 and the one for XSLT 4 (at https://qt4cg.org/specifications/xslt-40/schema-for-xslt40.xsd) has an error in the annotation/documentation section of the simple type <code>yes-or-no-or-maybe</code> as it there says <code>One of the values "yes" or "no" or "omit".</code>. I think that should be <code>One of the values "yes" or "no" or "maybe"</code>, the error probably exists as someone copied the text from the <code>yes-or-no-or-omit</code> type declaration and forgot to adapt the description.</p>
</div></details></div>
<div class="toot" id="created-372"><h2>Issue #372 created<span class="toot-id"> #created-372</span></h2><div class="pubdate">26 Feb at 23:06:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/372">https://github.com/qt4cg/qtspecs/issues/372</a></div><details><summary>Separate default namespace for elements from the default namespace for types</summary><div class="markup"><p>Currently the static context provides a "default namespace for elements and types". It's not at all clear why these should be the same. For types, the vast majority of QNames representing types are in the XML Schema namespace, which is never used for elements.</p>
<p>In the current 4.0 drafts the two default namespaces are separated; but this has not been reviewed or agreed by the CG. This issue is raised for discussion of the change, and I will also review the design to see whether it still make sense.</p>
<p>Some observations on the current text for XQuery:</p>
<ol>
<li>In section 2.2.1 (static context) it would be good to give a bit more detail (if only as a forwards reference) about the circumstances in which the default element namespace and the default type namespace are used.</li>
<li>In 3.4 Sequence Types the sentence "[Lexical QNames]appearing in a [sequence type] have their prefixes expanded to namespace URIs by means of the [statically known namespaces] and (where applicable) the [default element namespace] or [default type namespace]" is rather inelegantly worded. If there is a prefix, then the statically known namespaces are used; if there is none, then the relevant default namespace is used, and it would be nice to explain more clearly which one applies.</li>
<li>In 3.6 Item Types, we need to be clearer about references to named/declared item types, and about how the names are resolved. Do we really want these names to be in the same symbol space as atomic types? Perhaps we should have a rule that Item Types (like functions) must be in a namespace and this must not be the same as an imported schema namespace.</li>
<li>In 5.14, Default namespace declaration, there seems to be duplication between the two paragraphs starting "for backwards compatibility reasons"</li>
<li>Appendix C.1 (much though I dislike it) should say something about the initialisation of the default namespaces for elements and for types.</li>
</ol>
<p>Note that issue #65 talks of the need for different default namespaces for input and output elements. I think that's a separate issue.</p>
<p>Observations on the current text for XSLT:</p>
<ol>
<li>In 5.1.2.1 the paragraph "The [xsl:]xpath-default-namespace attribute must be in the [XSLT namespace] if and only if its parent element is not in the XSLT namespace needs to be generalised to [xsl:]default-element-namespace. In fact, this rule should move to the parent section 5.1.2, which needs an introduction.</li>
</ol>
</div></details></div>
<div class="toot" id="created-371"><h2>Pull request #371 created<span class="toot-id"> #created-371</span></h2><div class="pubdate">24 Feb at 16:59:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/371">https://github.com/qt4cg/qtspecs/pull/371</a></div><details><summary>Issue 370: forwards and backwards compatibility for 4.0</summary><div class="markup"><p>This is essentially editorial; it updates the XSLT rules for forwards and backwards compatible processing to acknowledge the fact that the current version is now 4.0.</p>
</div></details></div>
<div class="toot" id="created-370"><h2>Issue #370 created<span class="toot-id"> #created-370</span></h2><div class="pubdate">24 Feb at 16:18:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/370">https://github.com/qt4cg/qtspecs/issues/370</a></div><details><summary>Bump XSLT version</summary><div class="markup"><p>There are various places where the XSLT spec refers to XSLT 3.0 where it should now refer to 4.0.</p>
</div></details></div>
<div class="toot" id="agenda-02-28"><h2>QT4 CG meeting 024 draft agenda<span class="toot-id"> #agenda-02-28</span></h2><div class="pubdate">24 Feb at 08:25:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-28">https://qt4cg.org/meeting/agenda/2023/02-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-352"><h2>Issue #352 closed<span class="toot-id"> #closed-352</span></h2><div class="pubdate">22 Feb at 21:24:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><p>The @array attribute of xsl:for-each-group is no more</p></div>
<div class="toot" id="closed-354"><h2>Issue #354 closed<span class="toot-id"> #closed-354</span></h2><div class="pubdate">22 Feb at 10:08:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><p>Combine multiple signatures of XSLT functions to use defaults</p></div>
<div class="toot" id="closed-353"><h2>Issue #353 closed<span class="toot-id"> #closed-353</span></h2><div class="pubdate">22 Feb at 10:07:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><p>Issue109 xsl note</p></div>
<div class="toot" id="closed-362"><h2>Issue #362 closed<span class="toot-id"> #closed-362</span></h2><div class="pubdate">22 Feb at 10:06:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><p>Drop obsolete note in XSLT regarding for-each-group/@array</p></div>
<div class="toot" id="minutes-02-21"><h2>QT4 CG meeting 023 draft minutes<span class="toot-id"> #minutes-02-21</span></h2><div class="pubdate">22 Feb at 09:53:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-21">https://qt4cg.org/meeting/minutes/2023/02-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-369"><h2>Issue #369 created<span class="toot-id"> #created-369</span></h2><div class="pubdate">21 Feb at 17:44:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/369">https://github.com/qt4cg/qtspecs/issues/369</a></div><details><summary>Namespaces for Functions</summary><div class="markup"><p>What problem are we trying to solve? Essentially, I think "namespace clutter".</p>
<p>Namespace clutter manifests itself in several different ways.</p>
<ul>
<li>Firstly, declaration clutter in source code. Here's the start of a module in an XSLT Stylesheet of medium complexity:</li>
</ul>
<pre><code>&lt;xsl:stylesheet 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    xmlns:xs="http://www.w3.org/2001/XMLSchema" 
    exclude-result-prefixes="#all"
    version="3.0" 
    xmlns="http://ns.saxonica.com/xslt/export" 
    xmlns:doc="http://www.saxonica.com/ns/documentation"
    xmlns:map="http://www.w3.org/2005/xpath-functions/map" 
    xmlns:ex="http://ns.saxonica.com/xslt/export" 
    xmlns:f="MyFunctions" 
    xmlns:t="MyTypes"
    expand-text="true"&gt;
</code></pre>
<p>Eight namespace declarations here, of which 3 are concerned with functions; and  Wit can get a lot worse than that.</p>
<ul>
<li>Secondly, namespace clutter in the static and dynamic context. The namespace bindings shown above don't disappear when the code is compiled; even with exclude-result-prefixes="yes", they have to hang around at run-time just in case someone tries to resolve a QName dynamically. Preserving the namespace context in the expression tree through optimization rewrites is a significant cost that has no user benefit; very rarely are they actually going to use the namespace context at run time.</li>
<li>Thirdly, prefix clutter in the executable code. Writing <code>math:cos(math:cos($x))</code> is just so clumsy compared with <code>cos(cos($x))</code>.</li>
</ul>
<p>I think there are a number of things we can do to reduce this.</p>
<p>First, separate out the namespace context for static resolution of function names as a separate part of the static context, used only for this purpose. Ensure that there is no functionality that depends on knowing this part of the static context at run time, so it can be discarded by the compiler as soon as function names are resolved. Then provide source syntax for binding function prefixes to function namespaces in XSLT and XQuery to populate this part of the static context; there is no reason this has to be done using XML namespace declarations. There is also no reason for having different bindings in force in different parts of a single module. And once we've separated these declarations from XML namespace declarations, there's no reason why we can't provide default bindings. We could also allow bindings to have cross-module scope to reduce duplicated code. Note: the xsl:function-library proposal in the current XSLT 4.0 draft tries to achieve some of these things.</p>
<p>Second, allow functions to be referenced by local name alone where the reference is unambiguous; and perhaps provide some aliasing mechanisms to make more existing names unambiguous.</p>
<p>We've explored a third idea, which is to introduce some kind of polymorphism where function names have local scope and are distinguished by the types of objects to which they are applied. I think that given our type system, this is very hard to achieve and I haven't seen any very satisfactory proposals. We also need to remember that there are considerable costs if we start resolving function names dynamically at run time. I wouldn't rule out making progress in this direction, but I'm not optimistic of coming up with a workable solution. There might be some simple things we could do, like having a single function <code>size()</code> that performs the work of both <code>map:size()</code> and <code>array:size()</code> depending on the argument.</p>
</div></details></div>
<div class="toot" id="created-368"><h2>Pull request #368 created<span class="toot-id"> #created-368</span></h2><div class="pubdate">21 Feb at 10:34:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/368">https://github.com/qt4cg/qtspecs/pull/368</a></div><details><summary>Issue 129 - Context item generalized to context value</summary><div class="markup"><p>This is a first cut proposal to generalize the context item to a context value, allowing (for example) array predicates.</p>
<p>The proposal covers XPath and XQuery only at this stage; it doesn't address the consequences for XSLT.</p>
<p>Careful review requested!</p>
<p>Addresses issue #129 and issue #367.</p>
</div></details></div>
<div class="toot" id="created-367"><h2>Issue #367 created<span class="toot-id"> #created-367</span></h2><div class="pubdate">21 Feb at 00:06:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/367">https://github.com/qt4cg/qtspecs/issues/367</a></div><details><summary>Focus for RHS of thin arrow expressions</summary><div class="markup"><p>We define <code>A -&gt; F(B, C)</code> as being equivalent to <code>A ! F(., B, C)</code> which means that B and C are evaluated with a focus based on the current item in A, not with the outer focus. This is different from the <code>=&gt;</code> operator. For example if the $E is an element E, with several children called F, then</p>
<p><code>namespace-uri(.) -&gt; fn:QName(name())</code></p>
<p>has a different effect from</p>
<p><code>namespace-uri(.) =&gt; fn:QName(name())</code></p>
<p>whereas it might reasonably be expected that in the case where the LHS produces a single value, the two operators are equivalent. We can't change the meaning of <code>=&gt;</code> because it's defined in 3.1. So should we change the meaning of <code>-&gt;</code> to fall into line?</p>
<p>We could do this easily enough by defining <code>A -&gt; F(B, C)</code> as equivalent to <code>for $a in A return F($a, B, C)</code>.  I think that as well as being more consistent with <code>=&gt;</code>, the result is probably more intuitive. (We could also define it as equivalent to <code>let $f := F(?, B, C) return A ! $f(.)</code>)</p>
<p>For the expression <code>A -&gt; {B}</code>, and for the proposed <code>A =&gt; {B}</code>, I don't think we have any choice other than evaluating B with an inner focus based on A. But at least we can do it consistently for both operators.</p>
</div></details></div>
<div class="toot" id="created-366"><h2>Issue #366 created<span class="toot-id"> #created-366</span></h2><div class="pubdate">20 Feb at 18:43:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/366">https://github.com/qt4cg/qtspecs/issues/366</a></div><details><summary>Support xsl:use-package with xsl:package-location</summary><div class="markup"><p>Unless I am misreading the specs (which I do commonly enough), there is currently no way for an XSLT writer using <code>xsl:use-package</code> to indicate where the package is to be found, except outside the XSLT environment. I propose to allow <code>xsl:use-package</code> to contain zero or more <code>xsl:package-location</code> children. I propose the addition of an element and not an attribute, because a package may be in multiple locations, and need nuance, as noted below.</p>
<p>Attributes:</p>
<ul>
<li><code>@href</code>, on the model of <code>xsl:import</code> and <code>xsl:include</code>, would specify by relative or absolute URI where the package is.</li>
<li><code>@priority</code> (default 0) would provide a mechanism to indicate whether the specified <code>xsl:package-location</code> should override (value greater than 0), or simply provide a fallback for (less than or equal to 0), the preconfigured place the package should be retrieved from.</li>
<li><code>@use-when</code> would allow a developer to manage different versions of a package for different cases.</li>
</ul>
<p>Other attributes given to <code>xsl:package-location</code> would need discussion.</p>
</div></details></div>
<div class="toot" id="created-365"><h2>Issue #365 created<span class="toot-id"> #created-365</span></h2><div class="pubdate">20 Feb at 16:41:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/365">https://github.com/qt4cg/qtspecs/issues/365</a></div><details><summary>switch, typeswitch: Optional braces</summary><div class="markup"><p>The indentation of switch expressions is often a mess. Now that we allow curly braces for <code>if</code>, it would be nice to also allow optional braces for <code>switch</code> and <code>typeswitch</code>:</p>
<pre><code class="language-xquery">typeswitch($item) {
  case xs:numeric return 'number'
  default return '...'
},
switch($item) {
  case 0 to 9 return 'single digit'
  default return '...'
}
</code></pre>
<p>The current syntax is:</p>
<pre><code class="language-xquery">typeswitch($item)
  case xs:numeric return 'number'
  default return '...',

switch($item)
  case 0 to 9 return 'single digit'
  default return '...'
</code></pre>
</div></details></div>
<div class="toot" id="created-364"><h2>Pull request #364 created<span class="toot-id"> #created-364</span></h2><div class="pubdate">20 Feb at 15:43:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/364">https://github.com/qt4cg/qtspecs/pull/364</a></div><p>Generalize switch expressions in XQuery (issue #328)</p></div>
<div class="toot" id="created-363"><h2>Pull request #363 created<span class="toot-id"> #created-363</span></h2><div class="pubdate">20 Feb at 13:07:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/363">https://github.com/qt4cg/qtspecs/pull/363</a></div><p>Fix issue #345 - missing rules for type matching</p></div>
<div class="toot" id="created-362"><h2>Pull request #362 created<span class="toot-id"> #created-362</span></h2><div class="pubdate">20 Feb at 12:12:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/362">https://github.com/qt4cg/qtspecs/pull/362</a></div><details><summary>Drop obsolete note in XSLT regarding for-each-group/@array</summary><div class="markup"><p>Fixes issue #352</p>
</div></details></div>
<div class="toot" id="created-361"><h2>Issue #361 created<span class="toot-id"> #created-361</span></h2><div class="pubdate">20 Feb at 11:38:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/361">https://github.com/qt4cg/qtspecs/issues/361</a></div><details><summary>Named arguments: $input vs. $value</summary><div class="markup"><p>Great effort has been made in unifying the parameter names of the XQFO standard; thanks for that!</p>
<p>I believe to remember that:</p>
<ul>
<li><code>$value</code>, <code>$values</code>, <code>$value1</code>, etc. is used for atomic/atomized arguments, whereas</li>
<li><code>$input</code>, <code>$input1</code>, etc. is used for input, mostly of type <code>item()</code>, that is processed unchanged.</li>
<li><code>$uri</code> is used for arguments that could have been defined as items of type <code>xs:anyURI</code>.</li>
</ul>
<p>I believe the following argument names need to be double-checked (if not, It may be that I haven’t fully grasped how the naming rules are supposed to work):</p>
<p>Function | Currently | Presumably | Justification
--- | --- | --- | ---
<code>array:slice</code> | <code>$input</code> | <code>$array</code> | Alignment with <code>array:size</code> et al.
<code>trace</code> | <code>$value</code> | <code>$input</code> | Argument is not atomized
<code>json</code> | <code>$input</code> | <code>$value</code> | Argument is atomized
<code>string</code> | <code>$item</code> | <code>$value</code>  | <code>$item</code> is used nowhere else
<code>expanded-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>resolve-QName</code> | <code>$qname</code> | <code>$value</code> | Alignment with <code>prefix-from-QName</code> et al.
<code>parse-QName</code> | <code>$eqname</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>parse-json</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>json-to-xml</code> | <code>$json</code> | <code>$value</code> | Alignment with <code>parse-xml</code> et al.
<code>char</code> | <code>$name</code> | <code>$value</code> | Input may also be codepoint values, etc.
<code>namespace-uri-for-prefix</code> | <code>$prefix</code> | <code>$value</code> | <code>$prefix</code> is used nowhere else
<code>resolve-uri</code> | <code>$relative</code> | <code>$uri</code> | Absolute URIs are legal as well</p>
<p>And we should probably pay particular attention to the naming conventions when adding new functions.</p>
</div></details></div>
<div class="toot" id="created-360"><h2>Pull request #360 created<span class="toot-id"> #created-360</span></h2><div class="pubdate">20 Feb at 11:24:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/360">https://github.com/qt4cg/qtspecs/pull/360</a></div><details><summary>Issue 314 array composition and decomposition</summary><div class="markup"><p>This PR addresses parts of issue 29, issue 113, and issue 314 relating to the composition and decomposition of arrays.</p>
<p>It introduces two functions <code>array:of</code> for array composition, and <code>array:members</code> for decomposition, and defines all other array functions in terms of these two primitives (replacing the internal functions <code>op:A2S</code> and <code>op:S2A</code>). The items in the decomposed form of an array are called "value records", singleton maps of the form <code>map{'value': $value}</code></p>
<p>The function <code>array:from-sequence</code> is renamed <code>array:build</code> to reflect its symmetry with <code>map:build</code>.</p>
<p>Question for the group: should we have a new function for constructing a "value record", or is the syntax <code>map{'value': $value}</code> adequate for the purpose?</p>
</div></details></div>
<div class="toot" id="created-359"><h2>Issue #359 created<span class="toot-id"> #created-359</span></h2><div class="pubdate">20 Feb at 09:53:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/359">https://github.com/qt4cg/qtspecs/issues/359</a></div><details><summary>fn:void: Absorb result of evaluated argument</summary><div class="markup"><h3>Summary</h3>
<p>Absorb the result of the evaluated argument.</p>
<h3>Signature</h3>
<pre><code class="language-xquery">fn:void(
  $input as item()*
) as empty-sequence()
</code></pre>
<h3>Motivation</h3>
<p>Developers tend to get creative if they want to suppress the result of an expression. The reason is that there is no simply solution to do this properly. Some constructs I have seen in practice:</p>
<pre><code class="language-xquery">let $unused := EXPRESSION
return 'ok'

EXPRESSION[position() = 10000], 'ok'

let $result := 'ok'
return if(exists(EXPRESSION)) then $result else $result
</code></pre>
<p>Cases like this are frequent in nondeterministic code. Think e.g. of side-effecting functions of the EXPath HTTP-Client and File Modules: The function results are not always relevant for the invoking application, or already known.</p>
<p>The function is also helpful during development and for testing code. <code>fn:void#1</code> and <code>fn:identity#1</code> can both be passed on to functions to either return or ignore the result of their arguments. The function can potentially be used to measure the runtime performance of an expression (but an implementation should not be prevented from discarding the function call if the argument expression is deterministic).</p>
</div></details></div>
<div class="toot" id="created-358"><h2>Issue #358 created<span class="toot-id"> #created-358</span></h2><div class="pubdate">19 Feb at 23:55:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/358">https://github.com/qt4cg/qtspecs/issues/358</a></div><details><summary>serialization indent whitespace</summary><div class="markup"><p>There could be an option to control whether the serialization indents with space or tabs, and how many of them (e.g.  2 or 4 spaces )</p>
<p>Related: https://github.com/qt4cg/qtspecs/issues/101</p>
<p>A user request: https://github.com/benibela/xidel/issues/100</p>
</div></details></div>
<div class="toot" id="created-357"><h2>Issue #357 created<span class="toot-id"> #created-357</span></h2><div class="pubdate">18 Feb at 16:07:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/357">https://github.com/qt4cg/qtspecs/issues/357</a></div><details><summary>Representing key-value pairs</summary><div class="markup"><p>A map can be decomposed into, or composed from, a sequence of key-value pairs (KVPs).</p>
<p>There are two natural representations of a key-value pair (K, V): it can be represented as a singleton map (<code>map{ K: V }</code>) or as a "doubleton" map (<code>map{ 'key': K, 'value': V}</code>).</p>
<p>This issue examines how well either of these representations is currently supported, which of them is preferable, and how this support should be improved.</p>
<p>I'll consider the following basic operations: constructing a KVP from a key and a value, assembling a map from a set of KVPs, decomposing a map into a sequence of KVPs, extracting the key from a KVP, and extracting the value from a KVP.</p>
<p><strong>Singleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ $key : $value }
map:entry($key, $value)
&lt;xsl:map:entry key="$key" select="$value"/&gt;
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<pre><code>map:merge($kvps)
&lt;xsl:map&gt;
</code></pre>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, map:entry#2)</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>map:keys($kvp)</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?*</code></p>
<p><strong>Doubleton Representation</strong></p>
<p>Constructing a KVP from a key and a value:</p>
<pre><code>map{ 'key': $key, 'value': $value }
</code></pre>
<p>Assembling a map from a set of KVPs</p>
<p><code>map:build($kvps, -&gt;{?key}, -&gt;{?value})</code></p>
<p>Decomposing a map into a sequence of KVPs:</p>
<p><code>map:for-each($map, -&gt;($K, $V){map{ 'key': $key, 'value': $value })</code></p>
<p>Extracting the key from a KVP:</p>
<p><code>$kvp?key</code></p>
<p>Extracting the value from a KVP:</p>
<p><code>$kvp?value</code></p>
<p><strong>Analysis</strong></p>
<p>The singleton representation is better supported at present, and it makes sense therefore to fill in the gaps that currently make it awkward. The main attraction of the doubleton representation is the ease of extracting the key and the value using <code>$kvp?key</code> and <code>$kvp?value</code>. The equivalents for the singleton representation (<code>map:keys($kvp)</code> and <code>$kvp?*</code>) feel clumsy and unintuitive; however, it's not at all obvious what would be better, short of introducing new custom syntax, which seems over-the-top. The best idea I can come up with is to have two functions <code>map:key($kvp)</code> and <code>map:value($kvp)</code> which require $kvp to be a singleton map. But I hate the namespace prefixes...</p>
<p>The other thing needed to "fill the gaps" is a function <code>map:entries($map)</code> equivalent to <code>map:for-each($map, map:entry#2)</code>.</p>
<p>What if we chose to go the other way, and improve support for the doubleton representation?</p>
<p>We could add <code>map:key-value-pair($key, $value)</code> to create  KVP, and <code>map:of($kvps)</code> to build a map from a set of KVPs, and <code>map:key-value-pairs($map)</code> to decompose a map. The trickiest problem is what to do about XSLT, where the 3.0 instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code> use the singleton representation.</p>
</div></details></div>
<div class="toot" id="created-356"><h2>Issue #356 created<span class="toot-id"> #created-356</span></h2><div class="pubdate">18 Feb at 00:21:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/356">https://github.com/qt4cg/qtspecs/issues/356</a></div><details><summary>[FO] Issues with array:flatten</summary><div class="markup"><h1>1. Issues</h1>
<p>There are at least two issues with the definition of the function <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><strong><code>array:flatten</code></strong></a>:</p>
<ol>
<li>
<p>Unlike most other functions on arrays (such as <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-put">array:put</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-replace">array:replace</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-append">array:append</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-slice">array:slice</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-subarray">array:subarray</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-remove">array:remove</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-insert-before">array:insert-before</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-tail">array:tail</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-trunk">array:trunk</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-reverse">array:reverse</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-join">array:join</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each">array:for-each</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-filter">array:filter</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-for-each-pair">array:for-each-pair</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-sort">array:sort</a>, <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-partition">array:partition</a></strong>) , which produce an array as their result, <strong>this function produces only a sequence</strong></p>
</li>
<li>
<p><strong>This function is not lossless</strong> -- any members that are the empty sequence or the empty array are not represented in the returned result.</p>
</li>
</ol>
<h1>2. Suggested solution(s)</h1>
<p>We want to have a function that is similar to the wrongly defined one, but produces its contents as an array, and is lossless. There are two obvious ways to do this:</p>
<ol>
<li>
<p>Correct the specification of   <strong><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-array-flatten"><code>array:flatten</code></a></strong> so that its result is an array and it represents the empty sequences and empty arrays as the same members of its result.</p>
</li>
<li>
<p>Add to the Specification a new function: <strong><code>array:leaves</code></strong> that produces an array as its result and that is lossless.
<strong>array:leaves</strong> returns an array whose members are exactly all the leaves of the input array, by the order of their appearance. By definition leaves are all, and at any depth, members that are not an array except when they are the empty array. Thus () (the empty sequence) and [] (the empty array) are leaves by definition.</p>
</li>
</ol>
<p><strong><em>Solution 2. will not cause any compatibility issues</em></strong>.</p>
<h1>3. Examples</h1>
<p>The expression <strong><code>array:leaves([1, (), [4, 6], 5, 3])</code></strong> returns <strong><code>[1, (),  4, 6, 5, 3]</code></strong>.</p>
<p>The expression <strong><code>array:leaves([1, 2, 5], [[10, 11], 12], [], 13)</code></strong> returns <strong><code>[1, 2, 5, 10, 11, 12, [], 13]</code></strong>.</p>
</div></details></div>
<div class="toot" id="agenda-02-21"><h2>QT4 CG meeting 023 draft agenda<span class="toot-id"> #agenda-02-21</span></h2><div class="pubdate">17 Feb at 17:49:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-21">https://qt4cg.org/meeting/agenda/2023/02-21</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-355"><h2>Pull request #355 created<span class="toot-id"> #created-355</span></h2><div class="pubdate">16 Feb at 21:41:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/355">https://github.com/qt4cg/qtspecs/pull/355</a></div><details><summary>Action QT4CG-022-02 - add to imp-def-feature appendix</summary><div class="markup"><p>Adds entries to the implementation-defined-features appendix of the serialization spec, corresponding to the option to generate <code>&lt;meta charset="XXX"&gt;</code> for HTML5.</p>
</div></details></div>
<div class="toot" id="created-354"><h2>Pull request #354 created<span class="toot-id"> #created-354</span></h2><div class="pubdate">16 Feb at 18:30:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/354">https://github.com/qt4cg/qtspecs/pull/354</a></div><details><summary>Combine multiple signatures of XSLT functions to use defaults</summary><div class="markup"><p>This PR addresses issue 69, by modifying those XSLT built-in functions that currently have multiple signatures, to use a single signature with parameter defaults instead.</p>
<p>The changes however don't currently render correctly. The XSLT processing pipeline needs to be changed to pick up the changes that were made to the F+O stylesheets to render parameter defaults correctly. I haven't yet managed to work out where this is done.</p>
</div></details></div>
<div class="toot" id="created-353"><h2>Pull request #353 created<span class="toot-id"> #created-353</span></h2><div class="pubdate">16 Feb at 17:22:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/353">https://github.com/qt4cg/qtspecs/pull/353</a></div><details><summary>Issue109 xsl note</summary><div class="markup"><p>Addresses issue #109 and issue #87. Unfortunately the PR also includes the unrelated commits for issue 22.</p>
</div></details></div>
<div class="toot" id="created-352"><h2>Issue #352 created<span class="toot-id"> #created-352</span></h2><div class="pubdate">16 Feb at 14:58:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/352">https://github.com/qt4cg/qtspecs/issues/352</a></div><details><summary>The @array attribute of xsl:for-each-group is no more</summary><div class="markup"><p>There is a note in XSLT §14.2 concerning the @array attribute of xsl:for-each-group, but this attribute has been dropped.</p>
</div></details></div>
<div class="toot" id="closed-351"><h2>Issue #351 closed<span class="toot-id"> #closed-351</span></h2><div class="pubdate">16 Feb at 08:48:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="created-351"><h2>Pull request #351 created<span class="toot-id"> #created-351</span></h2><div class="pubdate">16 Feb at 08:48:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/351">https://github.com/qt4cg/qtspecs/pull/351</a></div><p>Another attempt to build off the merge-base branch</p></div>
<div class="toot" id="closed-341"><h2>Issue #341 closed<span class="toot-id"> #closed-341</span></h2><div class="pubdate">16 Feb at 00:17:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><p>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</p></div>
<div class="toot" id="created-350"><h2>Issue #350 created<span class="toot-id"> #created-350</span></h2><div class="pubdate">16 Feb at 00:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/350">https://github.com/qt4cg/qtspecs/issues/350</a></div><details><summary>[XPath] CompPath (Composite-objects path) Expressions</summary><div class="markup"><h1>CompPath (Composite-objects path) Expressions</h1>
<p>As initially discussed in issue #341, we were exploring different ways to provide an XPath-like language to traverse in depth composite objects such as maps and arrays and select their members at any depth.
While working on this, the idea of an XPath-like language for composite items started to emerge and here we present this idea in a more or less crystalized form.</p>
<h2>1. Root Component</h2>
<p>Any CompPath expression must start off a composite item (of type map or array, or of other future composite item type (maybe set? )  ).
This can be a literal composite item or a reference to a variable whose value is a composite item.</p>
<p>Examples:</p>
<pre><code class="language-xq">
(: Literal composite items: :)
[1, 2, 3]

[1, [2,  3]]?2

{"x":1, "y" : map{ "z": 2}}

{"x":1, "y" : map{ "z": 2}} ?y

(: Variables containing composite items: :)
let $comp1 := [1, [2, 3]],
 $comp2 :=$comp1 ?2,
 $comp3 := {"x":1, "y" : map{ "z": 2}},
 $comp4 := $comp3 ?y
</code></pre>
<p>In the above examples all literal expressions and all variables (<strong><code>$comp1, $comp2, $comp3, $comp4</code></strong>) may serve as the root component for a CompPath expression.</p>
<h2>2. The component-path operator (\)</h2>
<p>The component-path operator "\" is used to build expressions for locating members at any depth within component trees. Its left-hand side expression must return a result that is a composite item or else this result is represented as such by wrapping it into an array.</p>
<p>The operator returns an array, the values of whose members are composite items themselves or any such value may be a non-composite "leaf" in the root-component tree).</p>
<p>Each operation E1\E2 is evaluated as follows: Expression E1 is evaluated, and the result is wrapped in an array A1. If any member of A1 is not a composite item, a type error is raised.
Each member of A1 serves in turn  to provide an inner "composite-focus" (the member as the "composite-context-item" or <strong><code>.</code></strong>, its index in A1 as the "composite-context-position" or <strong><code>index()</code></strong>, the set of keys of the composite-context-item as the "composite-keyset" or <strong><code>keys()</code></strong> and the size of this member as the "composite-context-size" (specified as one of: <strong><code>size()</code></strong>, or <strong><code>array-size()</code></strong> or <strong><code>key-size()</code></strong>) ) for the evaluation of E2. The result of each evaluation of  E2, if it isn't a single composite item, is wrapped in a single array. The arrays resulting from all the evaluations of E2 are wrapped  in a single array and this single array is the result of the evaluation.</p>
<p>E2 is typically a function over the <em>context-focus</em>  and its results will be the set of the next step composite-context-items (used as the left-hand-side of the next in chain composite-step-expression (see below)), or these results would be the final results of evaluation if this is the last-in chain composite-step-expression.</p>
<h2>3. Composite-Steps</h2>
<p>A <strong>composite-step</strong> is a part of a composite-path-expression that generates an array and filters its members by zero or more predicates. A <strong>composite-step-expression</strong> is either a <em>CompositeAxisStep</em> or a <em>CompositePostfixExpression</em>.</p>
<h2>4. Composite-Axes</h2>
<p>The following axes are defined for traversing a composite-item tree:</p>
<ul>
<li>The <strong><code>child-member::</code></strong> axis contains the members of the composite-context-item.</li>
<li>The  <strong><code>value-member::</code></strong>  axis contains the members of the composite-context-item that are not composite themselves.</li>
<li>The  <strong><code>node-member::</code></strong>  axis contains the members of the composite-context-item that are nodes.</li>
<li>The <strong><code>descendant-member::</code></strong> axis is defined as the transitive closure of the <strong><code>child-member::</code></strong> axis; it contains the descendent-members of the composite-context-item (the child members of the composite-context-item, and their child-members, ... and so on).</li>
<li>The <strong><code>self::</code></strong> axis contains just the composite-context-item.</li>
<li>The <strong><code>descendant-member-or-self::</code></strong> contains the composite-context-item and all of its descendent-members.</li>
<li>The <strong><code>following-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that follow it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem2</em></strong> follows <strong><em>mem1</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
<li>The <strong><code>preceding-sibling-member::</code></strong> axis contains the members of the immediate container of the composite-context-item that precede it. For any two members <strong><em>mem1</em></strong> and <strong><em>mem2</em></strong> of a composite item <strong><em>Comp</em></strong>, by definition <strong><em>mem1</em></strong> precedes <strong><em>mem2</em></strong> if and only if <strong><em>Comp</em></strong> is an array and the index of <strong><em>mem2</em></strong> in <strong><em>Comp</em></strong> is greater than that of <strong><em>mem1</em></strong>, or if <strong><em>Comp</em></strong> is a map, then the key of <strong><em>mem2</em></strong> is greater than that of <strong><em>mem1</em></strong>.</li>
</ul>
<p>For example, <strong><code>following-sibling-member::5</code></strong> means all members of the composite-context-item with index &gt; 5,
and <strong><code>preceding-sibling-member::5</code></strong> means all members of the composite-context-item with index &lt; 5</p>
<p><strong>Note</strong>: If the immediate container of the composite-context-item is a map whose key-values cannot be ordered, then specifying either of the <strong><code>following-sibling-member::</code></strong> or <strong><code>preceding-sibling-member::</code></strong> axes on this composite-context-item must raise a type error. (Obviously, these two axes are meaningful only for composite items, whose members are ordered, such as the array).</p>
<p>If the composite-axis name is omitted from a composite-axis step, the default axis is <strong><code>child-member::</code></strong></p>
<h2>5. Composite Axis Steps</h2>
<p>A composite axis step completely resembles the ordinary axis step in XPath. It consists of three parts:</p>
<ol>
<li>The composite axis  (<strong><code>child-member::</code></strong>, <strong><code>descendant-member::</code></strong>, <strong><code>value-member::</code></strong>, <strong><code>node-member::</code></strong>, <strong><code>following-sibling-member::</code></strong>, <strong><code>preceding-sibling-member::</code></strong>, <strong><code>self::</code></strong>, or the <strong><code>descendant-member-or-self::</code></strong> axis)</li>
<li>The member test</li>
<li>The composite-predicates</li>
</ol>
<h2>6. Member Tests</h2>
<p>A member test is a condition on the key-name, index, or kind (<em>composite</em>, <em>map</em>, <em>array</em> or <em>value</em>, <em>node</em>, or (any) <em>member</em>). A member test determines which members contained by a copmosite-axis are selected by a composite-step.</p>
<p>As such, a member test is either an <em>identifier-test</em> (key-name or index) or a <em>kind-test</em> (<em>composite</em>, <em>map</em>, <em>array</em>,  <em>value</em>, or <em>member</em>)).</p>
<p>Examples of member identifiers:</p>
<ul>
<li>
<p>A string specifies a name of a key, whose value will be selected. For example: <strong><code>\child-member::X</code></strong> selects from the composite-context-item the value corresponding to its key which has the name "X".</p>
</li>
<li>
<p><strong><code>\child-member::3</code></strong> selects from the composite-context-item the value of its 3rd member, if it is an array or the value corresponding to its key <strong><code>3</code></strong>, if it is a map.</p>
</li>
<li>
<p><strong><code>following-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index greater than 3.</p>
</li>
<li>
<p><strong><code>preceding-sibling-member::3</code></strong> selects from the composite-content-item (which is most-likely an array) all of its members having index less than 3.</p>
</li>
<li>
<p><strong><code>\descendant-member-or-self::X</code></strong> selects from the composite-context-item (that must be a map) and from all its descendant-members, the values corresponding to their key named "X", if these descendents have a key named "X".</p>
</li>
<li>
<p>Similarly <strong><code>\5</code></strong> is equivalent to <strong><code>\child-member::5</code></strong> and selects from the composite-context-item that is an array the value of its 5th member. This will also select the value corresponding to the key <strong><code>5</code></strong> from the composite-context-item if it is a map, because on the <strong><code>child-member::</code></strong> axis both maps and arrays may be selected.</p>
</li>
<li>
<p><strong><code>\X</code></strong> is equivalent to <strong><code>\child-member::X</code></strong> and selects from the composite-context-item (that must be a map), the value corresponding to its key which has the name "X".</p>
<p>There is also the pseudo-operator <code>\\</code> . This is an abbreviation for:</p>
<p><strong><code>\descendant-member-or-self::member()\</code></strong></p>
<p>Thus, <strong><code>\\X</code></strong> means: "(Deep) Select all members of the root-component that are the corresponding values of keys equal to 'X' "</p>
</li>
<li>
<p>We may use a <strong><em>kind test</em></strong> as part of the previous example, if we want to select only a specific kind of members of the composite-context-item.
<strong><code>\array()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are arrays.</p>
</li>
<li>
<p><strong><code>\map()</code></strong>  In this example, although we are on the <strong><code>child-member::</code></strong> axis, we want to select only members of the composite-context-item that are maps.</p>
</li>
<li>
<p><strong><code>\value()</code></strong>  In this example we want to select only members of the composite-context-item that are not composite items themselves.</p>
</li>
<li>
<p><strong><code>\node()</code></strong>  In this example we want to select only members of the composite-context-item that are nodes.</p>
</li>
<li>
<p><strong><code>\member()</code></strong>  In this example we want to select all members of the composite-context-item, regardless whether they are maps, arrays, or values.</p>
</li>
</ul>
<h3>6.1 Wildcards</h3>
<p>The <strong><code>*</code></strong> wildcard can be used instead of a member identifier. Its meaning is to select all existing members of the composite-context-item, that is possibly selected by a specific axis and limited by a specific member kind-test.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*</code></strong>  (: (Shallow) Selects all members of the composite-context-item :)</li>
<li><strong><code>\map()\*</code></strong>  (: Selects from the composite-context-item all values that correspond to a key of any map-member of the composite-context item :)</li>
<li><strong><code>\array()\*</code></strong>  (: Selects from the composite-context-item all members of all its members that are arrays :)</li>
<li><strong><code>\\*</code></strong>  (: (Deep) Select all members of the composite tree rooted by the root-component :)</li>
</ul>
<h2>7. Predicates</h2>
<p>As defined above, a <strong>composite-step</strong> has three parts: <em>composite-axis</em> (can be omitted and then a default axis is used), <em>member test</em>, and an optional <em>list of composite-predicates</em>.</p>
<p>A <strong><em>composite-predicate</em></strong> in a composite-step is an expression used as a <em>filter</em> applied on the members of the composite-context-item that are already selected by the axis and member tests of the axis step, and not filtered out by any preceding composite-predicates in the <em>composite-predicates-list</em>. The composite-predicate may be any XPath expression and is written within double square brackets.</p>
<p><strong>Examples</strong>:</p>
<ul>
<li><strong><code>\*[[3]]</code></strong>  (: Selects any member of the composite-context-item, that is an array and has a 3rd member or any member of the composite-context-item, that is a map and has a key <strong>3</strong> :)
This is a shorthand for: <strong><code>\*[[array-size() ge 3 or 3 = keys()]]</code></strong></li>
<li><strong><code>\array()[[3]]</code></strong> (: Selects those array members of the composite-context-item that have a 3rd member :)
This is a shorthand for: <strong><code>\*[[size() ge 3]]</code></strong></li>
<li><strong><code>\*[[size() eq 7]]</code></strong>  (: Selects those members whose array-size() or key-size() is exactly 7:)
This is a shorthand for: <strong><code>\composite::*[[self::map() and key-size() eq 7 or self::array() and array-size() eq 7]]</code></strong></li>
<li><strong><code>\*[[X]]</code></strong>  (: Selects any member of the composite-context-item, that is a map and has a key <strong>X</strong>  :)</li>
<li><strong><code>\map()[[X]]</code></strong> (: Selects any map member of the composite-context-item, that has a key <strong>X</strong>  :)
The above two expressions are a shorthand for: <strong><code>\*[['X' = keys()]]</code></strong></li>
<li><strong><code>\value()[[. gt 0]]</code></strong> (: Selects any value (non-composite member) of the composite-context-item, that is a positive number :)</li>
</ul>
<h2>8. Mixing CompPath and XPath expressions</h2>
<p>CompPath and XPath expressions can be used as parts of a single expression:</p>
<ul>
<li>
<p>A CompPath expression may be appended at the end of any XPath expression that produces a composite-object .</p>
</li>
<li>
<p>An XPath expression may be appended at the end of any CompPath expression. When doing this,</p>
<p><strong><code>CompPathExpr / XPathExpr</code></strong></p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\node::* / XPathExpr</code></strong></p>
<p>And this:</p>
<p><strong><code>CompPathExpr ! XPathExpr</code></strong>  (:  Note: also causes ordering and deduplication of the nodes! :)</p>
<p>is equivalent to:</p>
<p><strong><code>CompPathExpr\value::* !  XPathExpr</code></strong>  (: Note: No ordering or deduplication, can be applied on any item, not just on nodes :)</p>
</li>
<li>
<p>A CompPath expression may be substituted for the expected argument of any XPath expression, for example:
<strong><code>count(MyCompPathExpr)</code></strong></p>
</li>
<li>
<p>Any XPath expression that produces a composite item can be used as the composite-root for any CompPath expression</p>
</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-xq">let $myBooks := 
&lt;books&gt;
 &lt;book name="Tom Sawyer"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Wuthering Heights"&gt;
   &lt;author&gt;Emily Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Jane Eyre"&gt;
   &lt;author&gt;Charlotte Brontë&lt;/author&gt;
 &lt;/book&gt;
 &lt;book name="Adventures of Huckleberry Finn"&gt;
   &lt;author&gt;Mark Twain&lt;/author&gt;
 &lt;/book&gt;
&lt;/books&gt;,
$map1 := map {"science-works": map{"Einstein": "Special Theory of relativity",
                                  "Darwin" : "On the Origin of Species"
                                 },
             "literature" : map{"19the Century": $myBooks}
            }
return
  $map1\literature\\*/book[author eq 'Mark Twain']
</code></pre>
<p>Evaluating this mixed CompPath and XPath expression produces the correct result:</p>
<pre><code class="language-xq">&lt;book name="Tom Sawyer"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
&lt;book name="Adventures of Huckleberry Finn"&gt;
  &lt;author&gt;Mark Twain&lt;/author&gt;
&lt;/book&gt;
</code></pre>
</div></details></div>
<div class="toot" id="closed-349"><h2>Issue #349 closed<span class="toot-id"> #closed-349</span></h2><div class="pubdate">15 Feb at 18:04:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="created-349"><h2>Pull request #349 created<span class="toot-id"> #created-349</span></h2><div class="pubdate">15 Feb at 18:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/349">https://github.com/qt4cg/qtspecs/pull/349</a></div><p>Revert PR change; it doesn't work in this context</p></div>
<div class="toot" id="closed-348"><h2>Issue #348 closed<span class="toot-id"> #closed-348</span></h2><div class="pubdate">15 Feb at 17:46:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><p>Attempt to build PR with merge-base version of master</p></div>
<div class="toot" id="created-348"><h2>Pull request #348 created<span class="toot-id"> #created-348</span></h2><div class="pubdate">15 Feb at 17:46:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/348">https://github.com/qt4cg/qtspecs/pull/348</a></div><details><summary>Attempt to build PR with merge-base version of master</summary><div class="markup"><p>This PR changes the CI <code>build-pr.yml</code> script so that it checks out the version of master that the branch started from, rather than the current version of master, for building the specifications.</p>
<ul>
<li>Pro: we won't get build failures when the current master can't build the old version (for example, when images have been removed)</li>
<li>Con: we won't get any features from the current master, such as stylesheet updates</li>
</ul>
<p>Since failing builds are more troublesome than formatting issues, I'm going to say the pros outweigh the cons.</p>
</div></details></div>
<div class="toot" id="created-347"><h2>Pull request #347 created<span class="toot-id"> #created-347</span></h2><div class="pubdate">15 Feb at 14:06:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/347">https://github.com/qt4cg/qtspecs/pull/347</a></div><details><summary>Attempt to clarify fn:parse-uri and fn:build-uri</summary><div class="markup"><p>Fix #307</p>
</div></details></div>
<div class="toot" id="closed-346"><h2>Issue #346 closed<span class="toot-id"> #closed-346</span></h2><div class="pubdate">15 Feb at 10:11:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><p>Remove dagger from record cross-references</p></div>
<div class="toot" id="created-346"><h2>Pull request #346 created<span class="toot-id"> #created-346</span></h2><div class="pubdate">15 Feb at 10:10:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/346">https://github.com/qt4cg/qtspecs/pull/346</a></div><details><summary>Remove dagger from record cross-references</summary><div class="markup"><p>Record types are better supported by the stylesheets so the dagger is simply a distraction.</p>
</div></details></div>
<div class="toot" id="created-345"><h2>Issue #345 created<span class="toot-id"> #created-345</span></h2><div class="pubdate">14 Feb at 22:52:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/345">https://github.com/qt4cg/qtspecs/issues/345</a></div><details><summary>Missing rule for matching atomic values against atomic types</summary><div class="markup"><p>In XPath §3.6.2 we have forgotten to state the obvious rule:</p>
<p>"An Atomic Value AV matches a generalized atomic type GAT if the type annotation of AV (call it T) satisfies the condition derives-from(T, GAT)."</p>
<p>At the same time it would a good idea to clarify whether locally-declared union and enum types fall within the definition of "schema types" (I think they should do so.)</p>
</div></details></div>
<div class="toot" id="closed-342"><h2>Issue #342 closed<span class="toot-id"> #closed-342</span></h2><div class="pubdate">14 Feb at 17:24:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><p>Issue318 meta elements</p></div>
<div class="toot" id="minutes-02-14"><h2>QT4 CG meeting 022 draft minutes<span class="toot-id"> #minutes-02-14</span></h2><div class="pubdate">14 Feb at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-14">https://qt4cg.org/meeting/minutes/2023/02-14</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-338"><h2>Issue #338 closed<span class="toot-id"> #closed-338</span></h2><div class="pubdate">09 Feb at 17:30:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><p>Add ednote per action QT4CG-016-02</p></div>
<div class="toot" id="created-344"><h2>Pull request #344 created<span class="toot-id"> #created-344</span></h2><div class="pubdate">09 Feb at 17:06:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/344">https://github.com/qt4cg/qtspecs/pull/344</a></div><details><summary>Issue 22: allow "for"/"let" keyword to be repeated in XPath</summary><div class="markup"><p>Addresses the proposal in issue 22 to allow repetition of the "let" or "for" keyword in a ForExpr or LetExpr. (It does not, however, allow "for" and "let" to be mixed).</p>
</div></details></div>
<div class="toot" id="created-343"><h2>Issue #343 created<span class="toot-id"> #created-343</span></h2><div class="pubdate">09 Feb at 12:47:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/343">https://github.com/qt4cg/qtspecs/issues/343</a></div><details><summary>XQFO: $collation argument</summary><div class="markup"><p>In the function set of the XQFO current specification, the type of the <code>$collation</code> parameter is sometimes <code>xs:string</code> and sometimes <code>xs:string?</code>, depending on the position of the parameter. Examples:</p>
<h4>Mandatory</h4>
<pre><code class="language-xquery">fn:distinct-values($values as&nbsp;xs:anyAtomicType*, $collation as fn:default-collation())&nbsp;as&nbsp;xs:anyAtomicType*
fn:index-of($input | as&nbsp;xs:anyAtomicType*, $search | as&nbsp;xs:anyAtomicType, $collation as&nbsp;xs:string)&nbsp;as&nbsp;xs:integer*
</code></pre>
<h4>Optional</h4>
<pre><code class="language-xquery">fn:sort($input as&nbsp;item()*, $collation as&nbsp;xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*
fn:lowest($input as item()*, $collation as xs:string?, $key as&nbsp;function(item()) as xs:anyAtomicType*)&nbsp;as&nbsp;item()*
</code></pre>
<p>I think we should always allow an empty sequence.</p>
</div></details></div>
<div class="toot" id="created-342"><h2>Pull request #342 created<span class="toot-id"> #created-342</span></h2><div class="pubdate">09 Feb at 12:27:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/342">https://github.com/qt4cg/qtspecs/pull/342</a></div><details><summary>Issue318 meta elements</summary><div class="markup"><p>Revises the rules for serializing meta elements to take account of new HTML5 syntax.</p>
<p>Resolves issue #318</p>
</div></details></div>
<div class="toot" id="closed-330"><h2>Issue #330 closed<span class="toot-id"> #closed-330</span></h2><div class="pubdate">08 Feb at 08:35:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><p>Update fn:parse-html to apply review feedback.</p></div>
<div class="toot" id="created-341"><h2>Issue #341 created<span class="toot-id"> #created-341</span></h2><div class="pubdate">08 Feb at 01:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/341">https://github.com/qt4cg/qtspecs/issues/341</a></div><details><summary>[XPath] Error-free selection operator for maps or arrays, or finite-domain functions</summary><div class="markup"><p>In March 2021 Jarno Elovirta raised on the <strong><em>#general channel</em></strong> of the XML.com Slack the problem that the existing map or array lookup operator "<strong>?</strong>" prevents a free traversal of a nested mapp/array object. For example, this expression results in error:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  ?* ?("k0")  ?*
</code></pre>
<p><strong>[XPTY0004] Input of lookup operator must be map or array: 1.</strong></p>
<hr>
<p>There are three possible types of reaction to this problem:</p>
<ol>
<li>
<p>Do nothing</p>
</li>
<li>
<p>Relax the semantics of the map/array lookup operator "<strong>?</strong>" so that it can be applied on items of non-map/non-array type and in such case produce the empty sequence.</p>
</li>
<li>
<p>Introduce a similar operator to "<strong>?</strong>" that will behave as it, but instead of producing an error when applied on items of non-map/non-array type it produces the empty sequence.</p>
</li>
</ol>
<p>Obviously, we are not advocating the 1st choice above, or otherwise we wouldn't be raising any issue 😄</p>
<p>Choice 2 could be implemented, but this would have a few drawbacks:</p>
<ul>
<li>it would bring a certain degree of backwards incompatibility</li>
<li>"silently returning nothing" is really difficult to debug or even notice unexpected results, as pointed out by @michaelhkay</li>
</ul>
<p><strong>This proposal is to choose alternative 3. above</strong>.</p>
<p>Why is it better than the 2nd one?</p>
<ul>
<li>No incompatibility can be introduced, as this is a new operator.</li>
<li>The user has intentionally chosen this operator over the "?" operator, and this means that the user is well aware of the new, sometimes tricky to observe/explain/debug behavior, but the user doesn't mind these effects and is ready to deal with them.</li>
</ul>
<h2>Definition</h2>
<p>By definition the operator <strong>"-&gt;"</strong> with left-hand-side any expression <strong><em>E</em></strong> and right-hand-side a literal string  <strong><em>X</em></strong>:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E -&gt; X</code></strong></p>
<p>is lexically expanded to:</p>
<p>&nbsp;&nbsp;&nbsp;<strong><code>E[. instance of map(*) or . instance of array(*)]?X </code></strong></p>
<h2>Example</h2>
<p>With the original expression provided by Jarno Elovirta, but now using the <strong>"-&gt;"</strong> operator:</p>
<pre><code class="language-xq">[
  map {"k0": 1}, 
  map{"k0": [1, 2, 3]}
]  -&gt;* -&gt;("k0")  -&gt;*
</code></pre>
<p>its evaluation produces the expected result (all the values within just one of the leaves of the tree), and no error:</p>
<p><strong><code>1, 2, 3</code></strong></p>
<p>That is, <strong><code>1 -&gt;*</code></strong>  produces the empty sequence and no error.</p>
<p><strong>Note</strong>:</p>
<p>Of course, the above example can be rewritten to this equivalent XPath 3.0 expression and will get the wanted result, but literally no one, myself included, will ever write this:</p>
<pre><code class="language-xq">[
 map {"k0": 1}, 
 map{"k0": [1, 2, 3]}
] [. instance of map(*) or . instance of array(*)]      ?*
           [. instance of map(*) or . instance of array(*)]      ?k0
                                [. instance of map(*) or . instance of array(*)]   ?*
</code></pre>
<p><img src="https://user-images.githubusercontent.com/10605892/217432167-5f7fbff0-3d8d-48a3-a27d-5f62cb77c3dc.png" alt="image"></p>
<h2>Thus <strong><em><code>this is all about making it possible/feasible and empowering our users!</code></em></strong></h2>
</div></details></div>
<div class="toot" id="created-340"><h2>Issue #340 created<span class="toot-id"> #created-340</span></h2><div class="pubdate">07 Feb at 22:02:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/340">https://github.com/qt4cg/qtspecs/issues/340</a></div><details><summary>fn:format-number: Specifying decimal format</summary><div class="markup"><p>It would be nice if the decimal format for <code>fn:format-number</code> could also be supplied via an options argument:</p>
<pre><code>format-number(
  value := 123.45,
  picture := '#.##0,00',
  format := map { 'decimal-separator': ',', 'grouping-separator': '.' }
)
</code></pre>
<p>If both <code>$decimal-format-name</code> and <code>$format</code> are supplied, an error would probably need to be raised.</p>
<p>The current writing of the query above is:</p>
<pre><code>declare decimal-format de decimal-separator = ',' grouping-separator = '.';

format-number(
  value := 123.45,
  picture := '#.##0,00',
  decimal-format-name': 'de'
)
</code></pre>
</div></details></div>
<div class="toot" id="minutes-02-07"><h2>QT4 CG meeting 021 draft minutes<span class="toot-id"> #minutes-02-07</span></h2><div class="pubdate">07 Feb at 17:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/02-07">https://qt4cg.org/meeting/minutes/2023/02-07</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-339"><h2>Issue #339 created<span class="toot-id"> #created-339</span></h2><div class="pubdate">07 Feb at 13:46:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/339">https://github.com/qt4cg/qtspecs/issues/339</a></div><details><summary>The constraints on document-uri are too...constraining</summary><div class="markup"><p>The XPath data model imposes the following constraints on the document-uri property:</p>
<blockquote>
<p>If the <code>document-uri</code> is not the empty sequence, then the following constraint must hold: the node returned by evaluating <code>fn:doc()</code> with the document-uri as its argument must return the document node that provided the value of the <code>document-uri</code> property.</p>
<p>In other words, for any Document Node <code>$arg</code>, either <code>fn:document-uri($arg)</code> must return the empty sequence or <code>fn:doc(fn:document-uri($arg))</code> must return <code>$arg</code>.</p>
</blockquote>
<p>This contraint turns out to be inconvenient whenever the larger environment doesn’t enforce a 1:1 mapping between URIs and documents.</p>
<p>For example, in a browser context, a JavaScript function that returns different versions of the same document over time cannot identify those documents with the same document-uri.</p>
<p>In XProc, a <code>p:add-attribute</code> step that returns a copy of its input document with one additional attribute, cannot identify the output document with the same document-uri as the input document.</p>
<p>Given that the document URI is often necessary to evaluate relative URI references within a document, the constraints imposed in the data model are too strict.</p>
</div></details></div>
<div class="toot" id="created-338"><h2>Pull request #338 created<span class="toot-id"> #created-338</span></h2><div class="pubdate">07 Feb at 13:33:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/338">https://github.com/qt4cg/qtspecs/pull/338</a></div><details><summary>Add ednote per action QT4CG-016-02</summary><div class="markup"><p>This is a purely editorial change. Unless someone objects over the next few days, I'm just going to merge it in.</p>
</div></details></div>
<div class="toot" id="agenda-02-07"><h2>QT4 CG meeting 021 draft agenda<span class="toot-id"> #agenda-02-07</span></h2><div class="pubdate">04 Feb at 15:09:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/02-07">https://qt4cg.org/meeting/agenda/2023/02-07</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-337"><h2>Issue #337 created<span class="toot-id"> #created-337</span></h2><div class="pubdate">02 Feb at 00:52:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/337">https://github.com/qt4cg/qtspecs/issues/337</a></div><details><summary>Local union and enum types: and the definition of generalised atomic types</summary><div class="markup"><p>We need to review the proposed specs for local union and enum types, and decide whether or not to proceed with them.</p>
<p>I note that the definitions of <strong>generalized atomic type</strong> and <strong>pure union type</strong> say they must be "schema-defined", which appears to exclude locally-defined union and enum types.</p>
<p>I wonder if the definition of local enum types should be aligned more closely with an XSD type derived from xs:string by restricting with an enum facet. Now that we allow down-casting in the coercion rules, the objections to this seem to disappear.</p>
<p><code>cast</code> and <code>castable</code> should also probably pay more attention to these types.</p>
</div></details></div>
<div class="toot" id="created-336"><h2>Pull request #336 created<span class="toot-id"> #created-336</span></h2><div class="pubdate">01 Feb at 12:48:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/336">https://github.com/qt4cg/qtspecs/pull/336</a></div><details><summary>Action QT4CG-019-01 (type of $pattern in fn:tokenize())</summary><div class="markup"><p>Also, update the fos:history record for a number of functions.</p>
</div></details></div>
<div class="toot" id="closed-308"><h2>Issue #308 closed<span class="toot-id"> #closed-308</span></h2><div class="pubdate">01 Feb at 12:13:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><p>Improve the legends in the diagrams</p></div>
<div class="toot" id="closed-335"><h2>Issue #335 closed<span class="toot-id"> #closed-335</span></h2><div class="pubdate">01 Feb at 12:13:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><p>Rework type hierarchy diagrams as styled lists</p></div>
<div class="toot" id="created-335"><h2>Pull request #335 created<span class="toot-id"> #created-335</span></h2><div class="pubdate">01 Feb at 12:13:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/335">https://github.com/qt4cg/qtspecs/pull/335</a></div><details><summary>Rework type hierarchy diagrams as styled lists</summary><div class="markup"><p>Close #308</p>
<p>This proposal was accepted at meeting 020 on 31 January 2023.</p>
<p>The PR won't format correctly because there are style changes, so I'm just going to merge this. I have fixed the diagrams in both the data model specification and f&amp;o.</p>
</div></details></div>
<div class="toot" id="closed-324"><h2>Issue #324 closed<span class="toot-id"> #closed-324</span></h2><div class="pubdate">01 Feb at 10:17:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><p>Proposed syntax and semantics for string templates</p></div>
<div class="toot" id="closed-326"><h2>Issue #326 closed<span class="toot-id"> #closed-326</span></h2><div class="pubdate">01 Feb at 10:17:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="closed-319"><h2>Issue #319 closed<span class="toot-id"> #closed-319</span></h2><div class="pubdate">01 Feb at 10:17:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><p>Issue 221: op:same-key becomes fn:atomic-equal</p></div>
<div class="toot" id="created-334"><h2>Issue #334 created<span class="toot-id"> #created-334</span></h2><div class="pubdate">01 Feb at 09:17:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/334">https://github.com/qt4cg/qtspecs/issues/334</a></div><details><summary>Transient properties: a new approach to deep selection and update in maps and arrays</summary><div class="markup"><p>After exploring many alternatives, I have come to the conclusion that we can't solve the problem of deep navigation and transformation of JSON structures without a data model change.</p>
<p>Most of the problems boil down to this: JSON trees do not have parent pointers, therefore after navigating down to a leaf node of the tree, we cannot get any information from higher up the tree. The solution to this (the "zipper" model) is to retain transient information about how a particular node in the tree was reached, so that we can retrace our steps and revisit nodes that were passed en route.</p>
<p>The change I propose is quite minor, but powerful: Any XDM value can be augmented with a set of transient properties represented as a set of key-value pairs. These properties are ignored (and typically dropped) by all operations on a value, except where otherwise specified. For the purpose of exposition, I'll use the syntax <code>$value¶name</code> to refer to the transient <code>name</code> property of <code>$value</code>.</p>
<p>We'll change the semantics of <code>map:get()</code> and <code>array:get()</code>, and the associated lookup operators, so that the resulting values have transient properties indicating how they were selected. For example, given</p>
<p><code>let $name := $person?firstName</code></p>
<p>the resulting value (perhaps the string "Michael") will be augmented with transient properties</p>
<ul>
<li>¶parent - the map from which the value was selected (retaining its own transient properties if any)</li>
<li>¶key - the key used to make the selection, here "firstName"</li>
</ul>
<p>and derived properties:</p>
<ul>
<li>¶ancestors - the transitive closure of ¶parent</li>
<li>¶root - the last ¶ancestor</li>
<li>¶path - a string representation of the path used to select the value</li>
</ul>
<p>We can also define other "downward selection" operations such as <code>map:find</code>, and <code>array:foot</code> to retain these transient properties. So for example <code>map:find($json, 'firstname')[.='Michael']¶parent?surname</code> now finds the surnames of anyone named 'Michael', at any depth of the tree.</p>
<p>If we turn back to the use cases in my 2016 paper on transforming JSON</p>
<p>https://www.saxonica.com/papers/xmlprague-2016mhk.pdf</p>
<p>The first use case (bulk update) relied on matching items expressed in XML as</p>
<p><code>match="map[array[@key='tags']/string='ice']/number[@key='price']/text()"</code></p>
<p>which couldn't be done in JSON because of the inability to match based on ancestor context. With the new transient properties we can match this as</p>
<p><code>match="type(xs:integer)[¶key = 'price'][¶parent?tags?* = 'ice']"</code></p>
<p>In the second use case (hierarchic inversion), we can again get properties of parent or ancestor maps</p>
<p><code>$students ! map:put("course", ¶parent?name)</code></p>
<p>I think we can also use this to define deep update operations. But I'll leave that investigation until later.</p>
<p>Note: transient properties potentially have many other applications, for example we might use them to solve our problems with <code>document-uri()</code>. But exploring that would be a distraction here. The nice thing about transient properties is that they give a lot of potential for augmenting existing functionality with full backwards compatibility, because we can define existing operations to return results with additional transient properties that all existing operations will ignore. If we were so minded, for example, we could have different functions/operators return "quiet NaN" and "signalling NaN" by adding a transient property to the NaN value returned.</p>
</div></details></div>
<div class="toot" id="created-333"><h2>Issue #333 created<span class="toot-id"> #created-333</span></h2><div class="pubdate">01 Feb at 00:34:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/333">https://github.com/qt4cg/qtspecs/issues/333</a></div><details><summary>Equality of function items</summary><div class="markup"><p>The question of equality of function items arises in the discussion of determinism of functions and memo functions in XSLT - see F&amp;O 3.1 section 1.7.4, and came up again today in the context of fn:deep-equal.</p>
<p>1.7.4 makes a brave attempt to describe situations under which two functions are "identical", though leaving implementations room for flexibility. I think we can build on this and improve it, by describing more situations in which the result is predictable.</p>
<p>The data model describes the properties of a function item, and we can say that two function items are equivalent if all their properties are the same.</p>
<p>The properties that cause problems are the "implementation" and the "closure", and in both cases I think we can find ways of doing a comparison.</p>
<p>For the implementation, we can define this by reference to the way in which the implementation property is set. For function items constructed by reference to static functions (e.g. <code>my:func#3</code> or <code>function-lookup(my:func, 3)</code>) then they have the same implementation if and only if they are constructed by reference to the same static function. Similarly for function items constructed by evaluating an inline function expression. Other ways of constructing a function item, such as partial application, essentially create a new function with the same implementation as an existing function and a different closure.</p>
<p>For the closure (ignoring for the moment functions that include parts of the dynamic context in their closure), this is essentially just a set of variable bindings and it's not too difficult to say that functions are identical if these sets of variable bindings are identical.</p>
</div></details></div>
<div class="toot" id="created-332"><h2>Issue #332 created<span class="toot-id"> #created-332</span></h2><div class="pubdate">31 Jan at 18:51:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/332">https://github.com/qt4cg/qtspecs/issues/332</a></div><details><summary>Add a namespace uris option to fn:path</summary><div class="markup"><p>The output of <code>fn;path</code> using namespaces is very verbose as it is specified to use the <code>Q{uri}name</code> syntax. It would be useful if it was extended to take a namespace prefix to uri map.</p>
<ol>
<li>Add a second <code>$namespaces</code> parameter that has the type <code>map(union(xs:NCName, enum('')), xs:anyURI)</code> (the same as fn:in-scope-namespaces) -- this will have a default value of <code>map{}</code> to preserve the existing behaviour.</li>
<li>If the namespace uri is in the map, use the given prefix. If that prefix is "" then just use the local name.</li>
<li>If the namespace uri is not in the map, use the <code>Q{uri}name</code> syntax.</li>
</ol>
<p>This allows for things like <code>fn:path($e, namespaces := fn:in-scope-namespaces())</code>.</p>
</div></details></div>
<div class="toot" id="created-331"><h2>Issue #331 created<span class="toot-id"> #created-331</span></h2><div class="pubdate">31 Jan at 18:43:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/331">https://github.com/qt4cg/qtspecs/issues/331</a></div><details><summary>Extend fn:path to support arrays and maps.</summary><div class="markup"><p>Currently, <code>fn:path</code> is defined for nodes. This means it is not possible to use it with arrays or maps (e.g. to determine the path to a JSON item when a comparison fails).</p>
<p>As such, I recommend:</p>
<ol>
<li>changing the type to <code>item()</code></li>
<li>If the value is a node use the current logic.</li>
<li>If the value is in an array, use <code>?n</code> where n is the nth item of the array where the item is located.</li>
<li>If the value is in a map, use <code>?name</code> or <code>?"name"</code> where name is the key name of the map where the item is located.</li>
<li>If the value is an atomic item, or the root of a map/array structure, use <code>.</code>.</li>
</ol>
<p>Example: <code>.?4?user?name</code></p>
</div></details></div>
<div class="toot" id="minutes-01-31"><h2>QT4 CG meeting 020 draft minutes<span class="toot-id"> #minutes-01-31</span></h2><div class="pubdate">31 Jan at 17:12:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-31">https://qt4cg.org/meeting/minutes/2023/01-31</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-330"><h2>Pull request #330 created<span class="toot-id"> #created-330</span></h2><div class="pubdate">31 Jan at 12:56:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/330">https://github.com/qt4cg/qtspecs/pull/330</a></div><details><summary>Update fn:parse-html to apply review feedback.</summary><div class="markup"><p>This PR applies the following review comments:</p>
<ul>
<li>[x] QT4CG-016-03: RD to add a note clarifying “known character encoding”</li>
<li>[x] QT4CG-016-04: RD to add a note clarifying the “<em>”/”</em>” html/version combination</li>
<li>[x] QT4CG-016-05: RD to add a “todo” noting the dependency on keyword arguments</li>
<li>[x] QT4CG-016-06: RD to reword the introduction to mapping to clarify who’s doing the mapping</li>
<li>[ ] QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li>[x] QT4CG-016-09: RD to add a note stating that the local name should always be lowercase</li>
<li>[x] QT4CG-016-10: RD to consider how to clarify parsed entity parsing.</li>
</ul>
</div></details></div>
<div class="toot" id="created-329"><h2>Issue #329 created<span class="toot-id"> #created-329</span></h2><div class="pubdate">30 Jan at 11:45:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/329">https://github.com/qt4cg/qtspecs/issues/329</a></div><details><summary>Keyword parameters: Error codes</summary><div class="markup"><p>I’ve read the current specification twice, and I have checked the existing qt4 tests, but I’m still confused by the exact meaning of the new error codes for keyword arguments, <code>XPST0141</code> and <code>XPST0142</code>. Things are getting particularly tricky if we consider partial function applications.</p>
<p>My proposal would be to simplify the current approach and:</p>
<ol>
<li>use the existing error code <code>XPST0017</code> for all cases in which a function cannot be chosen as the available arguments (both positional and keyword-based) don’t match the function definition, and</li>
<li>only raise a new error code (<code>XPST0141</code>, possibly) if a keyword argument has been specified more than once (as this can be done without checking the function definitions).</li>
</ol>
</div></details></div>
<div class="toot" id="created-328"><h2>Issue #328 created<span class="toot-id"> #created-328</span></h2><div class="pubdate">30 Jan at 10:05:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/328">https://github.com/qt4cg/qtspecs/issues/328</a></div><details><summary>Switch Cases: Lift single-item restriction on operands</summary><div class="markup"><h2>Motivation</h2>
<p><a href="https://www.w3.org/TR/xquery-31/#id-switch">XQuery switch cases</a> have a peculiar restriction: The operand of a single case must yield an empty sequence or a single item. There seem to be no (obvious) reasons why this restriction exists, so I believe we should lift it and allow arbitrary sequences.</p>
<p>A similar extension is planned for Java 12 (<a href="http://openjdk.java.net/jeps/325">JEP 325: Switch Expressions</a>). The required changes in XQuery are simpler, though, as the 3.1 grammar already supports arbitrary expressions as operands.</p>
<h2>Examples</h2>
<pre><code class="language-xquery">switch($value)
  case 1
  case 2
  case 3
  case 4
  case 5
    return 'small'
  default
    return 'big'
</code></pre>
<p>Proposed syntax:</p>
<pre><code class="language-xquery">switch($value)
  case 1 to 5
    return 'small'
  default
    return 'big'
</code></pre>
<h2>Required Changes</h2>
<p>The <a href="https://www.w3.org/TR/xquery-31/#id-switch">current matching rules</a> could be rephrased as follows:</p>
<ol>
<li>The SwitchCaseOperand is evaluated.</li>
<li>The resulting value is atomized.</li>
<li>The case matches if the value is empty and if the value of the switch expression is empty as well.</li>
<li>Otherwise, the atomized value of the switch operand expression is compared with each item of the atomized value of the SwitchCaseOperand using <code>fn:deep-equal</code>, with the default collation from the static context.</li>
</ol>
<h2>References</h2>
<ul>
<li>Original Proposal: https://github.com/expath/xpath-ng/pull/12</li>
<li>Discussion on Slack: https://xmlcom.slack.com/archives/C011NLXE4DU/p1675006336963479</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-01-31"><h2>QT4 CG meeting 020 draft agenda<span class="toot-id"> #agenda-01-31</span></h2><div class="pubdate">30 Jan at 08:47:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-31">https://qt4cg.org/meeting/agenda/2023/01-31</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-327"><h2>Issue #327 created<span class="toot-id"> #created-327</span></h2><div class="pubdate">30 Jan at 08:42:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/327">https://github.com/qt4cg/qtspecs/issues/327</a></div><details><summary>Tokenisation</summary><div class="markup"><p>The rule in A.2</p>
<blockquote>
<p>When tokenizing, the longest possible match that is consistent with the EBNF is used.</p>
</blockquote>
<p>needs clarifying. It could be read as suggesting that if taking the longest match turns out to lead to a syntax error, the tokenisation should be re-attempted using a shorter match. I don't think that has ever been intended. So what exactly does the qualifier "that is consistent with the EBNF" actually mean?</p>
<p>Possibly related, A.2.2 Terminal Delimitation states:</p>
<blockquote>
<p>Terminal symbols that are not used exclusively in [/* ws: explicit */] productions are of two kinds: delimiting and non-delimiting.</p>
</blockquote>
<p>But (at least in the XQuery version) the list of delimiting tokens includes a number that are indeed used exclusively in ws:explicit productions, for example a number of tokens containing back-ticks, and <code>]]&gt;</code>.</p>
<p>I think we need to be clearer that tokens used in ws:explicit productions are recognised only when parsing the production that uses them. For example given the expression <code>A[B[C]]&gt;3</code>, we should not recognise <code>]]&gt;</code> as a token under the longest-token rule. I think that's probably what the "consistent with the EBNF" rule is intended to convey.</p>
</div></details></div>
<div class="toot" id="created-326"><h2>Pull request #326 created<span class="toot-id"> #created-326</span></h2><div class="pubdate">29 Jan at 22:45:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/326">https://github.com/qt4cg/qtspecs/pull/326</a></div><p>Issue 205: make support for higher-order functions mandatory</p></div>
<div class="toot" id="created-325"><h2>Issue #325 created<span class="toot-id"> #created-325</span></h2><div class="pubdate">29 Jan at 22:03:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/325">https://github.com/qt4cg/qtspecs/issues/325</a></div><details><summary>Operator precedence table needs updating</summary><div class="markup"><p>The <code>otherwise</code> and <code>-&gt;</code> operators (and maybe others) are missing from the non-normative precedence table in Appendix A.4.</p>
</div></details></div>
<div class="toot" id="created-324"><h2>Pull request #324 created<span class="toot-id"> #created-324</span></h2><div class="pubdate">29 Jan at 18:23:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/324">https://github.com/qt4cg/qtspecs/pull/324</a></div><details><summary>Proposed syntax and semantics for string templates</summary><div class="markup"><p>See issue #58.</p>
<p>I would recommend reviewing the XQuery version of the spec first, since it contains additional notes contrasting string templates and the existing string constructors. The section on string constructors has moved, but is unchanged except for the addition of this note.</p>
</div></details></div>
<div class="toot" id="created-323"><h2>Issue #323 created<span class="toot-id"> #created-323</span></h2><div class="pubdate">27 Jan at 21:56:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/323">https://github.com/qt4cg/qtspecs/issues/323</a></div><details><summary>add select attribute to xsl:text</summary><div class="markup"><p>Although xsl:text select="socks" would be the same as xsl:value-of select="socks" in implementation terms, users of XSLT 2 and later, even people who have been using XSLT 2 or 3 for some time, are often surprised to learn that xsl:value-of makes a text node, and that they need to use xsl:sequence to return something else.</p>
<p>So it'd be great to have them use xsl:text instead of xsl:value-of, where text nodes are wanted, because then introducing xsl:sequence is a small step.</p>
<p>Of course, beginners also often use value-of where they should be using apply-templates, e.g. to handle mixed content! But again, using xsl:text reduces that temptation.</p>
<p>We do have value templates now, <a href="xsl:text">xsl:text</a>{ .... }&lt;/xsl:text&gt;, which mitigates the need slightly, but i think only slightly, because the select= analogy is very compelling.</p>
</div></details></div>
<div class="toot" id="created-322"><h2>Issue #322 created<span class="toot-id"> #created-322</span></h2><div class="pubdate">26 Jan at 10:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/322">https://github.com/qt4cg/qtspecs/issues/322</a></div><details><summary>Map construction in XSLT: xsl:record instruction</summary><div class="markup"><p>Constructing maps in XSLT often involves code rather like this:</p>
<pre><code>            &lt;xsl:map&gt;
               &lt;xsl:map-entry key="'author'" select="string(AUTHOR)"/&gt;
               &lt;xsl:map-entry key="'title'" select="string(TITLE)"/&gt;
               &lt;xsl:map-entry key="'price'" select="xs:decimal(PRICE)"/&gt;
               &lt;xsl:map-entry key="'publisher'" select="string(../@name)"/&gt;
           &lt;/xsl:map&gt;
</code></pre>
<p>The alternative using XPath is also rather ugly:</p>
<pre><code>&lt;xsl:sequence select="map{'author': string(AUTHOR),
                                                 'title':string(TITLE), 
                                                 'price': xs:decimal(PRICE), 
                                                 'publisher':string(../@name)}"/&gt;
</code></pre>
<p>(the fact  that it is creating a map doesn't stand out; the <code>xsl:sequence</code> is a distraction because there's no sequence involved; and many users dislike long multi-line XPath expressions because of formatting problems in their editing tools)</p>
<p>I propose a new instruction xsl:record which allows:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"/&gt;
</code></pre>
<p>This is rather like literal result elements in that the attributes are user-defined rather than system-defined. Unlike LREs, the values are general expressions rather than AVTs, because the values are not necessarily strings. The instruction can only be used where the keys (field names) take the form of NCNames.</p>
<p>If variable entries are required, or entries whose keys are not NCNames, they can appear as child instructions:</p>
<pre><code>            &lt;xsl:record author="string(AUTHOR)"
                                title="string(TITLE)" 
                                price="xs:decimal(PRICE)" 
                                publisher="string(../@name)"&gt;
              &lt;xsl:if test="@private"&gt;
                  &lt;xsl:map-entry name="'private entry'" select="true()"/&gt;
              &lt;/xsl:if&gt;
          &lt;/xsl:record&gt;
</code></pre>
<p>Follow the tradition of LREs, duplicates are resolved as "last one wins".</p>
<p>If "standard attributes" such as <code>[xsl:]version</code> are required, they must be in the XSLT namespace, as with LREs.</p>
</div></details></div>
<div class="toot" id="created-321"><h2>Issue #321 created<span class="toot-id"> #created-321</span></h2><div class="pubdate">26 Jan at 04:12:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/321">https://github.com/qt4cg/qtspecs/issues/321</a></div><details><summary>relax $input in fn:serialize</summary><div class="markup"><p>Relevant specifications:
https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-serialize</p>
<p>Would it be possible to relax the strictures on <code>$input</code> (first parameter) of <code>fn:serialize()</code>?</p>
<ol>
<li>The specifications do not explicitly forbid <code>map(*)</code> or <code>array(*)</code> as input, but in practice, when these are supplied, Saxon rejects them. Developers (or at least this one) who work with arrays and maps often need to render them in string output or messages, if only for diagnostics. If there is something really prohibitively wrong with those two items as input to <code>fn:serialize()</code>, then the specifications should say so.</li>
<li>Attributes are forbidden, but it is unclear why. They get serialized fine in the context of a parent, why not alone?</li>
<li>Namespace nodes are forbidden; see previous point.</li>
</ol>
<p>(No doubt there must have been discussion on points 2-3, but the rationale is not clear from the specs.)</p>
<p>Perhaps the question is that the details of what the serialization should look like is contestable. I think the answer there is simply, pick one. I think we'll happily live with whatever is chosen.</p>
<p>For the serialization of maps and arrays, I'll point as one possible model my <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/maps/TAN-fn-maps-extended.xsl#L58">tan:map-to-xml()</a> and <a href="https://github.com/textalign/TAN-2021/blob/9d2215e36da1f64bddad9daddfc5aa2242e17c81/functions/arrays/TAN-fn-arrays-extended.xsl#L66">tan:array-to-xml()</a>, which have been indispensable for daily troubleshooting.</p>
</div></details></div>
<div class="toot" id="created-320"><h2>Pull request #320 created<span class="toot-id"> #created-320</span></h2><div class="pubdate">25 Jan at 18:58:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/320">https://github.com/qt4cg/qtspecs/pull/320</a></div><details><summary>Issue 98 - add options parameter to fn:deep-equal</summary><div class="markup"><p>This proposal adds an options parameter to fn:deep-equal, giving much more detailed control over how the comparison is performed (while remaining backwards compatible by default).</p>
<p>This proposal is a first draft and I would request careful review, it's not one to pass through "on the nod".</p>
</div></details></div>
<div class="toot" id="created-319"><h2>Pull request #319 created<span class="toot-id"> #created-319</span></h2><div class="pubdate">25 Jan at 16:20:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/319">https://github.com/qt4cg/qtspecs/pull/319</a></div><details><summary>Issue 221: op:same-key becomes fn:atomic-equal</summary><div class="markup"><p>The proposal renames op:same-key as fn:atomic-equal, thus making it directly available to applications.</p>
</div></details></div>
<div class="toot" id="created-318"><h2>Issue #318 created<span class="toot-id"> #created-318</span></h2><div class="pubdate">25 Jan at 11:36:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/318">https://github.com/qt4cg/qtspecs/issues/318</a></div><details><summary>Serialization HTML/XHTML output methods: meta elements and the charset attribute</summary><div class="markup"><p>HTML5 introduces the ability to write</p>
<p><code>&lt;meta charset="utf-8"/&gt;</code></p>
<p>in place of</p>
<p><code>&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;</code></p>
<p>The serialization spec (for HTML and XHTML output methods) ignores this.</p>
<p>(a) it requires the serializer to add a <code>meta</code> element in the second form rather than the first.</p>
<p>(b) when removing existing <code>meta</code> elements, it requires the second form to be deleted, but not the first. This may result in invalid (X)HTML in which both elements are present.</p>
</div></details></div>
<div class="toot" id="closed-309"><h2>Issue #309 closed<span class="toot-id"> #closed-309</span></h2><div class="pubdate">24 Jan at 17:20:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><p>Drop ternary conditionals, as agreed on 2023-01-17</p></div>
<div class="toot" id="closed-310"><h2>Issue #310 closed<span class="toot-id"> #closed-310</span></h2><div class="pubdate">24 Jan at 17:20:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><p>Fix outstanding issues from PR 304</p></div>
<div class="toot" id="closed-312"><h2>Issue #312 closed<span class="toot-id"> #closed-312</span></h2><div class="pubdate">24 Jan at 17:20:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><p>Minor editorial improvements</p></div>
<div class="toot" id="closed-313"><h2>Issue #313 closed<span class="toot-id"> #closed-313</span></h2><div class="pubdate">24 Jan at 17:19:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><p>Issue 294: fn:remove()</p></div>
<div class="toot" id="created-317"><h2>Issue #317 created<span class="toot-id"> #created-317</span></h2><div class="pubdate">24 Jan at 17:16:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/317">https://github.com/qt4cg/qtspecs/issues/317</a></div><details><summary>fn:format-integer: $lang → $language ?</summary><div class="markup"><p>A minor inconsistency in the XQFO specification: The third parameter of <code>fn:format-integer</code> is named <code>$lang</code>…</p>
<p>https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-format-integer</p>
<p>…whereas all other language parameters are named <code>$language</code>.</p>
</div></details></div>
<div class="toot" id="minutes-01-24"><h2>QT4 CG meeting 019 draft minutes<span class="toot-id"> #minutes-01-24</span></h2><div class="pubdate">24 Jan at 17:11:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-24">https://qt4cg.org/meeting/minutes/2023/01-24</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-316"><h2>Issue #316 created<span class="toot-id"> #created-316</span></h2><div class="pubdate">23 Jan at 16:23:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/316">https://github.com/qt4cg/qtspecs/issues/316</a></div><details><summary>Function fn:differences</summary><div class="markup"><p>I didn't see any issues thread devoted <code>fn:differences()</code>, so am opening this one. Please respond with xrefs to anything relevant.</p>
<p>Draft here:
https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-differences</p>
<p>IMO, this function seems overly complicated for both users and implementors. The specs provide difficult reading. But it is the first function to try to address the desideratum for differencing. Something like it is needed methinks.</p>
<p>My suggestion would be to simplify the function as a straightforward string comparison, i.e., change the signature to something like <code>fn:differences($input1 as xs:string, $input2 as xs:string) as OUTPUT</code> where <code>OUTPUT</code> is either a tree structure (like the output of <code>fn:analyze-string()</code>) or a sequence of records (e.g., <code>(is-in-1 as xs:boolean, is-in-2 as xs:boolean, fragment as xs:string)</code>).</p>
<p>Such a change would make the function more tractable for both users and implementers. The user, would need to cast each sequence to a string, and in so doing will be able to (be compelled to) make fine-grained decisions on things such as normalization. Processor implementers have far simpler input, and they can choose the difference algorithm that makes best sense at the moment.</p>
<p>One counterargument might be that the resultant output would be difficult to correlate to the original sequences. Ostensibly, one wants to do things such as decide whether to drop certain items in sequence 1 or sequence 2. My response is that the current draft results in output that suffers from the same problem. Navigating the map to correlate it to the original sequence sounds daunting. With my suggestion, there are ways around this, through auxiliary functions or arity expansions that normalize the output.</p>
<p>But I don't want to get postprocessing output here, which would be tangential to the main question, i.e., how <code>fn:differences()</code> should be constructed in a way conducive to both users and implementers.</p>
</div></details></div>
<div class="toot" id="closed-311"><h2>Issue #311 closed<span class="toot-id"> #closed-311</span></h2><div class="pubdate">23 Jan at 11:46:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-315"><h2>Issue #315 created<span class="toot-id"> #created-315</span></h2><div class="pubdate">18 Jan at 14:58:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/315">https://github.com/qt4cg/qtspecs/issues/315</a></div><details><summary>fn:transform inconsistency: initial-mode</summary><div class="markup"><p>The <code>fn:transform</code> specification in F+O says that if no initial-mode is supplied, the unnamed mode is used.</p>
<p>The XSLT 3.0 specification says that if no initial mode is supplied, then the default mode is used if one has been specified, or the unnamed mode is used if not.</p>
<p>I think the XSLT 3.0 spec should win here: it makes more sense if a default has been declared that it should actually be used.</p>
<p>(Thanks to Amanda Galtman for pointing this out.)</p>
</div></details></div>
<div class="toot" id="created-314"><h2>Issue #314 created<span class="toot-id"> #created-314</span></h2><div class="pubdate">18 Jan at 09:24:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/314">https://github.com/qt4cg/qtspecs/issues/314</a></div><details><summary>Basic Operations on Maps and Arrays</summary><div class="markup"><h1>Manipulating Arrays and Maps</h1>
<p>This is an outline of proposed new facilities designed to make processing of maps and arrays easier. The basic facilities needed for transformation of maps and arrays are the ability to decompose them into their parts, manipulate the parts, and the compose new arrays and maps from these parts.</p>
<p>Further background is in my 2022 Balisage paper, https://balisage.net/Proceedings/vol27/html/Kay01/BalisageVol27-Kay01.html</p>
<p>This proposal considers only the "shallow" operations on maps and arrays. Further proposals for deep search and update of nested structures are to be expected.</p>
<h2>Basics</h2>
<p>A map entry is an item used to represent a key-value pair in a map; it is an item of type <code>record(key as xs:anyAtomicType, value as item()*)</code>, aliased in this proposal as <code>type(map-entry)</code>.</p>
<p>Note: <em>an alternative representation for key-value pairs is as a singleton map, and that's the representation used by the existing map:entry() function and by the xsl:map-entry instruction. A representation as <code>record(key, value)</code> is rather more convenient to enable extraction of the key and value, but does create some compatibility issues...</em></p>
<p>An array entry is an item used to represent a member of an array; it is an item of type <code>record(value as item()*)</code>, aliased in this proposal as <code>type(array-entry)</code>.</p>
<h2>Decomposing Maps and Arrays</h2>
<p>The function <code>map:entries($map)</code> returns a sequence of map entries, in unpredictable order, representing the contents of the supplied map. It is equivalent to <code>map:for-each($map, -&gt;($k, $v){map:entry($k, $v)})</code>.</p>
<p>The function <code>array:entries($array)</code> returns a sequence of array entries, in array order, representing the members of the supplied array. It is equivalent to <code>array:for-each($array, -&gt;($v){array:entry($v)})</code>.</p>
<h2>Constructing Maps and Arrays</h2>
<p>The function <code>map:of($entries as type(map-entry)*) as map(*)</code> constructs a map from a sequence of map entries. A second parameter, <code>$options</code>, is available to control handling of duplicates, as with <code>map:merge()</code>. The function is equivalent to <code>map:merge($entries!map{'key':?key, 'value':?value})</code>.</p>
<p>The function <code>array:of($entries as type(array-entry)*) as array(*)</code> constructs an array from a sequence of array entries. It is equivalent to <code>array:fold-left($entries, [], array:append#2)</code>.</p>
<p>The function <code>map:entry($key, $value) as type(map-entry)</code> is equivalent to <code>map{'key':$key, 'value':$value}</code>. <em>Problem: we already have a function map:entry() in 3.1 that does something different. Need to change the terminology...</em></p>
<p>The function <code>array:entry($value) as type(array-entry)</code> is equivalent to <code>map{'value':$value}</code>.</p>
<h2>Filtering Maps and Arrays</h2>
<p>The construct <code>$map?[PREDICATE]</code> is equivalent to <code>map:of(map:entries($map)[PREDICATE])</code>. For example, given a map in which the keys are dates, <code>$map?[year-from-date(?key)=2023]</code> returns a map containing those entries in which the key is a date in 2023.</p>
<p>The construct <code>$array?[PREDICATE]</code> is equivalent to <code>array:of(array:entries($array)[PREDICATE])</code>. For example, <code>$array?[1]</code> selects the first item in the array (as a single-member array), while <code>$array?[exists(?value)]</code> returns an array containing all those entries in the input array that are not empty. If <code>$array</code> is an array of maps, then <code>$array?[?value?name='John']</code> selects those members of the array that are maps having <code>?name='John'</code>.</p>
<h2>Mapping Maps and Arrays</h2>
<p>The construct <code>$map!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$map</code> and returns the result as a flattened sequence. For example <code>map:of($map!!map:entry(?key, ?value+1))</code> returns a map in which each value has been incremented by one.</p>
<p>The construct <code>$array!!EXPR</code> evaluates <code>EXPR</code> once for each entry in <code>$array</code>, and returns the result as a flattened sequence. For example, <code>array:of($array!!array:entry(?value+1))</code> returns an array in which every value has been incremented by one.</p>
<h2>FLWOR Expressions</h2>
<p>The for-member clause <code>for member $m in $array</code> is equivalent to <code>for $sys:var in array:entries($array) let $m := $sys:var?value</code>.</p>
<p>The for-entry clause <code>for entry ($k, $v) in $map</code> is equivalent to <code>for $sys:var in map:entries($map) let $k := $sys:var?key, $v := $sys:var?value</code>.</p>
<h2>XSLT</h2>
<p>Iteration over maps and arrays is achieved using <code>&lt;xsl:for-each select="array:entries()"&gt;</code> and <code>&lt;xsl:for-each select="map:entries()"&gt;</code> directly.</p>
<p>Construction of maps uses the existing instructions <code>&lt;xsl:map&gt;</code> and <code>&lt;xsl:map-entry&gt;</code>. There is an inconvenience here in that the <code>&lt;xsl:map-entry&gt;</code> instruction returns a singleton map (<code>map{key:value}</code>) rather than a map entry as defined in this proposal (<code>map{'key':key, 'value':value}</code>)..</p>
<p>Construction of arrays uses the new instructions <code>&lt;xsl:array&gt;</code> and <code>&lt;xsl:array-entry&gt;</code>. The <code>xsl:array-entry</code> instruction is defined to construct an array entry as defined in this proposal.</p>
<h2>Use Cases</h2>
<p>To be supplied.</p>
</div></details></div>
<div class="toot" id="created-313"><h2>Pull request #313 created<span class="toot-id"> #created-313</span></h2><div class="pubdate">17 Jan at 22:53:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/313">https://github.com/qt4cg/qtspecs/pull/313</a></div><details><summary>Issue 294: fn:remove()</summary><div class="markup"><p>Allow remove() to remove several items, aligning it with array:remove() and map:remove()</p>
</div></details></div>
<div class="toot" id="created-312"><h2>Pull request #312 created<span class="toot-id"> #created-312</span></h2><div class="pubdate">17 Jan at 22:25:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/312">https://github.com/qt4cg/qtspecs/pull/312</a></div><details><summary>Minor editorial improvements</summary><div class="markup"><ul>
<li>Issue 300 (clarification about results being normalized)</li>
<li>Action QT4CG-018-02 (explaining signature notation)</li>
<li>Action QT4CG-018-04 (explaining numeric predicates on ancestor unions)</li>
</ul>
</div></details></div>
<div class="toot" id="created-311"><h2>Pull request #311 created<span class="toot-id"> #created-311</span></h2><div class="pubdate">17 Jan at 21:39:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/311">https://github.com/qt4cg/qtspecs/pull/311</a></div><p>Stylesheet fix to mark optional fields in record definitions</p></div>
<div class="toot" id="created-310"><h2>Pull request #310 created<span class="toot-id"> #created-310</span></h2><div class="pubdate">17 Jan at 21:27:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/310">https://github.com/qt4cg/qtspecs/pull/310</a></div><details><summary>Fix outstanding issues from PR 304</summary><div class="markup"><p>See https://github.com/qt4cg/qtsp…ecs/pull/304#issuecomment-1378532583 - but excluding item 3 because that's a stylesheet change.</p>
</div></details></div>
<div class="toot" id="created-309"><h2>Pull request #309 created<span class="toot-id"> #created-309</span></h2><div class="pubdate">17 Jan at 19:20:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/309">https://github.com/qt4cg/qtspecs/pull/309</a></div><details><summary>Drop ternary conditionals, as agreed on 2023-01-17</summary><div class="markup"><p>We agreed today to drop ternary conditional expressions from the proposal; this PR implements that change.</p>
</div></details></div>
<div class="toot" id="minutes-01-17"><h2>QT4 CG meeting 018 draft minutes<span class="toot-id"> #minutes-01-17</span></h2><div class="pubdate">17 Jan at 16:15:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-17">https://qt4cg.org/meeting/minutes/2023/01-17</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-286"><h2>Issue #286 closed<span class="toot-id"> #closed-286</span></h2><div class="pubdate">17 Jan at 17:14:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/286">https://github.com/qt4cg/qtspecs/pull/286</a></div><p>Spec changes to allow child::(a|b|c) - Issue 107</p></div>
<div class="toot" id="closed-290"><h2>Issue #290 closed<span class="toot-id"> #closed-290</span></h2><div class="pubdate">17 Jan at 17:14:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/290">https://github.com/qt4cg/qtspecs/pull/290</a></div><p>Fix issue #18 (function type hierarchy)</p></div>
<div class="toot" id="closed-288"><h2>Issue #288 closed<span class="toot-id"> #closed-288</span></h2><div class="pubdate">17 Jan at 17:13:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/288">https://github.com/qt4cg/qtspecs/issues/288</a></div><p>Error in fn:path specification</p></div>
<div class="toot" id="closed-291"><h2>Issue #291 closed<span class="toot-id"> #closed-291</span></h2><div class="pubdate">17 Jan at 17:13:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/291">https://github.com/qt4cg/qtspecs/issues/291</a></div><p>DTD validity of F&amp;O spec</p></div>
<div class="toot" id="closed-304"><h2>Issue #304 closed<span class="toot-id"> #closed-304</span></h2><div class="pubdate">17 Jan at 17:13:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><p>Mike's content changes from PR 292</p></div>
<div class="toot" id="closed-284"><h2>Issue #284 closed<span class="toot-id"> #closed-284</span></h2><div class="pubdate">17 Jan at 17:12:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><p>Add grammar for "if (test) then {expr}" with no else</p></div>
<div class="toot" id="created-308"><h2>Pull request #308 created<span class="toot-id"> #created-308</span></h2><div class="pubdate">15 Jan at 17:05:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/308">https://github.com/qt4cg/qtspecs/pull/308</a></div><details><summary>Improve the legends in the diagrams</summary><div class="markup"><p>This PR completes my action QT4CG-015-03: NW to make sure the direction of the arrow is in the legends</p>
<p>I also made sure the legends aren't too wide. I still have more work to do for the other actions.</p>
</div></details></div>
<div class="toot" id="agenda-01-17"><h2>QT4 CG meeting 018 draft agenda<span class="toot-id"> #agenda-01-17</span></h2><div class="pubdate">15 Jan at 15:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-17">https://qt4cg.org/meeting/agenda/2023/01-17</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-306"><h2>Issue #306 closed<span class="toot-id"> #closed-306</span></h2><div class="pubdate">15 Jan at 16:17:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><p>fn:char - editors actions from 2023-01-10</p></div>
<div class="toot" id="created-307"><h2>Issue #307 created<span class="toot-id"> #created-307</span></h2><div class="pubdate">15 Jan at 15:42:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/307">https://github.com/qt4cg/qtspecs/issues/307</a></div><details><summary>Parsing and building URIs comments and queries</summary><div class="markup"><ol>
<li>fn:build-uri states:</li>
</ol>
<blockquote>
<p>If the scheme key is present in the map, the URI begins with the value of that key concatenated with //, otherwise it begins //.</p>
</blockquote>
<p>a. Shouldn't the concatenation be <code>://</code> so e.g. <code>http</code> becomes <code>http://</code>?
b. How are non-heirarchical schemes handled like <code>urn</code>, and <code>mailto</code>?</p>
<ol start="2">
<li>RFC 3986 allows IPv6 and IPvFuture addresses that contain <code>:</code> characters, e.g. <code>http://[::1]:80</code>.</li>
</ol>
<p>My understanding of fn:parse-uri is that this will fail to parse.</p>
<ol start="3">
<li>RFC 3986 states that for userinfo, the <code>user:password</code> form is deprecated.</li>
</ol>
<p>Browsers will reject this due to the security risk, and the RFC suggests that applications should not render the password (the part after the <code>:</code>) in clear text. -- Should fn:build-uri follow suite, or (along with fn:parse-uri) have an option to control the behaviour (keep, remove, invalid), where if the option is invalid, it will throw an fn:error?</p>
<ol start="4">
<li>RFC 3986 suggests that the port should be omitted if it matches the default for the scheme</li>
</ol>
<p>Should fn:build-uri have this behaviour?</p>
</div></details></div>
<div class="toot" id="created-306"><h2>Pull request #306 created<span class="toot-id"> #created-306</span></h2><div class="pubdate">10 Jan at 21:23:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/306">https://github.com/qt4cg/qtspecs/pull/306</a></div><details><summary>fn:char - editors actions from 2023-01-10</summary><div class="markup"><p>Changes to the new fn:char function (issue #121) as follows:</p>
<ul>
<li>Action QT4CG-017-01 clarifies the definition of formats #nnn and #xnnn.</li>
<li>Action QT4CG-017-02 changes the order of the rules</li>
<li>In discussion it was asked whether any HTML5 entity names refer to strings comprising more than one character. On investigation it appears that they do, and the spec has been revised to allow for this.</li>
<li>added history/status information</li>
</ul>
</div></details></div>
<div class="toot" id="minutes-01-10"><h2>QT4 CG meeting 017 draft minutes<span class="toot-id"> #minutes-01-10</span></h2><div class="pubdate">10 Jan at 16:20:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2023/01-10">https://qt4cg.org/meeting/minutes/2023/01-10</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-305"><h2>Issue #305 created<span class="toot-id"> #created-305</span></h2><div class="pubdate">09 Jan at 17:50:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/305">https://github.com/qt4cg/qtspecs/issues/305</a></div><details><summary>parse-xml() and whitespace stripping</summary><div class="markup"><p>There seems to be nothing in either the XSLT spec or in F+O that says explicitly whether stylesheet-defined space stripping rules (xsl:strip-space and xsl:preserve-space) apply to documents loaded using <code>fn:parse-xml</code> (or, by extension, <code>parse-html</code>).</p>
<p>The spec says that these rules apply to "source trees" defined as "any tree provided as input to the transformation. This includes the document containing the [global context item] if any, documents containing nodes present in the [initial match selection], documents containing nodes supplied as the values of [stylesheet parameters], documents obtained from the results of functions such as [document], [doc], and [collection]...".</p>
<p>I guess one reasonable interpretation is that the "such as" includes <code>parse-xml()</code>. But it goes rather against the grain that the behaviour of parse-xml() should be affected by the containing stylesheet declarations, when there is no mention of such a context-dependency in the function specification; in this, parse-xml() is rather different from doc() which deliberately says very little about how the XDM instance returned relates to the URI supplied as input.</p>
</div></details></div>
<div class="toot" id="closed-292"><h2>Issue #292 closed<span class="toot-id"> #closed-292</span></h2><div class="pubdate">09 Jan at 09:43:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><p>Merge signatures with optional params</p></div>
<div class="toot" id="created-304"><h2>Pull request #304 created<span class="toot-id"> #created-304</span></h2><div class="pubdate">09 Jan at 09:32:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/304">https://github.com/qt4cg/qtspecs/pull/304</a></div><details><summary>Mike's content changes from PR 292</summary><div class="markup"><p>I teased apart some of the omnibus PR #292. I've commited the schema and stylesheet changes. This PR covers the remaining prose changes.</p>
<p>Mike writes:</p>
<blockquote>
<p>I regret that this has turned into a bit of an omnibus PR. The main changes are:</p>
<ul>
<li>Fix validity issues with the function catalog and its schema (Issue 291)</li>
<li>Convert all functions to use a single signature with optional parameters (Issue 70)</li>
<li>Extend the function catalog to handle record definitions (Issue 257)</li>
<li>Fix the (trivial) bug with properties of fn:path (Issue 288)</li>
<li>Add introductory text concerning the handling of operators (Issue 35)</li>
</ul>
</blockquote>
<p>Fix #291
Fix #70
Fix #257
Fix #288
Fix #35</p>
</div></details></div>
<div class="toot" id="closed-303"><h2>Issue #303 closed<span class="toot-id"> #closed-303</span></h2><div class="pubdate">09 Jan at 07:38:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><p>Mike's proposed schema and stylesheet changes</p></div>
<div class="toot" id="created-303"><h2>Pull request #303 created<span class="toot-id"> #created-303</span></h2><div class="pubdate">09 Jan at 07:32:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/303">https://github.com/qt4cg/qtspecs/pull/303</a></div><details><summary>Mike's proposed schema and stylesheet changes</summary><div class="markup"><p>These are the schema and stylesheet changes from PR #292. They don't break the build and on casual inspection they seem fine, so I'm just going to accept them.</p>
</div></details></div>
<div class="toot" id="agenda-01-10"><h2>QT4 CG meeting 017 draft agenda<span class="toot-id"> #agenda-01-10</span></h2><div class="pubdate">06 Jan at 16:02:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2023/01-10">https://qt4cg.org/meeting/agenda/2023/01-10</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-300"><h2>Issue #300 created<span class="toot-id"> #created-300</span></h2><div class="pubdate">06 Jan at 16:19:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/300">https://github.com/qt4cg/qtspecs/issues/300</a></div><details><summary>[F+O] Ambiguity regarding Unicode normalization (editorial)</summary><div class="markup"><p>In §1.7.1 the paragraph</p>
<blockquote>
<p>Unless explicitly stated, the xs:string values returned by the
functions in this document are not normalized in the sense of
[Character Model for the World Wide Web 1.0: Fundamentals].</p>
</blockquote>
<p>is a little bit ambiguous for my taste. By "are not normalized" it means "no action is taken to normalize the strings", it doesn't mean "the strings will not be in normalized form".</p>
<p>I suggest: "Unless explicitly stated, the functions in this document operate on strings as sequences of codepoints and do not attempt to convert input strings, or produce output strings, in Unicode normalized form. Unicode normalization occurs only when explicitly requested, for example by use of the <code>fn:normalize-unicode</code> function."</p>
<p>At the same time we might update the reference to point to "Character Model for the World Wide Web: String Matching", revised in 2021, though it is still only a Working Group Note. See https://www.w3.org/TR/charmod-norm/#unicodeNormalization</p>
</div></details></div>
<div class="toot" id="closed-281"><h2>Issue #281 closed<span class="toot-id"> #closed-281</span></h2><div class="pubdate">02 Jan at 18:12:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><p>XPath: Short-circuiting Functions and Lazy Evaluation Hints</p></div>
<div class="toot" id="created-299"><h2>Issue #299 created<span class="toot-id"> #created-299</span></h2><div class="pubdate">02 Jan at 18:08:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/299">https://github.com/qt4cg/qtspecs/issues/299</a></div><details><summary>Short-circuiting functions, function-arity guards and lazy hints</summary><div class="markup"><h1><strong>I. Shortcutting and lazy hints</strong></h1>
<p>Let us have this expression:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }
  return
    $f($x) ($y)
</code></pre>
<p>Evaluating&nbsp;<strong><code>$f($x)</code></strong>&nbsp;produces a function. The&nbsp;<strong>actual arity</strong>&nbsp;of this resulting function can be any number&nbsp;<strong><code>N &gt;= 0</code></strong> :</p>
<ul>
<li>
<p>If&nbsp;<strong><code>N &gt; 1</code></strong>&nbsp;there would be arity mismatch error, as only one argument&nbsp;<code>$y</code>&nbsp;is provided in the expression.</p>
</li>
<li>
<p>If&nbsp;<strong><code>N = 1</code></strong>&nbsp;the final function call can be evaluated, and the argument&nbsp;<code>$y</code>   must be evaluated,  or</p>
</li>
<li>
<p><strong>If <code>N = 0</code>, then  <code>$y</code> is unneeded and can safely be ignored</strong> according to the updated <strong>“<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>”</strong> in Xpath 4.0.</p>
</li>
</ul>
<p><strong>Because a possibility exists to be able to ignore the evaluation of&nbsp;<code>$y</code>, it is logical to delay the evaluation of&nbsp;<code>$y</code>&nbsp;until the actual arity of&nbsp;<code>$f($x)</code>&nbsp;is known</strong>.</p>
<p>The current XPath 4.0 evaluation rules do not require an implementation to base its decision whether or not to evaluate&nbsp;<code>$y</code> on the actual arity of the function produced by <code>$f($x)</code>, thus at present an implementation could decide to evaluate <code>$y</code> regardless of the actual arity of the function produced by <code>$f($x)</code>.</p>
<p><strong>This is where a&nbsp;<em>lazy</em>&nbsp;hint comes</strong>: it indicates to the XPath processor that <em><strong>it is logical to make the decision about evaluation of&nbsp;<code>$y</code>&nbsp;based on the actual arity of the function returned by&nbsp;<code>$f($x)</code></strong></em>.</p>
<p>A rewrite of the above expression using a <strong><em><em>lazy</em></em></strong>&nbsp;hint looks like this:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*) as function(item()*) as item()*
             {  (: Some code here :) }  
  return
    $f($x) (lazy $y)
</code></pre>
<p>Here is one example of a function with short-cutting and calling it with a <strong><em>lazy</em></strong> hint:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
             {
                let $partial := function($x as xs:boolean) as function(xs:boolean) as  xs:boolean
                                {
                                  if(not($x)) then -&gt;(){false()}
                                              else -&gt;($t) {$t}
                                }
                 return $partial($x)($y)
             }
  return
     $fAnd($x (: possibly false() :), lazy&nbsp;$SomeVeryComplexAndSlowComputedExpression)
</code></pre>
<p><strong>Without the <strong><em>lazy</em></strong>&nbsp;hint in the above example, it is perfectly possible that an XPath implementation, unrestricted by the current rules, would evaluate <em><code>$SomeVeryComplexAndSlowComputedExpression</code></em> - something that is unneeded and could be avoided completely</strong>.</p>
<h2>Formal syntax and semantics</h2>
<ol>
<li>
<p>The <strong><em>lazy</em></strong> keyword should immediately precede any argument in a function call. If specified, it means that <strong><em>it is logical to make the decision about evaluation of this argument based on the actual arity of the function in this function call</em></strong>.</p>
<p>Based on this definition, it follows that <strong><em><code>lazy $argK</code></em></strong> implies <strong><em>lazy</em></strong> for all arguments following <code>$argK</code> in the function call. Thus specifying more than one <strong><em>lazy</em></strong> hint within a given function call is redundant and an implementation may report this redundancy to the user.</p>
<p>The scope of a <strong><em>lazy</em></strong> keyword specified on an argument is this and all following arguments of (only) the current function call.</p>
</li>
<li>
<p>It is possible to specify a <strong><em>lazy</em></strong> keyword that is in force for the respective argument(s) of all function calls of the given function. To do this, the <strong><em>lazy</em></strong> keyword must  be  specified immediately preceding a parameter name in the function definition of that function.</p>
<p>For example, if the function <strong><code>$f</code></strong> is specified as:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, lazy $arg2 as item()*, $arg3 as item()*, $arg4 as item()* ) 
          { (: some code here:) }
  return
     $someExpression
</code></pre>
<p>Then any call of <strong><code>$f</code></strong> in its definition scope that has the form:</p>
<pre><code class="language-xq">$f($x, $y, $z, $t)
</code></pre>
<p>is equivalent to:</p>
<pre><code class="language-xq">$f($x, lazy $y, $z, $t)
</code></pre>
</li>
<li>
<p>It is possible to specify the <strong><em>lazy</em></strong> keyword immediately preceding a function definition. This instructs the XPath processor that any call of this function is only necessary to be evaluated if the function is actually called during the evaluation of the expression that contains this function call.</p>
<p>For example:</p>
<pre><code class="language-xq">let $complexComputation := lazy function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return if($someCondition()) 
           then $complexComputation(2, 3)
           else 0
</code></pre>
<p>Specifying the <strong><em>lazy</em></strong> keyword in the function definition for <code>$complexComputation</code> can save significant computing resources, because the programmer knows that <code>$someCondition()</code> is true during only a single day in any 4-years period.</p>
</li>
</ol>
<h1><strong>II.fn:lazy</strong></h1>
<h2>Summary</h2>
<p>Applied on a single argument that can be any <em>expression</em>. Lazily returns its argument <em>expression</em>.</p>
<h2>Signature</h2>
<pre><code class="language-xq">lazy fn:lazy( 
        $expression as item()*
) as item()*
</code></pre>
<h2>Properties</h2>
<p>This function is <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-deterministic">deterministic</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-context-independent">context-independent</a></em></strong>, <strong><em><a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#dt-focus-independent">focus-independent</a></em></strong></p>
<h2>Rules</h2>
<p>The semantics of the function is strictly defined below:</p>
<pre><code class="language-xq">let $lazyFunction := lazy fn:identity#1
   return
      (: AnyExpression here :)
</code></pre>
<p>Any expression <strong><code>Q</code></strong> of the form:</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>where <strong><code>E1</code></strong> and <strong><code>E2</code></strong> are subexpressions of <strong><code>Q</code></strong>, must be evaluated by the Processor in two steps:</p>
<ol>
<li>
<p>Substitute the expression</p>
<p><strong><em><code>Q(E1, lazy(E2))</code></em></strong></p>
<p>with:</p>
<p><strong><em><code>Q(E1, ?) (lazy E2)</code></em></strong></p>
</li>
<li>
<p>Evaluate the latter according to the rules for a <strong><em>lazy</em></strong> argument</p>
</li>
</ol>
<h2>Example</h2>
<p>We can use almost the same example as above, but here <code>$complexComputation</code> is defined without the <strong><em>lazy</em></strong> keyword and thus is not a <strong><em>lazy</em></strong> function. To have <code>$complexComputation</code> evaluated lazily, we call the <code>lazy()</code> function, passing <code>$complexComputation</code>  to it:</p>
<pre><code class="language-xq">let $complexComputation := (: no lazy here :) function($x, $y) {$x + $y}, (: Make it as complex as you want ... :)
     $someCondition := function()
        {
            let $date := current-date()
              return
                  month-from-date($date) eq 2
                and 
                 day-from-date($date) eq 29 
       }
  return 
        $someCondition() and lazy( $complexComputation(2, 3))
</code></pre>
<p>Here the expression <strong><code>Q</code></strong> is:</p>
<p><strong><em><code>$someCondition() and lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>This  is the same as:</p>
<p><strong><em><code>fn:op("and")($someCondition(), lazy( $complexComputation(2, 3))</code></em></strong></p>
<p>According to the Rules above, the processor converts this to:</p>
<p><strong><em><code>fn:op("and")($someCondition(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p><code>$someCondition()</code> is evaluated and if its value is <code>false()</code>,   then the expression to be evaluated is:</p>
<p><strong><em><code>fn:op("and")(false(), ?) (lazy( $complexComputation(2, 3)) )</code></em></strong></p>
<p>As <strong><em><code>fn:op("and")(false(), ?)</code></em></strong> by definition is <strong><em><code>function() {false()}</code></em></strong>. then the final result <strong><code>false()</code></strong> is produced and the unnecessary argument <strong><em><code>$complexComputation(2, 3)</code></em></strong> is not evaluated at all.</p>
<h1><strong>III. A function's arity is a guard for its arguments</strong></h1>
<p>Let us have a  function <strong><code>$f</code></strong> defined as below:</p>
<pre><code class="language-xq">let $f := function($arg1 as item()*, $arg2 as item()*, …, $argN as item()*)
   as function(item()*, item()*, …, item()*) as item()*
     {
       if($cond0($arg1))       then -&gt; () { 123 }
        else if($cond1($arg1)) then -&gt; ($Z1 as item()*) {$Z1}
        else if($cond2($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*) {$Z1 + $Z2}
        (:    .        .        .        .         .        .        .         .  :)
        else if($condK($arg1)) then -&gt; ($Z1 as item()*, $Z2 as item()*, …, $Zk as item()*)
                                       {$Z1 + $Z2 + … + $Zk}
        else ()
     }
  return
     $f($y1, $y2, …, $yN) ($z1, $z2, …, $zk)
</code></pre>
<p>A call to <strong><code>$f</code></strong> returns a function whose arity may be any of the numbers: 0, 1, …, K.</p>
<p>Depending on the arity of the returned function (0, 1, …, K), the last (K, K-1,  K-2, …, 2, 1, 0) arguments of the function call:</p>
<p><strong><em><code>$f($y1, $y2,  .  .  . , $yN) ($z1, $z2, .  .  . , $zk)</code></em></strong></p>
<p><strong>are unneeded and it is logical that they would not need to be evaluated</strong>.</p>
<p><strong>So, the actual arity of the result of calling <strong><code>$f</code></strong> is a guard for the arguments of a call to this function-result</strong>.</p>
<p>Thus, one more bullet needs to be added to [2.4.5 Guarded Expressions] https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-guarded-expressions), specifying an additional guard-type:</p>
<ul>
<li>In an expression of the type <code>E(A1, A2, ..., AN)</code> any of the arguments <code>A</code><sub>K</sub> is guarded by the condition
<code>actual-arity(E) ge K</code>. This rule has the consequence that if the actual arity of <code>E()</code> is less than <code>K</code> then if any argument <code>Am</code> (where <code>m &gt;= K</code>) is evaluated, this must not raise a dynamic error. An implementation may base on the actual arity of <code>E()</code> its decision for the evaluation of the arguments.</li>
</ul>
</div></details></div>
<div class="toot" id="created-298"><h2>Issue #298 created<span class="toot-id"> #created-298</span></h2><div class="pubdate">02 Jan at 15:36:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/298">https://github.com/qt4cg/qtspecs/issues/298</a></div><details><summary>Abstract supertype for map and array</summary><div class="markup"><p>I've been wondering whether there would be any mileage in introducing an abstract super type for map() and array(), perhaps called lookup(). This would basically treat an array as a map with integer keys.</p>
<p>This would allow a cleaner type signature for map:find() and any future functions such as xx:search() that work both on maps and arrays. It might simplify the description of the lookup operator "?". For functions that already exist in both the map and array namespaces, such as get(), we could introduce a unified function in the fn namespace with the cosmetic benefit of reducing the need for namespace prefixes and namespace declarations.</p>
<p>I'm still keen to find a better way of doing iteration, filtering, mapping, and construction of maps and arrays, and I think this might be a useful stepping stone.</p>
</div></details></div></div></article></main></body></html>