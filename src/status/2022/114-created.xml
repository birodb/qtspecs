<item>
   <title>Issue #114 created</title>
   <pubDate>2022-05-04T11:07:20Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/114</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-114</guid>
   <description>&lt;div&gt;&lt;p&gt;[fo] array:index-where&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;There is a need for an &lt;code&gt;array:index-where()&lt;/code&gt; function to operate on arrays in the same way as &lt;code&gt;fn:index-where()&lt;/code&gt; operates on sequences/&lt;/p&gt;
&lt;p&gt;Use case: consider XMark query Q4, which uses the &lt;code&gt;&amp;lt;&amp;lt;&lt;/code&gt; operator:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;(: Q4. List the reserves of those open auctions where a
       certain person issued a bid before another person. :)

for    $b in /site/open_auctions/open_auction
where  $b/bidder/personref[@person="person18829"] &amp;lt;&amp;lt;
            $b/bidder/personref[@person="person10487"]
return &amp;lt;history&amp;gt;{ $b/reserve }&amp;lt;/history&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the bidders held in an array like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;     "bidders": [
        { "increase":18, "time":"13:16:15", "date":"2001-06-13", "personref":"person0" },
        { "increase":12, "time":"11:29:44", "date":"2000-09-18", "personref":"person23" },
        { "increase":18, "time":"10:23:59", "date":"1998-01-07", "personref":"person14" },
        { "increase":4.5, "time":"14:00:39", "date":"2001-07-10", "personref":"person16" }
      ],
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;the best way of expressing this query seems to be:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;for    $b in ?open_auctions?*
let    $bidders := $b?bidders
where  array:index-where($bidders, -&amp;gt;($bidder) {$bidder?personref="person18829"}) &amp;lt;
            array:index-where($bidders, -&amp;gt;($bidder) {$bidder?personref="person10487"})
return &amp;lt;history&amp;gt;{ $b?reserve }&amp;lt;/history&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
