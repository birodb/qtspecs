<item>
   <title>Issue #110 created</title>
   <pubDate>2022-01-23T11:20:13Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/110</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-110</guid>
   <description>&lt;div&gt;&lt;p&gt;JSON templates&lt;/p&gt;&lt;div class="markup"&gt;&lt;h3&gt;JSON templates&lt;/h3&gt;
&lt;p&gt;JSON templates are introduced as a convenient way of constructing maps and arrays, especially for use in a stylesheet designed to deliver serialised JSON output (but not restricted to that use case).&lt;/p&gt;
&lt;p&gt;A new kind of XPath expression called a JSON template is introduced. The following specification is informal.&lt;/p&gt;
&lt;p&gt;The syntax is&lt;/p&gt;
&lt;p&gt;&lt;code&gt;json-template ::= "[#" parameterized-json "#]"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The syntax of &lt;code&gt;parameterised-json&lt;/code&gt; is a modified form of the JSON syntax.&lt;/p&gt;
&lt;p&gt;There are three modifications:&lt;/p&gt;
&lt;p&gt;(a) single quotes can be used instead of double-quotes&lt;/p&gt;
&lt;p&gt;(b) wherever a JSON value is permitted (including a string used as a key), we allow a parenthesised XPath expression&lt;/p&gt;
&lt;p&gt;For example&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{ "sum": ($x + $y),
  "difference": ($x - $y),
  ($extra) : true }

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The rules for what the XPath expression may return are essentially the same as the JSON serialization rules, except that if the value is a node, it is atomised rather than serialized.&lt;/p&gt;
&lt;p&gt;(c) within an array, wherever an array element may appear, we allow the syntax "*(" expression ")") to deliver a sequence of array elements. For example&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[ 1, 2, *(5 to 10)]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;returns the array [1, 2, 3, 5, 6, 7, 8, 9, 10]&lt;/p&gt;
&lt;p&gt;Similarly, within an object, wherever a member may appear, we allow the syntax "*(" expression ")") to deliver a sequence of members. The XPath expression must deliver a map or sequence of maps, whose entries are used as the members of the target object. For example&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{ "A":1, "B":2, *(//book ! map{isbn : price}) } &lt;/code&gt;
Entries with duplicate keys result in an error.&lt;/p&gt;
&lt;p&gt;Note: an XPath expression appearing within a json-template may of course contain nested json-templates.&lt;/p&gt;
&lt;p&gt;JSON templates can be embedded in XPath using the syntax "[#" parameterized-json "#]", and we also allow them to be embedded in XSLT using the instruction:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;xsl:json-template&amp;gt; parameterized-json &amp;lt;/xsl:json-template&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
