<item>
   <title>Issue #115 created</title>
   <pubDate>2022-05-04T18:55:31Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/115</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-115</guid>
   <description>&lt;div&gt;&lt;p&gt;Lookup operator on arrays of maps&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;I've been converting the XMark data files and queries from XML to JSON.&lt;/p&gt;
&lt;p&gt;Here's part of Q20 in its XML form:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; &amp;lt;preferred&amp;gt;
  {count (/site/people/person/profile[@income &amp;gt;= 100000])}
 &amp;lt;/preferred&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which becomes this, when we access the JSON form of the data:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; &amp;lt;preferred&amp;gt;
  {count (?people?*?profile[?income &amp;gt;= 100000])}
 &amp;lt;/preferred&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It can get worse, for example Q16 has&lt;/p&gt;
&lt;p&gt;&lt;code&gt;exists ($a?annotation?description?parlist?*?parlist?*?text?*?emph?*?keyword?*?("ยง")) &lt;/code&gt;&lt;/p&gt;
&lt;p&gt;These paths arise because a structured derived from JSON often includes map entries whose values are arrays.&lt;/p&gt;
&lt;p&gt;It's very hard to get these paths right, and it's hard to produce good diagnostics when you get them wrong.&lt;/p&gt;
&lt;p&gt;I'd like to allow the &lt;code&gt;?*?&lt;/code&gt; "operators" to be replaced with a simple "?". This isn't difficult. Currently the rules for the lookup operator say:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;If the context item is an array:
If the [KeySpecifier] is an NCName, the [UnaryLookup](https://www.w3.org/TR/xpath-31/#doc-xpath31-UnaryLookup) operator raises a type error 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;All that's needed is to change this to say that if the context item is an array, and the KeySpecifier is an NCName, then the array must be an array of maps and the lookup is applied to these maps.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
