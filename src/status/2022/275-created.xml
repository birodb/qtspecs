<item>
   <title>Issue #275 created</title>
   <pubDate>2022-11-26T22:57:37Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/275</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-275</guid>
   <description>&lt;div&gt;&lt;p&gt;Problems with nt/xnt links to grammar terms&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;I'm trying to work out why we're getting linking errors during the build when linking to grammatical terms.&lt;/p&gt;
&lt;p&gt;In etc/XT40.xml (after changing extract.xsl to produce tidier namespace declarations, I'm seeing entries like:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   &amp;lt;nt def="doc-xpath40-SequenceType" xlink:type="simple"&amp;gt;SequenceType&amp;lt;/nt&amp;gt;
   &amp;lt;nt def="doc-xpath40-ItemType" xlink:type="simple"&amp;gt;ItemType&amp;lt;/nt&amp;gt;
   &amp;lt;nt def="doc-xpath40-OccurrenceIndicator" xlink:type="simple"&amp;gt;OccurrenceIndicator&amp;lt;/nt&amp;gt;
   &amp;lt;nt def="prod-xpath40-AnyItemTest" xlink:type="simple"&amp;gt;AnyItemTest&amp;lt;/nt&amp;gt;
   &amp;lt;nt def="doc-xpath40-TypeName" xlink:type="simple"&amp;gt;TypeName&amp;lt;/nt&amp;gt;
   &amp;lt;nt def="doc-xpath40-KindTest" xlink:type="simple"&amp;gt;KindTest&amp;lt;/nt&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and the problem entries seem to be the ones prefixed "prod-" rather than "doc-".&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;extract.xsl&lt;/code&gt; stylesheet simply copies what it finds in &lt;code&gt;xpath-assembled.xml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The decision seems to be made in &lt;code&gt;grammar2spec.xsl&lt;/code&gt;, for example line 523 reads&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;xsl:param name="result_id_docprod_part"/&amp;gt; &amp;lt;!-- 'doc-' or 'prod-' --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The parameter is set to "prod-" in &lt;code&gt;add-non-terminals&lt;/code&gt; (line 473) and in &lt;code&gt;add-terminals&lt;/code&gt; (line 488), and is set to "doc-" in &lt;code&gt;show-prod&lt;/code&gt; (line 513).&lt;/p&gt;
&lt;p&gt;Looking more carefully, all productions listed in XT40.xml have a "prod-" entry (at least one...) and most of them also have a "doc-" entry. The problem cases are those that do not have a "doc-" entry. Which suggests that &lt;code&gt;show-prod&lt;/code&gt; is not selecting them.&lt;/p&gt;
&lt;p&gt;In a small number of cases, when processing the XSLT specification, the show-prod template is outputting the message&lt;/p&gt;
&lt;p&gt;&lt;code&gt;WARNING!! production with name="MapTest" not found&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This is produced for MapTest, ArrayTest, EnumerationType, and NamedItemType. The problem here appears to be that the production is referenced in the XSLT spec but in the grammar file it is not shown with &lt;code&gt;if="xslt40-patterns"&lt;/code&gt;, so it is not present in the pattern grammar.&lt;/p&gt;
&lt;p&gt;For productions like AnyItemTest, the problem is different. It looks to me as if &lt;code&gt;show-prod&lt;/code&gt; is not being called for these terms.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;show-prod&lt;/code&gt; is called from one place only: &lt;code&gt;assemble-spec.xsl&lt;/code&gt; line 208. This is in a template rule with &lt;code&gt;match="prodrecap"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Sure enough, &lt;code&gt;AnyItemTest&lt;/code&gt; does not appear to have a &lt;code&gt;prodrecap&lt;/code&gt; in the XPath spec.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
