<item>
   <title>Issue #211 created</title>
   <pubDate>2022-10-14T10:20:34Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/211</link>
   <guid>https://qt4cg.org/@qt4cg/2022/#created-211</guid>
   <description>&lt;div&gt;&lt;p&gt;XSLT streaming: capturing accumulators&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;A Saxon extension to XSLT streaming that has proved very convenient is the notion of a capturing accumulator, indicated by setting xsl:accumulator/@capture = yes.&lt;/p&gt;
&lt;p&gt;From the Saxon documentation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This attribute may be set on an xsl:accumulator-rule element. It has no effect unless the accumulator is declared streamable and the rule has phase="end". It is intended for use when the accumulator rule matches an element node. The value is a boolean with the default "no".&lt;/p&gt;
&lt;p&gt;The effect of setting this attribute is that the code for computing the new accumulator value when the element end tag is encountered now has access to a snapshot copy of the matched element (as if taken using the fn:snapshot function), and is no longer required to be motionless.&lt;/p&gt;
&lt;p&gt;This means that if you want access to the typed value or string value of an element, you can now get this directly with a rule that matches the element, rather than having to write rules that match the element's text node children.&lt;/p&gt;
&lt;p&gt;It also opens up additional possibilities. For example:&lt;/p&gt;
&lt;p&gt;If a large document has a short header section containing metadata, you can capture a copy of the header in an accumulator, and the header then becomes available throughout the rest of the document processing using the accumulator-after() function.
If you want to produce a sorted index of terms that are marked up using glossary elements scattered throughout the document, you can define an accumulator that retains snapshot copies of all the glossary entries (use select="($value, .)" in the accumulator rule). At the end of processing, you can sort and group these glossary entries, and because they are snapshot copies retaining all the attributes of ancestors, you can link them to the id anchors of the containing sections.
Note: the snapshot captured as a result of the use of saxon:capture differs from the result of the fn:snapshot() function in that accumulator values associated with the copied nodes are not retained in the snapshot.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We could consider making this the default, since its effect is essentially to remove an unnecessary restriction.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
