<item>
   <title>Issue #328 created</title>
   <pubDate>2023-01-30T10:05:00Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/328</link>
   <guid>https://qt4cg.org/@qt4cg/2023/#created-328</guid>
   <description>&lt;div&gt;&lt;p&gt;Switch Cases: Lift single-item restriction on operands&lt;/p&gt;&lt;div class="markup"&gt;&lt;h2&gt;Motivation&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.w3.org/TR/xquery-31/#id-switch"&gt;XQuery switch cases&lt;/a&gt; have a peculiar restriction: The operand of a single case must yield an empty sequence or a single item. There seem to be no (obvious) reasons why this restriction exists, so I believe we should lift it and allow arbitrary sequences.&lt;/p&gt;
&lt;p&gt;A similar extension is planned for Java 12 (&lt;a href="http://openjdk.java.net/jeps/325"&gt;JEP 325: Switch Expressions&lt;/a&gt;). The required changes in XQuery are simpler, though, as the 3.1 grammar already supports arbitrary expressions as operands.&lt;/p&gt;
&lt;h2&gt;Examples&lt;/h2&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;switch($value)
  case 1
  case 2
  case 3
  case 4
  case 5
    return 'small'
  default
    return 'big'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Proposed syntax:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;switch($value)
  case 1 to 5
    return 'small'
  default
    return 'big'
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Required Changes&lt;/h2&gt;
&lt;p&gt;The &lt;a href="https://www.w3.org/TR/xquery-31/#id-switch"&gt;current matching rules&lt;/a&gt; could be rephrased as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The SwitchCaseOperand is evaluated.&lt;/li&gt;
&lt;li&gt;The resulting value is atomized.&lt;/li&gt;
&lt;li&gt;The case matches if the value is empty and if the value of the switch expression is empty as well.&lt;/li&gt;
&lt;li&gt;Otherwise, the atomized value of the switch operand expression is compared with each item of the atomized value of the SwitchCaseOperand using &lt;code&gt;fn:deep-equal&lt;/code&gt;, with the default collation from the static context.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Original Proposal: https://github.com/expath/xpath-ng/pull/12&lt;/li&gt;
&lt;li&gt;Discussion on Slack: https://xmlcom.slack.com/archives/C011NLXE4DU/p1675006336963479&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
