<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QT4 CG Meeting 026 Minutes 2023-03-14</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/meeting/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
<link rel="shortcut icon" href="/img/QT4-64.png" />
<link rel="apple-touch-icon" sizes="64x64" href="/img/QT4-64.png" type="image/png" />
<link rel="apple-touch-icon" sizes="76x76" href="/img/QT4-76.png" type="image/png" />
<link rel="apple-touch-icon" sizes="120x120" href="/img/QT4-120.png" type="image/png" />
<link rel="apple-touch-icon" sizes="152x152" href="/img/QT4-152.png" type="image/png" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">QT4 CG Meeting 026 Minutes 2023-03-14</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#minutes">Minutes</a></li>
<li><a href="#new-actions">Summary of new and continuing actions <code>[0/9]</code></a></li>
<li><a href="#administrivia">1. Administrivia</a>
<ul>
<li><a href="#roll-call">1.1. Roll call <code>[9/12]</code></a></li>
<li><a href="#agenda">1.2. Accept the agenda</a></li>
<li><a href="#approve-minutes">1.3. Approve minutes of the previous meeting</a></li>
<li><a href="#next-meeting">1.4. Next meeting</a></li>
<li><a href="#open-actions">1.5. Review of open action items <code>[7/15]</code></a></li>
</ul>
</li>
<li><a href="#technical-agenda">2. Technical Agenda</a>
<ul>
<li><a href="#h-29A87C61-D673-4C02-AF2C-DC56FD7B0F9F">2.1. Record types</a></li>
<li><a href="#h-29972C1F-44ED-4967-A11B-87E12F9B9123">2.2. PR #368: Issue 129 - Context item generalized to context value</a></li>
</ul>
</li>
<li><a href="#any-other-business">3. Any other business</a></li>
<li><a href="#adjourned">4. Adjourned</a></li>
</ul>
</div>
</div>

<div id="outline-container-minutes" class="outline-2">
<h2 id="minutes">Minutes</h2>
<div class="outline-text-2" id="text-minutes">
<p>
Approved <a href="./03-21.html">at meeting 027</a> on 21 March 2023.
</p>
</div>
</div>

<div id="outline-container-new-actions" class="outline-2">
<h2 id="new-actions">Summary of new and continuing actions <code>[0/9]</code></h2>
<div class="outline-text-2" id="text-new-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-023-01: NW to review the stylesheets for functions across XPath and XSLT</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-024-01: MK to add namespace-uri-for-prefix argument changes to the compatibility appendix</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-024-02: DN to develop an alternative proposal for deep-action.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-02: MK to make the context function properties simple values instead of functions</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-03: MK to revise and expand technical detail in PR #375</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-04: RD to remove the note in 15.5.15 of functions and operators.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-026-01: MK to write a summary paper that outlines the decisions we need to make on “value sequences”</li>
</ul>
</div>
</div>


<div id="outline-container-administrivia" class="outline-2">
<h2 id="administrivia"><span class="section-number-2">1.</span> Administrivia</h2>
<div class="outline-text-2" id="text-administrivia">
</div>

<div id="outline-container-roll-call" class="outline-3">
<h3 id="roll-call"><span class="section-number-3">1.1.</span> Roll call <code>[9/12]</code></h3>
<div class="outline-text-3" id="text-roll-call">
<p>
Regrets: BTW, JK
</p>

<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Anthony (Tony) Bufort (AB)</li>
<li class="on"><code>[X]</code> Reece Dunn (RD)</li>
<li class="on"><code>[X]</code> Sasha Firsov (SF)</li>
<li class="on"><code>[X]</code> Christian Grün (CG)</li>
<li class="off"><code>[&#xa0;]</code> Joel Kalvesmaki (JK)</li>
<li class="on"><code>[X]</code> Michael Kay (MK)</li>
<li class="on"><code>[X]</code> John Lumley (JL)</li>
<li class="on"><code>[X]</code> Dimitre Novatchev (DN)</li>
<li class="on"><code>[X]</code> Ed Porter (EP)</li>
<li class="on"><code>[X]</code> C. M. Sperberg-McQueen (MSM)</li>
<li class="off"><code>[&#xa0;]</code> Bethan Tovey-Walsh (BTW)</li>
<li class="on"><code>[X]</code> Norm Tovey-Walsh (NW). <i>Scribe</i>. <i>Chair</i>.</li>
</ul>
</div>
</div>

<div id="outline-container-agenda" class="outline-3">
<h3 id="agenda"><span class="section-number-3">1.2.</span> Accept the agenda</h3>
<div class="outline-text-3" id="text-agenda">
<p>
Proposal: Accept <a href="../../agenda/2023/03-14.html">the agenda</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-approve-minutes" class="outline-3">
<h3 id="approve-minutes"><span class="section-number-3">1.3.</span> Approve minutes of the previous meeting</h3>
<div class="outline-text-3" id="text-approve-minutes">
<p>
Proposal: Accept <a href="../../minutes/2023/03-07.html">the minutes of the previous meeting</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-next-meeting" class="outline-3">
<h3 id="next-meeting"><span class="section-number-3">1.4.</span> Next meeting</h3>
<div class="outline-text-3" id="text-next-meeting">
<p>
The next meeting <a href="../../agenda/2023/03-21.html">is scheduled for Tuesday, 21 March 2023</a>.
</p>

<p>
ATTENTION: This meeting is scheduled at 16:00 local time in Europe and the UK.
The United States switched to Daylight Saving Time starting on Sunday,
12 March 2023. Until Europe and the UK switch to summer time (on 26
March 2023), this meeting will be one hour <b>later</b> in the United
States.
</p>

<p>
No regrets heard.
</p>
</div>
</div>

<div id="outline-container-open-actions" class="outline-3">
<h3 id="open-actions"><span class="section-number-3">1.5.</span> Review of open action items <code>[7/15]</code></h3>
<div class="outline-text-3" id="text-open-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-016-08: RD to clarify how namespace comparisons are performed.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-023-01: NW to review the stylesheets for functions across XPath and XSLT</li>
<li class="on"><code>[X]</code> QT4CG-023-05: NW to put record types on an agenda.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-024-01: MK to add namespace-uri-for-prefix argument changes to the compatibility appendix</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-024-02: DN to develop an alternative proposal for deep-action.</li>
<li class="on"><code>[X]</code> QT4CG-025-01: NW to close the issues we agreed to close in meeting 024</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-02: MK to make the context function properties simple values instead of functions</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-03: MK to revise and expand technical detail in PR #375</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-025-04: RD to remove the note in 15.5.15 of functions and operators.</li>
<li class="on"><code>[X]</code> QT4CG-025-05: MK to correct the accidental deletion in 3.6.2 of XQuery</li>
<li class="on"><code>[X]</code> QT4CG-025-06: NW to fix the “blue boxes” in the serialization specification</li>
<li class="on"><code>[X]</code> QT4CG-025-07: MK to update the text about for/let changes to use use definitions and termrefs correctly.</li>
<li class="on"><code>[X]</code> QT4CG-025-08: MK to add an error code for the case where <code>member</code> is used on something that isn’t an array</li>
<li class="on"><code>[X]</code> QT4CG-025-09: NW to add the parse-uri and build-uri tests to the test suite</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-technical-agenda" class="outline-2">
<h2 id="technical-agenda"><span class="section-number-2">2.</span> Technical Agenda</h2>
<div class="outline-text-2" id="text-technical-agenda">
<p>
This agenda begins with record types, proposed for the agenda some
weeks ago, followed by a few more substantial PRs then a few small PRs.
</p>
</div>

<div id="outline-container-h-29A87C61-D673-4C02-AF2C-DC56FD7B0F9F" class="outline-3">
<h3 id="h-29A87C61-D673-4C02-AF2C-DC56FD7B0F9F"><span class="section-number-3">2.1.</span> Record types</h3>
<div class="outline-text-3" id="text-h-29A87C61-D673-4C02-AF2C-DC56FD7B0F9F">
<p>
In <a href="https://qt4cg.org/meeting/minutes/2023/02-21.html#h-5ACE0622-A613-4026-9074-C7492E84CC15">meeting 023</a>, we encountered the proposal for a new pattern syntax,
<code>(type(T), record(N, M, N))</code> that allows matching of items by item type.
This needs CG discussion.
</p>

<ul class="org-ul">
<li>MK: We’re doing a lot of things that are building on top of that
syntax but we’ve never agreed to it.
<ul class="org-ul">
<li>… There may be some loose ends that are worth discussing (esp. in
XSLT with respect to patterns).</li>
</ul></li>
</ul>

<p>
MK shares XQuery-40#id-record-test
</p>

<ul class="org-ul">
<li>MK: Record is used instead of tuple because tuples are often unnamed.</li>

<li>MK describes the design presented in the spec.
<ul class="org-ul">
<li>… Limited recursion is allowed; a record can refer to itself.</li>
<li>… Record types would have to be able to name each other if we
wanted more comprehensive support for recursive types.</li>
<li>… The subtyping rules are a bit complicated; review encouraged!</li>
<li>… Considered doing the subtyping rule intentionally but tried to
spell them out instead.</li>
<li>… Largely meets requirements except for the ability to name record
types by reference.</li>
</ul></li>
<li>MSM: I have to ask what might seem like a dumb question, as far as I
can tell, everything you’ve described I can do with maps, but not
quite vice-versa. Why do we need records in addition to maps?</li>
<li>MK: We’re not introducing new values, we’re introducing new types.
It’s a way of constraining the values that can be in a map.</li>
<li>MSM: That’s an excellent answer! And in that case the subtyping
rules are important.</li>
<li>RD: I raised <a href="https://github.com/qt4cg/qtspecs/issues/52">an issue</a> a while ago about allowing “*” in a record,
like we can in maps. It would be a useful alias.</li>
<li>MK: I’m sort of neutral; I don’t think it’s necessary but I’m not
strongly opposed.</li>
<li>JL: RD, are you implying that it would be an alias?</li>
<li>MK: Yes, that’s what it would be if we allowed it. We’d just be
saying that we didn’t require at least one field.</li>
<li>DN: I want to add something to what RD is saying; I see the value of
“*” but for me the big step from maps to records is that I regard
them as typed maps. So adding the “*” makes them less strictly type.
Could we have “strict” and “untyped” records?</li>
<li>RD: A <code>record(*)</code> would be an untyped record type. See #id-map-test.
The same pattern would apply to records.</li>
<li>MSM: If I understood MK’s description at the outset correctly, saying
“this can be any record” is not the same as saying “this can be any map”. So when
we said “it would be just be a synonym for map(*)” did I misunderstand?</li>
<li>MK: No, I think that would be a synonym. The star allows you to have
anything else and if the anything is empty, that’s just like a map.</li>
<li>MSM: So if I have a “*” I no longer have the constraints on recursion?</li>
<li>MK: The only constraint on recursion is that you can’t constrain it.
You can always have a field that can contain any map. What’s
difficult is to say that it must contain one of these.</li>
<li>MSM: So the checking is not quite as tight as I’d thought. And if I
have an exensible record, is that different from <code>map(*)</code>? I guess
if I declared some fields as required.</li>
<li>MK: Yes, you’re expressing constraints on keys.</li>
<li>RD: As an example, the serialize function takes an option map and we
could define it as a record type that constrains the various fields
like <code>output</code> and things like that. And then allow unconstrained extensions.</li>
<li>DN: This discussion only amplifies for me that the real value of
record without a “*”. The most important achievement of records is
it’s strict type.</li>
<li>MK: When you’re using record types in XSLT style processing with
match patterns, it turns out you very often want to specify just
enough of the map to make it match uniquely. For example, if you
want to match the kinds of records you get in JSON to represent
employees, you want to be able to say this has a key called
“social-security-number” so I’m going to assume it’s an employee.</li>
<li>DN: Yes, but it makes me think about some kind of subtyping
relationship between records.</li>
<li>DN: The fields are unordered, but we’re defining the record
presenting the fields in some order. Maybe it would be good to think
of some sort of normalized presentation…I don’t know.</li>
<li>MK: You’ve got to be careful about that because at the moment,
instances of a record type don’t have any flag that says a map is of
a particular record type. A map can conform to many different record
types; there’s no intrinsic type.</li>
<li>DN: We should also think about the <code>instance of</code> operator when the
right hand side is a record. And maybe we should think about
<code>deep-equal</code> as well.</li>
<li>MK: You can’t say that an item is a kind of record; we only have tests.</li>
<li>RD: You can think about it like duck typing in Python or the way
that JSON bindings are bindings are implemented in typescript where
you’ve got a Java object that represents your JSON but you don’t
know whether it conforms so you have to check if it is an instance
of that, which you do by checking it’s properties. That’s similar to how records
work here.</li>
<li>JL: MK, the self-referential “..” is strictly to the parent of the
type. Is there any case where you might want to point back up to the
grand-parent?</li>
<li>MK: That’s typically where you want mutual recursion. A use case for
that, I tried to model the schema component model with maps. If you
do that, then every component as a record type and you want a graph
of them pointing to each other so you’d like mutual recursion to
describe that structure.
<ul class="org-ul">
<li>… The fact that you can’t construct a graph of maps is a different
problem!</li>
</ul></li>
</ul>

<p>
Some discussion of how the self-reference only works one level deep.
</p>

<ul class="org-ul">
<li>RD: You could describe a binary tree.</li>
<li>MK: I think John Snelson wrote something about this a while back. He
was a head of his time with respect to making tuples in to named
types that could refer to each other.</li>
</ul>

<p>
Proposal: We accept this as a consensus position.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-h-29972C1F-44ED-4967-A11B-87E12F9B9123" class="outline-3">
<h3 id="h-29972C1F-44ED-4967-A11B-87E12F9B9123"><span class="section-number-3">2.2.</span> PR #368: Issue 129 - Context item generalized to context value</h3>
<div class="outline-text-3" id="text-h-29972C1F-44ED-4967-A11B-87E12F9B9123">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-368">#368</a>.
</p>

<ul class="org-ul">
<li>CG walks us through the PR.</li>
<li>CG: Issue #129 proposes expanding context item to context value.
<ul class="org-ul">
<li>… The sequence of items or nodes could also be bound externally.</li>
<li>… We could have a fat arrow operator to bind them.</li>
<li>… We consider using “.” to represent the context item and “~” to
refer to the context value.</li>
<li>… Thanks to MK for helping to make a full proposal.</li>
</ul></li>
</ul>

<p>
(The diff is a bit confusing because the sections have been reorganized.)
</p>

<ul class="org-ul">
<li>MK: My first thought was that this was going to be very disruptive
because the notion that “.” is a singleton is so embedded. So if
we’re going to have one, let’s try to make it a slightly different
thing and keep the context item with it’s current semantics.
I explored how it works in XPath and XQuery and it works quite nicely.
<ul class="org-ul">
<li>… We define a fixed relation between them. If the context value is a singleton, 
then “.” and “~” are the same thing.</li>
<li>… Then I found some useful things you can do with “~” like
defining things over arrays.</li>
<li>… But what do you do about path expressions and axis steps?
<ul class="org-ul">
<li>… Should absolute paths use the context value and allow multiple root nodes?</li>
<li>… And what about relative path expressions?</li>
<li>… What scares me from an implementation point of view is that we
might not be able to eliminate a lot of sorting into document
order at compile time.</li>
<li>… Lots of times we know that the result will be a singleton so
that we don’t have to do the sort. Now we might not know that
until runtime.</li>
<li>… The compromise in this proposal is that absolute path
expressions allow multiple selection. But using “!” not “/”.
This can lead to unnecessary sorting.</li>
<li>… It’s certainly nice to do array filtering.</li>
</ul></li>
</ul></li>
<li>CG: We started from the very beginning to allow sequences of items
in the path expression because that’s common in databases.
<ul class="org-ul">
<li>… People have become used to getting ordered and duplicate free
results from path expressions.</li>
<li>… We could also optionally allow multiple nodes as input to
absolute paths, but allow processors to raise errors.</li>
</ul></li>
<li>MK: What do you do about document order for different documents in a
database?</li>
<li>CG: It’s like fragments; every fragment has an ID which can be used
for comparison. So documents stored sooner are “before” documents
stored later.</li>
<li>MK: I wonder if someone could relax the constraints on “/” sorting
into document order to say that in the case where you’re sorting
multiple documents, the results are in arbitrary order rather than
in some consistent order.</li>
</ul>

<p>
Some discussion of the consequences. You’d allow documents in
arbitrary order but document-order values for items from documents
</p>

<ul class="org-ul">
<li>RD: What’s the motivation for keeping the results in document order?</li>
<li>CG: You can have queries like <code>document {&lt;xml&gt;&lt;a/&gt;&lt;a/&gt;&lt;/xml&gt;}//a =&gt; { /xml }</code>
which would return two copies of “xml”.</li>
</ul>

<p>
“Where are we,” asks the scribe?
</p>

<ul class="org-ul">
<li>MK: We’ve jumped over the easy bits and just talked about the hard
bits. The key thing is tha that the idea of context values does
allow us to have array predicates.</li>
</ul>

<p>
CG shows us an example from XQuery 4.0 section 4.13.3.2.
</p>

<ul class="org-ul">
<li>NW: Is the proposal to accept this PR?</li>
<li>MK: It definitely needs more work because we need to work through
the issues for XSLT.</li>
<li>DN: For the predicates for arrays, I have difficulty understanding.
I made a proposal for “composite path language” that I think would
give a much better syntax. I think “/” is going to be confusing. I
think that it leads a lot more attention and investigation. It seems
a little too complicated. Introducing new symbols doesn’t seem
natural.</li>
<li>NW: What can we do to facilitate getting more work done here?</li>
<li>SF: We need to gather some examples of some of the other options,
for example what is DN’s syntax.</li>
<li>DN: I don’t remember having read this in depth.</li>
</ul>

<p>
ACTION QT4CG-026-01: MK to write a summary paper that outlines the decisions we need to make on “value sequences”
</p>

<ul class="org-ul">
<li>RD: It would also be useful to have some motivating examples.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-any-other-business" class="outline-2">
<h2 id="any-other-business"><span class="section-number-2">3.</span> Any other business</h2>
<div class="outline-text-2" id="text-any-other-business">
<p>
DN shares some ideas for deep-equal-sequence.
</p>

<ul class="org-ul">
<li>DN: The current proposal for <code>deep-equal</code> is very long and complicated.
<ul class="org-ul">
<li>… We could have <code>deep-equal-sequence</code> that expands to <code>deep-equal-item</code>.</li>
<li>… <code>deep-equal-item</code> can expand to <code>deep-equal-atomic</code>, <code>deep-equal-map</code>,
<code>deep-equal-array</code>, <code>deep-equal-array</code>, <code>deep-equal-node</code>.</li>
<li>… <code>deep-equal-map</code> uses <code>deep-equal-atomic</code> and <code>deep-equal-sequence</code></li>
<li>… <code>deep-equal-array</code> uses <code>deep-equal-sequence</code></li>
<li>… <code>deep-equal-node</code> uses different functions for the different node features</li>
<li>… We would also have <code>deep-equal-set</code> for things like attributes.</li>
</ul></li>
<li>DN: On every level we would have greater understandability; we can
construct the whole from these parts.
<ul class="org-ul">
<li>… This technique could also be applied to other things like parsing HTML.</li>
<li>… I think this would be a better technique generally.</li>
</ul></li>
<li>MSM: I like this idea a lot, I like the idea of having the structure
of a function like <code>deep-equal</code> be as far as possible be visually
and obviously similar to the recursive definition of the structure
of our data model. This seems like it would be useful for us and for
readers.</li>
<li>RD: I think this is interesting. My only concern is in specifying
options that apply to nested calls.</li>
</ul>

<p>
Chair proposes that DN create a new issue to track this
</p>
</div>
</div>

<div id="outline-container-adjourned" class="outline-2">
<h2 id="adjourned"><span class="section-number-2">4.</span> Adjourned</h2>
<div class="outline-text-2" id="text-adjourned">
<p>
We ran out of time.
</p>
</div>
</div>
</div>
</body>
</html>