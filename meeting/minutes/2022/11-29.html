<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QT4 CG Meeting 013 Minutes 2022-11-29</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/meeting/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
</head>
<body>
<div id="content" class="content">
<h1 class="title">QT4 CG Meeting 013 Minutes 2022-11-29</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#minutes">Minutes</a></li>
<li><a href="#new-actions">Summary of new and continuing actions <code>[1/4]</code></a></li>
<li><a href="#administrivia">1. Administrivia</a>
<ul>
<li><a href="#roll-call">1.1. Roll call <code>[8/13]</code></a></li>
<li><a href="#agenda">1.2. Accept the agenda</a></li>
<li><a href="#next-meeting">1.3. Next meeting</a></li>
<li><a href="#approve-minutes">1.4. Approve minutes of the previous meeting</a></li>
<li><a href="#open-actions">1.5. Review of open action items <code>[7/8]</code></a></li>
</ul>
</li>
<li><a href="#technical-agenda">2. Technical Agenda</a>
<ul>
<li><a href="#coercion">2.1. Review the coercion rules</a></li>
<li><a href="#pr-fn-foot">2.2. Review pull request #250: fn:foot, etc.</a></li>
</ul>
</li>
<li><a href="#any-other-business">3. Any other business</a></li>
</ul>
</div>
</div>

<div id="outline-container-minutes" class="outline-2">
<h2 id="minutes">Minutes</h2>
<div class="outline-text-2" id="text-minutes">
<p>
Approved <a href="./12-06.html">at meeting 014</a> on 6 December 2022.
</p>
</div>
</div>

<div id="outline-container-new-actions" class="outline-2">
<h2 id="new-actions">Summary of new and continuing actions <code>[1/4]</code></h2>
<div class="outline-text-2" id="text-new-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-013-01: MK to refine the coercion rules with respect to enumeration types</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-013-02: DN to provide a concrete example of the function case discussed with respect to coercion rules.</li>
<li class="on"><code>[X]</code> QT4CG-013-03: MK to raise a separate issue about sequence/array out-of-bounds handling
<ul class="org-ul">
<li><a href="https://github.com/qt4cg/qtspecs/issues/278">https://github.com/qt4cg/qtspecs/issues/278</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-administrivia" class="outline-2">
<h2 id="administrivia"><span class="section-number-2">1.</span> Administrivia</h2>
<div class="outline-text-2" id="text-administrivia">
</div>

<div id="outline-container-roll-call" class="outline-3">
<h3 id="roll-call"><span class="section-number-3">1.1.</span> Roll call <code>[8/13]</code></h3>
<div class="outline-text-3" id="text-roll-call">
<p>
Regrets BTW, JL
</p>

<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Anthony (Tony) Bufort (AB)</li>
<li class="on"><code>[X]</code> Reece Dunn (RD) [0:30-]</li>
<li class="on"><code>[X]</code> Christian Grün (CG)</li>
<li class="on"><code>[X]</code> Joel Kalvesmaki (JK) [0:10-]</li>
<li class="on"><code>[X]</code> Michael Kay (MK)</li>
<li class="off"><code>[&#xa0;]</code> John Lumley (JL)</li>
<li class="on"><code>[X]</code> Dimitre Novatchev (DN)</li>
<li class="on"><code>[X]</code> Ed Porter (EP)</li>
<li class="off"><code>[&#xa0;]</code> Liam Quin (LQ)</li>
<li class="off"><code>[&#xa0;]</code> Adam Retter</li>
<li class="on"><code>[X]</code> C. M. Sperberg-McQueen (MSM)</li>
<li class="off"><code>[&#xa0;]</code> Bethan Tovey-Walsh (BTW)</li>
<li class="on"><code>[X]</code> Norm Tovey-Walsh (NW). <i>Scribe</i>. <i>Chair</i>.</li>
</ul>
</div>
</div>

<div id="outline-container-agenda" class="outline-3">
<h3 id="agenda"><span class="section-number-3">1.2.</span> Accept the agenda</h3>
<div class="outline-text-3" id="text-agenda">
<p>
Proposal: Accept <a href="../../agenda/2022/11-29.html">the agenda</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-next-meeting" class="outline-3">
<h3 id="next-meeting"><span class="section-number-3">1.3.</span> Next meeting</h3>
<div class="outline-text-3" id="text-next-meeting">
<p>
The next meeting <a href="../../agenda/2022/12-06.html">is scheduled for Tuesday, 6 December</a>.
</p>
</div>
</div>

<div id="outline-container-approve-minutes" class="outline-3">
<h3 id="approve-minutes"><span class="section-number-3">1.4.</span> Approve minutes of the previous meeting</h3>
<div class="outline-text-3" id="text-approve-minutes">
<p>
Proposal: Accept <a href="../../minutes/2022/11-22.html">the minutes of the previous meeting</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-open-actions" class="outline-3">
<h3 id="open-actions"><span class="section-number-3">1.5.</span> Review of open action items <code>[7/8]</code></h3>
<div class="outline-text-3" id="text-open-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-002-10: BTW to coordinate some ideas about improving diversity in the group
<ul class="org-ul">
<li>Continued</li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-01: MK to add a reference to the place in XSD where it says that value spaces are non-overlapping
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-271">pull request #271</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-02: MK to point out the rules for union types are actually a bit more complex than described in section 2.2.1.
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-271">pull request #271</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-03: MK to consider introducing schema element and schema element in 2.8
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-271">pull request #271</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-04: MK to add “and also of other specific function types” to 2.8.
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-271">pull request #271</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-05: NW to see if the presentation of the type hierarchy tables can be improved.
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-268">pull request #268</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-06: MK to remove <code>xs:untyped</code> from the paragraph at the top of 2.8.2
<ul class="org-ul">
<li>See <a href="https://qt4cg.org/dashboard/#pr-271">pull request #271</a></li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-07: NW to work with MK to sort out the server build issues with PR #237
<ul class="org-ul">
<li>Resolved, merged</li>
</ul></li>
<li class="on"><code>[X]</code> QT4CG-012-08: NW to put the coercion rule changes on the agenda next week.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-technical-agenda" class="outline-2">
<h2 id="technical-agenda"><span class="section-number-2">2.</span> Technical Agenda</h2>
<div class="outline-text-2" id="text-technical-agenda">
</div>

<div id="outline-container-coercion" class="outline-3">
<h3 id="coercion"><span class="section-number-3">2.1.</span> Review the coercion rules</h3>
<div class="outline-text-3" id="text-coercion">
<p>
See <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-coercion-rules">4.4.3 Coercion Rules</a> in <a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html">XPath 4.0</a>
</p>

<p>
See also <a href="https://qt4cg.org/dashboard/#pr-254">pull request #254</a>
</p>

<p>
Mike walks us through the spec with the applied changes (the diff is a bit messy).
</p>

<ul class="org-ul">
<li>MK: Function conversion rules are renamed coercion rules
<ul class="org-ul">
<li>… Rules accept, coerce, or reject a supplied value</li>
<li>… (We’re reviewing the XQuery version, not the XPath version, so
there are no sections about backwards compatibility.)</li>
</ul></li>
</ul>

<p>
ACTION QT4CG-013-01: MK to refine the coercion rules with respect to enumeration types
</p>

<p>
Mike walks through the rules in 4.4.3
</p>

<ul class="org-ul">
<li>MK: Rule 5 is new: relabels types. This allows you to use “5” where
xs:positiveInteger is expected without an explicit cast.
<ul class="org-ul">
<li>Relabeling is not the same as casting</li>
<li>Numeric promotion and relabeling are mutually exclusive.</li>
<li>The next rule is also new, it applies coercion to all the values of a map.</li>
<li>Then function coercion</li>
<li>Else error.</li>
<li>Function coercion has a new item 2 that says that if the function
you supply has a lower arity than the function that’s required,
then you wrap it in a function that ignores the excess arguments.
<ul class="org-ul">
<li>This lets callbacks that expect 1 argument to work with
functions that could have two.</li>
</ul></li>
</ul></li>
<li>DN: When talking about coercion, it seems to me that the way I read
it is that coercion applies only to the arguments, not the return
value.</li>
<li>MK: No, this section doesn’t say where coercion is used.</li>
<li>DN: It kind of implies it though. Maybe we need to have a more
explicit statement that it can be used for both.</li>
<li>MK: I wanted to avoid enumerating all the places where it’s used
because they’re subject to change.
<ul class="org-ul">
<li>… In places like, for example, dynamic function calls, we say that
the rules are applied to both the arguments and the return value.</li>
</ul></li>
<li>MSM: I think if you look at 4.4.1.2, that makes the context for the
term “supplied value” to make sense.</li>
<li>DN: It would still be good to be clear.</li>
<li>DN: When a function returns a function and the returned function has
to be passed arguments, when are the arguments coerced? Is it done
“early” or “late”? 
<ul class="org-ul">
<li>… If we know some arguments won’t be used at all, can we assume
that in this case, the arguments should not be evaluated “early”?</li>
</ul></li>
<li>MK: I’m not sure I understand exactly the scenario you’re
describing. This is a spec, not an implementation, so there’s plenty
of scope for optimization.</li>
<li>DN: It’s definitely explicit somewhere in this text, maybe we should
make sure it’s explicit in this case where a function that’s
returned with a smaller arity gets wrapped.</li>
<li>CG: If a function item is returned, then we have potential
paremeters, but no arguments.</li>
<li>DN: We have an expression; on the left side, the first thing that
happens is a funtion is returned, and then the rest of the
expression is the arguments for the function.</li>
<li>MK: Isn’t that just a simple optimization that implementations can
perform?</li>
<li>DN: We should clearly say in this case that it is possible not to
evaluate the arguments that are not going to be used.</li>
<li>NW: Can you provide an example in chat? We’re having trouble
following just verbally?</li>
<li>DN: Yes, but maybe not now.</li>
</ul>

<p>
Some further attempt to describe examples.
</p>

<p>
ACTION QT4CG-013-02: DN to provide a concrete example of the function case discussed with respect to coercion rules.
</p>

<ul class="org-ul">
<li>NW: I don’t think anyone thinks you should be forbidden from
throwing it away. Requiring it be thrown away might be possible.</li>
<li>MSM: I’d be a little nervous about a rule that says you are required
to throw away an “extra” argument because I view lazy or eager
evaluation as an optimization strategy.</li>
</ul>

<p>
MK draws our attention to another part of the spec.
</p>

<ul class="org-ul">
<li>MK: The coercion rules are also applied to variable bindings. In
4.15.1, there’s a new section that describes the coercion.
(So <code>let $temp as xs:double := 32.5</code> will succeed.)
<ul class="org-ul">
<li>… I proposed this before (years ago) and there was some objection
because variables and functions are different and should be
treated differently.</li>
<li>… I’ve looked at some other languages and there is some variation,
but there’s no reason to think this should be a problem. It works
fine in XSLT.</li>
</ul></li>
<li>MSM: Makes sense to me: functions and constants and variables are
all functions.</li>
</ul>

<p>
MSM draws our attention back to 4.4.3.
</p>

<ul class="org-ul">
<li>MSM: Can I come back to rule 5? In the Data Model, we’ve followed
the lead of XSD in saying the value spaces of the primitive types
are decreed to be distinct. That applies only to the primitive
types. What I think we’re saying here is the type coercion to a
subtype works if the required type and the label on the supplied
value are both descended from the same primitive type.</li>
<li>MK: Yes, essentially.</li>
<li>MSM: So this covers integer/positiveInteger but not decimal/double.MK</li>
<li>MK: Or hexBinary to base64binary.</li>
</ul>

<p>
Some chuckling about the way this played out in XSD.
</p>

<ul class="org-ul">
<li>MK: If we’re going to take advantage of this capability to change
standard functions, a function that expects an NCName for example,
what I’ve suggested is that we give ourselves the license to declare
the expected type as NCName and retain the error code if you give
something else. Rather than getting a generic type error, we have
the ability to define a more specific error code.</li>
<li>MSM: That seems to mean that that particular kind of type checking,
raising those errors, has to take place before the coercion and not
after it. The point of view has to be from outside the function.</li>
<li>MK: At the implementation level, there has to be some sort of secret
sauce in the function signature to identify the error code.</li>
</ul>

<p>
Proposal: Accept this PR.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-pr-fn-foot" class="outline-3">
<h3 id="pr-fn-foot"><span class="section-number-3">2.2.</span> Review pull request #250: fn:foot, etc.</h3>
<div class="outline-text-3" id="text-pr-fn-foot">
<p>
See <a href="https://qt4cg.org/dashboard/#pr-250">pull request #250</a>
</p>

<p>
Mike walk us through the PR.
</p>

<ul class="org-ul">
<li>MK: This gives us four new functions: <code>fn:foot</code> and <code>fn:truncate</code>
and <code>array:foot</code> and <code>array:truncate</code>. They’re the same except for
error checking where they’re consistent with related functions.</li>
<li>JK: Do these qualify in the category of “convenience functions”?</li>
<li>MK: They certainly do fall into that category. It’s easy to code
them up yourself.
<ul class="org-ul">
<li>… For convenience functions you have to weigh two factors: how
many folks are going to use them and how many lines/how difficult
it is. The <code>fn:head</code> function saves a lot of people a lot of code.
The <code>fn:foot</code> function probably saves fewer people just a little bit more code.</li>
<li>… It also makes the code easier to read; the <code>last()</code> trick for
<code>fn:foot</code> is harder to understand and harder to optimize.</li>
</ul></li>
<li>JK: They’ll be great functions to have, I’m just thinking of the
larger question of the “cluttering” of the core specs with
convenience functions.</li>
</ul>

<p>
NW observes that the question of <a href="https://github.com/qt4cg/qtspecs/issues/274">issue #274</a> isn’t on the agenda this
week, maybe it should be next week.
</p>

<ul class="org-ul">
<li>RD: One of the arguments against convenience functions is that it
makes more work for implementors to claim conformance.
<ul class="org-ul">
<li>… I wonder if it would make sense to have a reference
implementation for as many as we can, perhaps non-normatively.</li>
</ul></li>
<li>EP: I was going to make exactly that point.</li>
<li>MSM: These functions do have those expressions.</li>
<li>RD: So we could pull that into a single place, grouped by XQuery and
XSLT style.</li>
<li>MSM: A library that an implementation could just import.</li>
<li>DN: If the question is asked about <code>fn:head</code> and <code>fn:tail</code>, I don’t
think they’re convenience functions at all! They’re the basics for
any recursive implementation. And that holds true for these
functions as well as they’re the complement of those functions.
<ul class="org-ul">
<li>… I am still firmly agains the name <code>fn:truncate</code>.</li>
<li>… I also don’t like the difference in behavior between the array
and sequence versions. I proposed that for the sequence functions,
we have an additional parameter that says whether an exception
should be raised for an empty argument. The default value should
be <code>false()</code>, but a user who wants them to behave the same as
arrays can set them to <code>true()</code>.</li>
</ul></li>
<li>RD: An extra argument to control exception behavior isn’t a great
design decision. It pollutes the argument namespace. It would
make more sense to use something like the XQuery declare options.</li>
<li>MK: A mode like “unordered”. Make it part of the static context.</li>
<li>CG: Whenever you work with arrays, you always have out-of-bounds
issues, we shouldn’t restrict it to just these functions.</li>
<li>DN: There’s no way to make an array behave like a sequence. An array
can contain an empty sequence and that makes the cases
indistinguishable.</li>
<li>RD: Then what happens if you’re writing the function and you have
one case where you’ve remembered to include that parameter and
another where you’ve forgotten it. Your code is expecting it to
throw, but because you left it out, it doens’t. That’s my objection
to having this as a parameter on each of the non-array functions.</li>
<li>DN: I think this is completely new behavior, but you’re right, you
have to specify it in every call.</li>
<li>RD: Having it at the global level would allow you to have more
consistent control, so you don’t have to remember to pass the specific parameter.</li>
<li>DN: But there could be cases where I want them to work both ways.</li>
<li>RD: But by extension, why not parameters on every function?</li>
<li>CG: We should separate this discussion from these four functions,
they apply much more widely.</li>
</ul>

<p>
Some discussion of what other functions have this behavior.
</p>

<ul class="org-ul">
<li>NW: Why not wrap the function you want to check in another function
that checks?</li>
<li>MSM: That has the value of being shorter and easier to remember.</li>

<li>MK: What are the possible solutions?
<ul class="org-ul">
<li>Do nothing, leave it up to the user; try/catch</li>
<li>Add parameters to the functions</li>
<li>Provide mirror versions of the functions</li>
<li>Make it modal</li>
</ul></li>

<li>DN: Try/catch is the least practical</li>
<li>MM: My choice is the proposal as it’s designed: sequences are designed to be relaxed, arrays are for stronger type hecking. That inconsist</li>
</ul>

<p>
ACTION QT4CG-013-03: MK to raise a separate issue about sequence/array out-of-bounds handling
</p>
</div>
</div>
</div>

<div id="outline-container-any-other-business" class="outline-2">
<h2 id="any-other-business"><span class="section-number-2">3.</span> Any other business</h2>
<div class="outline-text-2" id="text-any-other-business">
<p>
None heard.
</p>
</div>
</div>
</div>
</body>
</html>
